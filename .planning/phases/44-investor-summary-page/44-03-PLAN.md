---
phase: 44-investor-summary-page
plan: 03
type: execute
wave: 2
depends_on: [44-01, 44-02]
files_modified:
  - src/app/[locale]/(app)/profile/investor/summary/page.tsx
  - src/app/[locale]/(app)/onboarding/questionnaire/page.tsx
  - src/app/[locale]/(app)/dashboard/page.tsx
  - messages/en.json
  - messages/he.json
autonomous: false

must_haves:
  truths:
    - "Desktop shows two panels: profile summary (left) and AI assistant (right)"
    - "Page accessible at /profile/investor/summary"
    - "Investors redirected to summary page after onboarding completion"
    - "Page shows profile data, supports inline editing, integrates AI chat"
    - "Quick reply buttons appear and send prompts to AI"
  artifacts:
    - path: "src/app/[locale]/(app)/profile/investor/summary/page.tsx"
      provides: "Two-panel investor summary page"
      min_lines: 50
    - path: "messages/en.json"
      provides: "English translations for profile summary sections"
      contains: "profileSummary"
  key_links:
    - from: "summary/page.tsx"
      to: "ProfileSummaryPanel"
      via: "left panel render"
      pattern: "<ProfileSummaryPanel"
    - from: "summary/page.tsx"
      to: "AIChatPanel"
      via: "right panel render with quick replies"
      pattern: "<AIChatPanel.*renderQuickReplies"
    - from: "onboarding/questionnaire/page.tsx"
      to: "/profile/investor/summary"
      via: "router.push after completion"
      pattern: "router\\.push.*profile/investor/summary"
---

<objective>
Create the investor summary page with two-panel layout and update routing.

Purpose: This is the main investor hub - a two-panel page where profile management (left) meets AI assistance (right). Investors land here after completing onboarding and can return anytime to manage their profile.

Output: Working summary page at /profile/investor/summary, updated onboarding completion routing, translations.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/44-investor-summary-page/44-CONTEXT.md
@.planning/phases/44-investor-summary-page/44-RESEARCH.md

# Prior plan outputs (required for this plan)
@.planning/phases/44-investor-summary-page/44-01-SUMMARY.md
@.planning/phases/44-investor-summary-page/44-02-SUMMARY.md

# Routing references
@src/app/[locale]/(app)/onboarding/questionnaire/page.tsx
@src/app/[locale]/(app)/dashboard/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create investor summary page with two-panel layout</name>
  <files>
    src/app/[locale]/(app)/profile/investor/summary/page.tsx
  </files>
  <action>
Create the two-panel summary page:

```typescript
"use client";

import { useQuery } from "convex/react";
import { api } from "../../../../../../../convex/_generated/api";
import { ProfileSummaryPanel, QuickReplyButtons } from "@/components/profile";
import { AIChatPanel } from "@/components/ai";
import { Skeleton } from "@/components/ui/skeleton";

export default function InvestorSummaryPage() {
  // Fetch questionnaire for completeness check
  const questionnaire = useQuery(api.investorQuestionnaires.getByUser);

  // Calculate completeness (simplified - full calculation in ProfileCompletenessBar)
  const isComplete = questionnaire?.status === "complete";

  // Loading state
  if (questionnaire === undefined) {
    return (
      <div className="h-[calc(100vh-64px)] grid grid-cols-1 lg:grid-cols-2 gap-0">
        <div className="border-e p-6 space-y-4">
          <Skeleton className="h-16 w-full" />
          <Skeleton className="h-24 w-full" />
          <Skeleton className="h-24 w-full" />
        </div>
        <div className="p-6">
          <Skeleton className="h-full w-full" />
        </div>
      </div>
    );
  }

  return (
    <div className="h-[calc(100vh-64px)] grid grid-cols-1 lg:grid-cols-2 gap-0">
      {/* Left panel: Profile Summary */}
      <div className="border-e overflow-y-auto bg-background">
        <ProfileSummaryPanel />
      </div>

      {/* Right panel: AI Assistant */}
      <div className="flex flex-col h-full">
        <AIChatPanel
          className="flex-1"
          renderQuickReplies={(sendMessage) => (
            <QuickReplyButtons
              onPromptSelect={sendMessage}
              profileComplete={isComplete}
            />
          )}
        />
      </div>
    </div>
  );
}
```

**Key layout details:**
- Fixed height: `h-[calc(100vh-64px)]` accounting for header
- Responsive grid: `grid-cols-1 lg:grid-cols-2` (stacks on mobile, side-by-side on desktop)
- Left panel: `border-e overflow-y-auto` for scroll independence
- Right panel: `flex flex-col h-full` to fill height
- No gap between panels: `gap-0` for seamless two-panel look
  </action>
  <verify>
TypeScript compiles: `npx tsc --noEmit`
  </verify>
  <done>
Summary page renders two-panel layout with ProfileSummaryPanel and AIChatPanel.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add translations for profile summary sections</name>
  <files>
    messages/en.json
    messages/he.json
  </files>
  <action>
Add translations for profile summary sections and fields. Add to the existing "profile" or create "profileSummary" namespace:

**messages/en.json** - add within appropriate namespace:
```json
{
  "profileSummary": {
    "title": "Your Profile",
    "completeness": {
      "title": "Profile Completeness",
      "complete": "Profile complete",
      "missingPrefix": "Missing:",
      "moreItems": "+{count} more"
    },
    "sections": {
      "basics": "Investor Basics",
      "financial": "Financial Context",
      "preferences": "Property Preferences",
      "timeline": "Timeline & Services"
    },
    "fields": {
      "citizenship": "Citizenship",
      "residencyStatus": "Residency Status",
      "experienceLevel": "Experience Level",
      "propertyOwnership": "Owns Property in Israel",
      "investmentType": "Investment Type",
      "budgetMin": "Minimum Budget",
      "budgetMax": "Maximum Budget",
      "investmentHorizon": "Investment Horizon",
      "investmentGoals": "Investment Goals",
      "yieldPreference": "Yield Preference",
      "financingApproach": "Financing Approach",
      "propertyTypes": "Property Types",
      "preferredLocations": "Preferred Locations",
      "purchaseTimeline": "Purchase Timeline",
      "servicesNeeded": "Services Needed",
      "notSet": "Not set"
    },
    "edit": {
      "save": "Save",
      "cancel": "Cancel",
      "saving": "Saving...",
      "saveSuccess": "Saved",
      "saveError": "Failed to save"
    },
    "incomplete": "Incomplete"
  },
  "quickReplies": {
    "showProperties": "Show properties",
    "buildTeam": "Build my team",
    "explainOptions": "Explain options",
    "completeProfile": "Complete profile",
    "showSuggestions": "Show suggestions"
  }
}
```

**messages/he.json** - add Hebrew translations:
```json
{
  "profileSummary": {
    "title": "הפרופיל שלך",
    "completeness": {
      "title": "שלמות הפרופיל",
      "complete": "הפרופיל מלא",
      "missingPrefix": "חסר:",
      "moreItems": "+{count} נוספים"
    },
    "sections": {
      "basics": "פרטי משקיע",
      "financial": "הקשר פיננסי",
      "preferences": "העדפות נכס",
      "timeline": "לוח זמנים ושירותים"
    },
    "fields": {
      "citizenship": "אזרחות",
      "residencyStatus": "סטטוס תושבות",
      "experienceLevel": "רמת ניסיון",
      "propertyOwnership": "בעלות על נכס בישראל",
      "investmentType": "סוג השקעה",
      "budgetMin": "תקציב מינימלי",
      "budgetMax": "תקציב מקסימלי",
      "investmentHorizon": "אופק השקעה",
      "investmentGoals": "מטרות השקעה",
      "yieldPreference": "העדפת תשואה",
      "financingApproach": "גישת מימון",
      "propertyTypes": "סוגי נכסים",
      "preferredLocations": "מיקומים מועדפים",
      "purchaseTimeline": "לוח זמנים לרכישה",
      "servicesNeeded": "שירותים נדרשים",
      "notSet": "לא הוגדר"
    },
    "edit": {
      "save": "שמור",
      "cancel": "ביטול",
      "saving": "שומר...",
      "saveSuccess": "נשמר",
      "saveError": "השמירה נכשלה"
    },
    "incomplete": "לא הושלם"
  },
  "quickReplies": {
    "showProperties": "הצג נכסים",
    "buildTeam": "בנה את הצוות שלי",
    "explainOptions": "הסבר אפשרויות",
    "completeProfile": "השלם פרופיל",
    "showSuggestions": "הצג הצעות"
  }
}
```
  </action>
  <verify>
JSON files are valid: `cat messages/en.json | jq . > /dev/null && echo "Valid"`
  </verify>
  <done>
English and Hebrew translations added for profile summary page.
  </done>
</task>

<task type="auto">
  <name>Task 3: Update onboarding completion routing</name>
  <files>
    src/app/[locale]/(app)/onboarding/questionnaire/page.tsx
    src/app/[locale]/(app)/dashboard/page.tsx
  </files>
  <action>
**Update questionnaire page - handleComplete function:**

Find the handleComplete function (around line 277-289) and change the redirect:

```typescript
// Change from:
router.push("/dashboard");

// To:
router.push("/profile/investor/summary");
```

The complete handleComplete should look like:
```typescript
const handleComplete = async () => {
  setIsSubmitting(true);
  try {
    await saveProgress();
    await markComplete();
    await completeOnboarding();
    router.push("/profile/investor/summary"); // NEW: Summary page instead of dashboard
  } catch (error) {
    console.error("Failed to complete questionnaire:", error);
    toast.error("Failed to complete questionnaire. Please try again.");
    setIsSubmitting(false);
  }
};
```

**Also update the redirect in useEffect for already-complete questionnaires:**

Find the useEffect that checks for complete questionnaire (around line 217-222) and update:

```typescript
// Change from:
useEffect(() => {
  if (!isUserLoading && questionnaire?.status === "complete") {
    router.push("/properties");
  }
}, [isUserLoading, questionnaire, router]);

// To:
useEffect(() => {
  if (!isUserLoading && questionnaire?.status === "complete") {
    router.push("/profile/investor/summary");
  }
}, [isUserLoading, questionnaire, router]);
```

**Update dashboard page - investor redirect:**

In dashboard/page.tsx, update the investor redirect (around line 49-54):

```typescript
// Change from:
useEffect(() => {
  if (!userLoading && effectiveRole === "investor") {
    router.replace("/properties");
  }
}, [userLoading, effectiveRole, router]);

// To:
useEffect(() => {
  if (!userLoading && effectiveRole === "investor") {
    router.replace("/profile/investor/summary");
  }
}, [userLoading, effectiveRole, router]);
```

This ensures investors always land on their summary page, not the properties list or generic dashboard.
  </action>
  <verify>
TypeScript compiles: `npx tsc --noEmit`
Grep for the new route: `grep -r "profile/investor/summary" src/app/`
  </verify>
  <done>
Investors are routed to summary page after onboarding and when visiting dashboard.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete investor summary page with two-panel layout, profile editing, quick replies, and routing.
  </what-built>
  <how-to-verify>
1. Start dev server: `npm run dev`
2. Log in as an investor user
3. Navigate to `/profile/investor/summary`

**Verify layout:**
- Desktop (lg+): Two panels side by side - profile left, chat right
- Both panels have proper height (fill viewport minus header)
- Left panel scrolls independently if content overflows

**Verify profile panel:**
- Progress bar shows completeness percentage at top
- Accordion sections visible (Investor Basics, Financial Context, etc.)
- First incomplete section expanded by default
- Badge shows "Incomplete" on sections with missing fields
- Click any value to open popover editor
- Save button saves to database (check via toast)
- Completeness updates after save

**Verify completeness bar:**
- Click bar when incomplete -> jumps to first incomplete section
- Shows missing fields list (truncated with "+N more")

**Verify quick replies:**
- Buttons visible above chat input ("Show properties", "Build my team", etc.)
- If profile incomplete, "Complete profile" button appears
- Click button -> prompt sent to AI, response streams
- After click, buttons collapse to "Show suggestions"
- Click "Show suggestions" -> buttons expand again

**Verify routing:**
- Visit `/dashboard` as investor -> redirected to summary page
- Complete questionnaire (if testing fresh) -> redirected to summary page

**Mobile check (optional):**
- Resize to mobile width -> panels stack vertically (profile on top, chat below)
  </how-to-verify>
  <resume-signal>Type "approved" to confirm all verification items pass, or describe issues found.</resume-signal>
</task>

</tasks>

<verification>
1. Summary page renders at /profile/investor/summary
2. Two-panel layout works on desktop (lg+)
3. Profile summary shows accordion with all sections
4. Inline editing saves to database
5. Quick reply buttons send prompts to AI
6. Onboarding completion routes to summary page
7. Dashboard redirects investors to summary page
8. Translations work in both English and Hebrew
</verification>

<success_criteria>
- PAGE-01: Desktop layout shows two panels (profile left + AI right)
- PAGE-02: Page accessible after onboarding completes
- PAGE-03: Page accessible as ongoing investor profile page
- PROF-01: Investor can view profile summary
- PROF-02: Profile shows all questionnaire sections
- PROF-03: Inline editing works without leaving page
- PROF-04: Completeness indicator shows percentage and missing
- CHAT-05: Quick reply buttons appear for common queries
- Human verification checkpoint passes
</success_criteria>

<output>
After completion, create `.planning/phases/44-investor-summary-page/44-03-SUMMARY.md`
</output>
