---
phase: 05.4-yad2-property-page-layout
plan: 03
type: execute
---

<objective>
Complete Yad2-style property page with NeighborhoodInfo card, SoldPropertiesTable, and full page layout redesign integrating all new components.

Purpose: Deliver the complete Yad2-inspired property detail experience with organized sections.
Output: Redesigned property detail page with all Yad2 features integrated and verified.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior plans in this phase:
@.planning/phases/05.4-yad2-property-page-layout/05.4-01-SUMMARY.md
@.planning/phases/05.4-yad2-property-page-layout/05.4-02-SUMMARY.md

# Key source files:
@src/app/(app)/properties/[id]/page.tsx
@src/components/ui/table.tsx
@src/components/ui/tabs.tsx
@convex/schema.ts

**Tech stack available:** Shadcn Table, Tabs, all prior components
**Established patterns:**
- Two-column layout with sticky sidebar
- Card-based sections
- Convex useQuery for data fetching
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create NeighborhoodInfo and SoldPropertiesTable components</name>
  <files>src/components/properties/NeighborhoodInfo.tsx, src/components/properties/SoldPropertiesTable.tsx, convex/neighborhoods.ts, convex/properties.ts</files>
  <action>
**NeighborhoodInfo Component:**

1. Create convex/neighborhoods.ts with query:
```typescript
export const getByCity = query({
  args: { city: v.string() },
  handler: async (ctx, args) => {
    return await ctx.db
      .query("neighborhoods")
      .withIndex("by_city", (q) => q.eq("city", args.city))
      .first();
  },
});
```

2. Create NeighborhoodInfo component:
Props: city: string

Display in Card (header: "About {city}" or "מידע על השכונה"):
- Population (formatted with commas)
- Avg Price/m² (USD formatted)
- 1-Year Price Change (with up/down arrow, green/red color)
- Nearby amenities as badges (schools, parks, shopping, etc.)
- Description paragraph

Use icons for stats: Population01Icon, Money01Icon, TrendUp01Icon/TrendDown01Icon

**SoldPropertiesTable Component:**

1. Add query to convex/properties.ts:
```typescript
export const getSoldInCity = query({
  args: { city: v.string(), limit: v.optional(v.number()) },
  handler: async (ctx, args) => {
    const results = await ctx.db
      .query("properties")
      .withIndex("by_status", (q) => q.eq("status", "sold"))
      .collect();
    // Filter by city in memory (Convex single-index constraint)
    return results
      .filter(p => p.city === args.city)
      .slice(0, args.limit || 5);
  },
});
```

2. Create SoldPropertiesTable component:
Props: city: string

Display in Card (header: "Recently Sold in {city}" or "נכסים שנמכרו באזור"):
- Use Shadcn Table component
- Columns: Address, Type, Size (m²), Price (USD), Sold Date
- Show up to 5 recent sales
- If no sold properties, show "No recent sales data" message
- Link each row to property detail (if we want to show sold properties)

Note: We may not have many "sold" properties in seed data. Consider adding 2-3 sold properties to seed data in this task, OR show message when empty.
  </action>
  <verify>Both components render, queries return data, table displays correctly</verify>
  <done>NeighborhoodInfo shows city stats with badges, SoldPropertiesTable shows recent sales in tabular format.</done>
</task>

<task type="auto">
  <name>Task 2: Redesign property detail page with Yad2-style sections</name>
  <files>src/app/(app)/properties/[id]/page.tsx</files>
  <action>
Reorganize the property detail page to incorporate all new Yad2 components in a logical layout.

**New Layout Structure:**

```
┌─────────────────────────────────────────────────────────────┐
│ Back link + Title + Address                                 │
├─────────────────────────────────┬───────────────────────────┤
│ Image Carousel                  │ Map                       │
│                                 │ Price Card                │
│                                 │ Action Buttons            │
├─────────────────────────────────┴───────────────────────────┤
│ [Description] [Amenities] [Investment] [Area Info]  ← Tabs  │
├─────────────────────────────────────────────────────────────┤
│ Tab Content Area                                            │
│ - Description: text + property details grid                 │
│ - Amenities: PropertyAmenities component                    │
│ - Investment: Metrics card + MortgageCalculator             │
│ - Area Info: NeighborhoodInfo + ValueHistoryChart +         │
│              SoldPropertiesTable                            │
└─────────────────────────────────────────────────────────────┘
```

Implementation:
1. Keep header section (back link, title, address)
2. Keep two-column top section (carousel left, map + price + actions right)
3. Replace single description section with Shadcn Tabs:
   - Tab 1: "Overview" - Description text + Property Details card (bedrooms, bathrooms, size, etc.)
   - Tab 2: "Amenities" - PropertyAmenities component
   - Tab 3: "Investment" - Investment Metrics card + MortgageCalculator
   - Tab 4: "Area" - NeighborhoodInfo + ValueHistoryChart + SoldPropertiesTable (stacked)

4. Import all new components:
   - PropertyAmenities
   - MortgageCalculator
   - ValueHistoryChart
   - NeighborhoodInfo
   - SoldPropertiesTable

5. Pass appropriate props:
   - PropertyAmenities: amenities={property.amenities || []}
   - MortgageCalculator: defaultPrice={priceUsd}
   - ValueHistoryChart: city={city}
   - NeighborhoodInfo: city={city}
   - SoldPropertiesTable: city={city}

6. Ensure responsive behavior:
   - Tabs stack content vertically on mobile
   - Tab list scrolls horizontally if needed on mobile

Remove the sticky behavior from right column below the fold - tabs provide better mobile UX.
  </action>
  <verify>Page loads with tabs, all 4 tabs show correct content, no console errors</verify>
  <done>Property detail page redesigned with tabbed interface, all Yad2 components integrated, responsive layout works.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete Yad2-style property detail page with amenities, mortgage calculator, value history chart, neighborhood info, and sold properties table organized in tabs</what-built>
  <how-to-verify>
    1. Run: npm run dev
    2. Visit: http://localhost:3000/properties
    3. Click on any property (e.g., "Modern Penthouse in Tel Aviv")
    4. Verify top section:
       - Image carousel with thumbnails works
       - Map shows property location
       - Price and status badge display correctly
       - Save and Contact buttons work
    5. Test "Overview" tab:
       - Description text displays
       - Property details (bedrooms, bathrooms, size, year) show correctly
    6. Test "Amenities" tab:
       - Grid of amenity icons/labels displays
       - Icons match amenity types
    7. Test "Investment" tab:
       - Investment metrics card shows ROI, Cap Rate, etc.
       - Mortgage calculator has inputs
       - Change inputs and verify calculations update (try: 25% down, 5.5% rate, 25 years)
    8. Test "Area" tab:
       - Neighborhood info card shows city stats
       - Value history chart displays price trend
       - Sold properties table shows (or "no data" message)
    9. Test mobile view (resize to ~375px width):
       - Tabs remain accessible
       - Content stacks properly
       - No horizontal overflow
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe any issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] All 5 Yad2 components integrated into page
- [ ] Tabs switch content correctly
- [ ] Data loads for all components (amenities, neighborhood, chart, table)
- [ ] Mortgage calculator calculations are accurate
- [ ] Mobile responsive design works
- [ ] `npm run build` passes
</verification>

<success_criteria>
- Property detail page fully redesigned with Yad2-style features
- All tabs functional with correct content
- Human verification passed
- Phase 5.4 complete
</success_criteria>

<output>
After completion, create `.planning/phases/05.4-yad2-property-page-layout/05.4-03-SUMMARY.md` with:

# Phase 5.4 Plan 03: Page Redesign & Final Integration Summary

**[One-liner describing what shipped]**

## Accomplishments
- [List key outcomes]

## Files Created/Modified
- [List files]

## Decisions Made
- [Key decisions]

## Issues Encountered
- [Problems and resolutions]

## Next Phase Readiness
- Phase 5.4 complete - Yad2-style property page implemented
- Ready for Phase 6: Deal Flow
</output>
