---
phase: 05.4-yad2-property-page-layout
plan: 01
type: execute
---

<objective>
Extend database schema with property amenities, neighborhood data, and price history tables to support Yad2-style property page features.

Purpose: Provide data foundation for amenities display, neighborhood info, value history charts, and sold properties table.
Output: Extended Convex schema with new tables and comprehensive seed data for all 15 properties.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior phase context:
@.planning/phases/05.3-property-page-carousel-and-interactive-map/05.3-02-SUMMARY.md

# Key source files:
@convex/schema.ts
@convex/seedData.ts
@src/lib/constants.ts

**Tech stack available:** Convex, Shadcn charts/tables
**Established patterns:**
- Schema with v.union for enums
- Seed data with typed arrays
- Constants in src/lib/constants.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extend Convex schema with amenities, neighborhoods, and price history</name>
  <files>convex/schema.ts, src/lib/constants.ts</files>
  <action>
1. Add amenities array to properties table using v.array(v.string()) - flexible string array for amenity keys like "airConditioning", "elevator", "parking", "storage", "balcony", "security", "gym", "pool", "garden", "renovated", "furnished", "petFriendly", "accessible", "safeRoom", "solar"

2. Create PROPERTY_AMENITIES constant in src/lib/constants.ts with amenity definitions:
```typescript
export const PROPERTY_AMENITIES = [
  { value: "airConditioning", label: "Air Conditioning", icon: "AirConditioning" },
  { value: "elevator", label: "Elevator", icon: "Elevator" },
  // ... etc
] as const;
```

3. Add neighborhoods table to schema:
- city: v.string() (indexed)
- population: v.optional(v.number())
- avgPricePerSqm: v.number() // USD per square meter
- priceChange1Year: v.optional(v.number()) // percentage
- nearbyAmenities: v.array(v.string()) // ["schools", "parks", "shopping", "transit", "beaches", "hospitals"]
- description: v.optional(v.string())
- createdAt, updatedAt: v.number()

4. Add priceHistory table to schema:
- propertyId: v.optional(v.id("properties")) // null for area-wide data
- city: v.string() (indexed)
- date: v.number() // timestamp
- priceUsd: v.number() // price at that date
- eventType: v.union(v.literal("listing"), v.literal("sale"), v.literal("market_avg"))
- createdAt: v.number()

Do NOT add separate indexes for every field - use composite indexes where needed. Keep schema lean.
  </action>
  <verify>npx convex dev runs without schema errors, TypeScript compiles</verify>
  <done>Schema extended with amenities on properties, neighborhoods table, priceHistory table. All types generated correctly.</done>
</task>

<task type="auto">
  <name>Task 2: Create comprehensive seed data for new schema fields</name>
  <files>convex/seedData.ts, convex/seed.ts</files>
  <action>
1. Update SEED_PROPERTIES in seedData.ts to include amenities array for each property:
- Tel Aviv penthouse: ["airConditioning", "elevator", "parking", "balcony", "security", "renovated", "safeRoom"]
- Each property gets 4-8 realistic amenities based on type/price

2. Create SEED_NEIGHBORHOODS array in seedData.ts with data for all 9 cities:
```typescript
export const SEED_NEIGHBORHOODS = [
  {
    city: "Tel Aviv",
    population: 460000,
    avgPricePerSqm: 12500,
    priceChange1Year: 8.2,
    nearbyAmenities: ["beaches", "transit", "shopping", "restaurants", "parks"],
    description: "Israel's economic and cultural center..."
  },
  // Jerusalem, Herzliya, Haifa, Netanya, Ra'anana, Ashdod, Beer Sheva, Eilat
];
```

3. Create SEED_PRICE_HISTORY array with market average data points for each city:
- 12 monthly data points (past year) per city showing price trends
- Use realistic Israeli market prices (Tel Aviv highest, Beer Sheva lowest)
- eventType: "market_avg" for all entries

4. Create or update convex/seed.ts with seedNeighborhoods and seedPriceHistory functions:
- Clear existing data before seeding (use db.delete)
- Insert all neighborhoods
- Insert all price history entries
- Export functions for manual seeding

5. Update the existing seedProperties function to include amenities field.
  </action>
  <verify>Run seed functions via Convex dashboard or `npx convex run seed:seedNeighborhoods` and verify data appears in tables</verify>
  <done>All 15 properties have amenities, 9 neighborhoods seeded with stats, 108 price history entries (12 months x 9 cities) created.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npx convex dev` runs without errors
- [ ] Properties table shows amenities field in Convex dashboard
- [ ] Neighborhoods table has 9 entries (one per city)
- [ ] PriceHistory table has ~108 entries (12 months x 9 cities)
- [ ] TypeScript types generated correctly (check convex/_generated/)
</verification>

<success_criteria>
- Schema extended with all required tables and fields
- Seed data comprehensive and realistic
- No TypeScript or Convex errors
- Data queryable from dashboard
</success_criteria>

<output>
After completion, create `.planning/phases/05.4-yad2-property-page-layout/05.4-01-SUMMARY.md`
</output>
