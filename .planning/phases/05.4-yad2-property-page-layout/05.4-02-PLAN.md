---
phase: 05.4-yad2-property-page-layout
plan: 02
type: execute
---

<objective>
Create Yad2-style UI components: PropertyAmenities grid, MortgageCalculator with live calculations, and ValueHistoryChart using Shadcn charts.

Purpose: Build the core interactive components that make the property page informative and engaging like Yad2.
Output: Three reusable components ready for integration into property detail page.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior plan in this phase:
@.planning/phases/05.4-yad2-property-page-layout/05.4-01-SUMMARY.md

# Key source files:
@src/app/(app)/properties/[id]/page.tsx
@src/lib/constants.ts
@src/components/ui/chart.tsx
@src/components/ui/card.tsx
@src/components/ui/input.tsx
@src/components/ui/slider.tsx

**Tech stack available:** Shadcn charts (Recharts), Shadcn UI components
**Established patterns:**
- Components in src/components/properties/
- Constants in src/lib/constants.ts
- Card-based layout for property sections
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create PropertyAmenities component</name>
  <files>src/components/properties/PropertyAmenities.tsx</files>
  <action>
Create a component that displays property amenities in a clean grid layout (like Yad2's "מה יש בנכס" section).

Props:
- amenities: string[] (array of amenity keys)

Implementation:
1. Import PROPERTY_AMENITIES from constants
2. Map amenities to their labels and icons
3. Display in responsive grid (2 cols mobile, 3-4 cols desktop)
4. Each amenity shows icon + label
5. Use Hugeicons for icons - map amenity types to appropriate icons:
   - airConditioning → AirConditioning icon or similar
   - elevator → Elevator01Icon
   - parking → Car01Icon
   - storage → Box01Icon
   - balcony → Door01Icon
   - security → Shield01Icon
   - gym → Dumbbell01Icon
   - pool → Swimming01Icon (or wave icon)
   - garden → Tree01Icon
   - renovated → PaintBrush01Icon
   - furnished → Sofa01Icon
   - petFriendly → Dog01Icon
   - accessible → Wheelchair01Icon
   - safeRoom → ShieldCheck01Icon
   - solar → Sun01Icon

6. Wrap in Card with header "Property Amenities" (or Hebrew: "מה יש בנכס")
7. If no amenities, show "No amenities listed" message

Style: Use Badge or simple flex items with icon + text, muted colors, gap-3 grid.
  </action>
  <verify>Component renders without errors, displays amenities in grid layout</verify>
  <done>PropertyAmenities component created, displays amenities with icons in responsive grid, handles empty state.</done>
</task>

<task type="auto">
  <name>Task 2: Create MortgageCalculator component</name>
  <files>src/components/properties/MortgageCalculator.tsx</files>
  <action>
Create an interactive mortgage calculator (like Yad2's "מחשבון משכנתא").

Props:
- defaultPrice: number (property price in USD)

State:
- price: number (editable, defaults to property price)
- downPaymentPercent: number (default 25%)
- interestRate: number (default 5.5% - typical Israeli mortgage rate)
- termYears: number (default 25 years)

Calculations (standard amortization formula):
```typescript
const principal = price * (1 - downPaymentPercent / 100);
const monthlyRate = interestRate / 100 / 12;
const numPayments = termYears * 12;
const monthlyPayment = principal * (monthlyRate * Math.pow(1 + monthlyRate, numPayments)) / (Math.pow(1 + monthlyRate, numPayments) - 1);
const totalPayment = monthlyPayment * numPayments;
const totalInterest = totalPayment - principal;
```

UI Layout:
1. Card with header "Mortgage Calculator" (or "מחשבון משכנתא")
2. Input fields:
   - Property Price (Input with USD formatting)
   - Down Payment % (Slider 10-50%, or Input)
   - Interest Rate % (Input, step 0.1)
   - Loan Term (Select: 15, 20, 25, 30 years)
3. Results display:
   - Loan Amount: $X
   - Monthly Payment: $X (large, prominent)
   - Total Interest: $X
   - Total Payment: $X

Use Shadcn Input, Slider, Select components. Format numbers with Intl.NumberFormat.
Real-time calculation on any input change (no submit button needed).
  </action>
  <verify>Calculator renders, inputs work, calculations update in real-time, numbers format correctly</verify>
  <done>MortgageCalculator component with live calculations, all inputs functional, results display clearly.</done>
</task>

<task type="auto">
  <name>Task 3: Create ValueHistoryChart component</name>
  <files>src/components/properties/ValueHistoryChart.tsx, convex/priceHistory.ts</files>
  <action>
Create a price history chart showing area price trends (like Yad2's "היסטוריית שווי").

1. First, create convex/priceHistory.ts with query:
```typescript
import { query } from "./_generated/server";
import { v } from "convex/values";

export const getByCity = query({
  args: { city: v.string() },
  handler: async (ctx, args) => {
    return await ctx.db
      .query("priceHistory")
      .withIndex("by_city", (q) => q.eq("city", args.city))
      .order("asc") // oldest first for chart
      .collect();
  },
});
```

2. Create ValueHistoryChart component:

Props:
- city: string

Implementation:
- Fetch price history using useQuery(api.priceHistory.getByCity, { city })
- Use Shadcn Chart component (which wraps Recharts)
- Display as Area chart or Line chart
- X-axis: Date (formatted as MMM YYYY)
- Y-axis: Price per sqm (USD)
- Show loading skeleton while fetching
- Handle empty data gracefully

Chart config:
```typescript
const chartConfig = {
  pricePerSqm: {
    label: "Price/m²",
    color: "hsl(var(--chart-1))",
  },
} satisfies ChartConfig;
```

Wrap in Card with header "Price History - {city}" (or "היסטוריית שווי").
Include subtitle showing price change percentage if available.
  </action>
  <verify>Chart renders with seed data, shows 12 months of history, responsive sizing</verify>
  <done>ValueHistoryChart displays area price trends from priceHistory table, uses Shadcn chart, handles loading/empty states.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] PropertyAmenities renders grid of amenities with icons
- [ ] MortgageCalculator calculates correctly (verify: $500k, 25% down, 5.5%, 25yr = ~$2,300/mo)
- [ ] ValueHistoryChart shows price trend line for city
- [ ] All components handle loading/empty states
- [ ] `npm run build` passes
</verification>

<success_criteria>
- Three new components created and functional
- Calculations are accurate
- Chart displays historical data correctly
- Components ready for page integration
</success_criteria>

<output>
After completion, create `.planning/phases/05.4-yad2-property-page-layout/05.4-02-SUMMARY.md`
</output>
