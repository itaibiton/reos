---
phase: 04-property-marketplace
plan: 01
type: execute
---

<objective>
Create property schema and admin upload functionality.

Purpose: Establish the data model for properties and provide a way to add listings.
Output: Properties table in Convex, admin upload form for adding properties.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-profiles/03-04-SUMMARY.md

**Key files:**
@convex/schema.ts
@src/lib/constants.ts

**Tech stack available:** Next.js 16, Convex, Shadcn/ui, Clerk, Tailwind v4
**Established patterns:** Two-column form layouts, MultiSelectPopover for selections, toast notifications

**Constraining decisions:**
- Phase 3: Shared constants in src/lib/constants.ts
- Phase 2: User roles: investor, broker, mortgage_advisor, lawyer
- Currency: Must handle USD â†” ILS display
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add properties table to Convex schema</name>
  <files>convex/schema.ts, convex/properties.ts</files>
  <action>
Add properties table to schema with fields:

**Core fields:**
- title: string
- description: string
- address: string
- city: string (Israeli city from ISRAELI_LOCATIONS)
- propertyType: union (residential, commercial, mixed_use, land)
- status: union (available, pending, sold)

**Pricing:**
- priceUsd: number
- priceIls: number (calculated or entered)

**Investment metrics:**
- expectedRoi: optional number (percentage)
- cashOnCash: optional number (percentage)
- capRate: optional number (percentage)
- monthlyRent: optional number (USD)

**Property details:**
- bedrooms: optional number
- bathrooms: optional number
- squareMeters: optional number
- yearBuilt: optional number

**Media:**
- images: array of strings (URLs for now, file storage later)
- featuredImage: optional string (main image URL)

**Metadata:**
- createdBy: v.id("users") - admin who uploaded
- createdAt, updatedAt: numbers

**Indexes:**
- by_city
- by_property_type
- by_status
- by_price (priceUsd)

Create convex/properties.ts with:
- list query (filter by status=available, paginated)
- getById query
- create mutation (admin only - check user role)
- update mutation (admin only)

For MVP, any authenticated user can add properties (no strict admin check yet).
  </action>
  <verify>npx convex dev runs without errors, schema validates</verify>
  <done>Properties table defined, basic CRUD functions created</done>
</task>

<task type="auto">
  <name>Task 2: Create admin property upload form</name>
  <files>src/app/(app)/properties/new/page.tsx, src/components/properties/PropertyForm.tsx</files>
  <action>
Create property upload form at /properties/new:

1. Create PropertyForm component with two-column layout (matching profile forms):
   - Left column: Title, Description, Address, City (dropdown), Property Type (radio)
   - Right column: Price USD, Price ILS (auto-calculate with rate ~3.7), Investment Metrics (ROI, Cap Rate, Cash-on-Cash, Monthly Rent)

2. Second row for property details:
   - Bedrooms, Bathrooms, Square Meters, Year Built

3. Images section:
   - Text input for image URLs (comma-separated for now)
   - Featured image selector

4. Form validation:
   - Required: title, address, city, propertyType, priceUsd
   - Price must be positive numbers

5. Submit calls create mutation, shows toast, redirects to /properties

Use existing UI patterns:
- RadioGroup for property type
- Input for text/numbers
- Textarea for description
- MultiSelectPopover or Select for city
- Toast for success/error feedback

Add PROPERTY_STATUS constant to src/lib/constants.ts.
  </action>
  <verify>npm run build succeeds, form renders at /properties/new</verify>
  <done>Property upload form works, saves to Convex, shows success toast</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Properties table in schema with all fields
- [ ] Convex queries/mutations work
- [ ] Form at /properties/new renders
- [ ] Can submit form and see property in Convex dashboard
- [ ] `npm run build` succeeds
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- Properties can be created via form
- Data persists in Convex
</success_criteria>

<output>
After completion, create `.planning/phases/04-property-marketplace/04-01-SUMMARY.md`:

# Phase 4 Plan 1: Property Schema + Admin Upload Summary

**[One-liner summarizing what shipped]**

## Accomplishments

- [Key outcome 1]
- [Key outcome 2]

## Files Created/Modified

- `path/to/file.ts` - Description

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

Ready for 04-02-PLAN.md: Property Listings Page
</output>
