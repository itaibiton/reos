---
phase: 04-property-marketplace
plan: 03
type: execute
---

<objective>
Create property detail page and favorites functionality.

Purpose: Allow investors to view full property details and save properties of interest.
Output: Detail page with investment metrics, save/unsave functionality.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-property-marketplace/04-01-SUMMARY.md
@.planning/phases/04-property-marketplace/04-02-SUMMARY.md

**Key files:**
@convex/properties.ts
@convex/schema.ts
@src/components/properties/PropertyCard.tsx

**Tech stack available:** Next.js 16, Convex, Shadcn/ui, Tailwind v4
**Established patterns:** Two-column layouts, responsive grids
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create property detail page</name>
  <files>src/app/(app)/properties/[id]/page.tsx</files>
  <action>
Create dynamic route for property details at /properties/[id]:

**Layout (two-column on desktop):**

Left column (wider, ~60%):
- Image gallery (featured image large, thumbnails below if multiple)
- Property description (full text)

Right column (sticky on desktop):
- Price section: USD price large, ILS equivalent, status badge
- Investment metrics card:
  - Expected ROI: X%
  - Cap Rate: X%
  - Cash-on-Cash: X%
  - Monthly Rent: $X
- Property details card:
  - Bedrooms, Bathrooms, Size (sqm), Year Built
  - Property Type, City
- Action buttons:
  - Save/Unsave button (heart icon, toggles)
  - "Contact Broker" button (placeholder, links to #)

**Header:**
- Back button to /properties
- Property title
- Address and city

Use Convex useQuery with property ID from params.
Handle loading state (skeleton) and not-found state (redirect or error).

Format all currency and percentages properly.
  </action>
  <verify>npm run build succeeds, page renders at /properties/[valid-id]</verify>
  <done>Property detail page shows all information with proper layout</done>
</task>

<task type="auto">
  <name>Task 2: Add favorites functionality</name>
  <files>convex/schema.ts, convex/favorites.ts, src/components/properties/SaveButton.tsx</files>
  <action>
1. Add favorites table to schema:
   - userId: v.id("users")
   - propertyId: v.id("properties")
   - createdAt: number
   - Index: by_user, by_property, by_user_and_property (compound)

2. Create convex/favorites.ts with:
   - isSaved(propertyId): query - check if current user saved this property
   - toggle(propertyId): mutation - add if not saved, remove if saved
   - listMyFavorites(): query - get all saved properties for current user

3. Create SaveButton component:
   - Props: propertyId
   - Uses isSaved query to show filled/outline heart
   - Calls toggle mutation on click
   - Shows loading state during mutation
   - Uses Hugeicons heart icon (HeartIcon or similar)

4. Integrate SaveButton into:
   - Property detail page (in action buttons)
   - PropertyCard (top-right corner overlay)

Make save button work for authenticated users only. Show login prompt or disable for unauthenticated.
  </action>
  <verify>npm run build succeeds, save button toggles correctly</verify>
  <done>Users can save/unsave properties, state persists across page loads</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Property detail page renders with all sections
- [ ] Investment metrics display correctly
- [ ] Favorites table in schema
- [ ] Save button toggles and persists
- [ ] PropertyCard shows save button
- [ ] `npm run build` succeeds
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- Detail page shows comprehensive property info
- Save functionality works end-to-end
</success_criteria>

<output>
After completion, create `.planning/phases/04-property-marketplace/04-03-SUMMARY.md`:

# Phase 4 Plan 3: Property Detail Page Summary

**[One-liner summarizing what shipped]**

## Accomplishments

- [Key outcome 1]
- [Key outcome 2]

## Files Created/Modified

- `path/to/file.ts` - Description

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

Ready for 04-04-PLAN.md: Final Integration
</output>
