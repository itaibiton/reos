---
phase: 03-profiles
plan: 04
type: execute
---

<objective>
Create unified settings page with role-based profile view and integrate into navigation.

Purpose: Users need a central place to view and manage their profile regardless of role.
Output: Settings page that routes to correct profile form, sidebar integration.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-profiles/03-01-SUMMARY.md
@.planning/phases/03-profiles/03-02-SUMMARY.md
@.planning/phases/03-profiles/03-03-SUMMARY.md

**Key files:**
@src/components/layout/Sidebar.tsx
@src/app/(app)/dashboard/page.tsx
@src/hooks/useCurrentUser.ts

**Prior work:**
- 03-02: Investor profile at /profile/investor
- 03-03: Service provider profile at /profile/provider
- Sidebar already has Settings link to /settings
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create settings page with role-based routing</name>
  <files>src/app/(app)/settings/page.tsx</files>
  <action>
Create settings page at /settings that:

1. Uses useCurrentUser to get user's role
2. Shows loading skeleton while user loads
3. Displays profile section based on role:
   - Investor → Embed or link to investor profile form
   - Broker/Mortgage Advisor/Lawyer → Embed or link to provider profile form

4. Additional settings sections (placeholders for now):
   - Account Settings: Link to Clerk user profile (or embed UserProfile component)
   - Notifications: Placeholder card "Coming soon"

UI Structure:
```
Settings
├── Profile (role-based form embedded or linked)
├── Account (Clerk UserProfile or manage account link)
└── Notifications (placeholder)
```

Option A (Embedded): Import profile form components and render inline
Option B (Linked): Show cards with links to /profile/investor or /profile/provider

Recommend Option A for better UX - profile form embedded directly in settings.

Refactor profile forms into reusable components if needed:
- src/components/profile/InvestorProfileForm.tsx
- src/components/profile/ProviderProfileForm.tsx

Then settings page imports and renders the appropriate form.
  </action>
  <verify>
- npm run build succeeds
- Page renders at /settings
  </verify>
  <done>Settings page shows role-appropriate profile form</done>
</task>

<task type="auto">
  <name>Task 2: Update sidebar with profile completion indicator</name>
  <files>src/components/layout/Sidebar.tsx</files>
  <action>
Update Sidebar to show profile completion status:

1. Import and use useCurrentUser hook (make Sidebar a client component if not already)
2. For Settings nav item, optionally show indicator if profile incomplete:
   - Query investor/provider profile based on role
   - If no profile exists, show dot/badge on Settings item

Alternative simpler approach:
- Just ensure Settings link works correctly
- Profile completion indicator can be added in future phase

For now, confirm:
- Settings link points to /settings
- Dashboard link points to /dashboard
- All nav items working

Add "Profile" as a sub-item under Settings if desired, or keep settings as single entry.
  </action>
  <verify>
- Sidebar renders correctly
- Settings link navigates to /settings
- npm run build succeeds
  </verify>
  <done>Sidebar navigation includes working settings/profile access</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete profile system with onboarding and role-based profiles</what-built>
  <how-to-verify>
    1. Run: npm run dev (and npx convex dev)

    **Test Investor Flow:**
    2. Sign out and create new account
    3. Select "Investor" role in onboarding
    4. Navigate to /settings
    5. Fill out investor profile (property types, budget, etc.)
    6. Save and verify data persists on page refresh

    **Test Service Provider Flow:**
    7. Sign out and create another new account
    8. Select "Broker" role in onboarding
    9. Navigate to /settings
    10. Verify broker-specific specializations shown
    11. Fill out provider profile
    12. Save and verify data persists

    **Test Navigation:**
    13. Verify sidebar Settings link works
    14. Verify Dashboard link works
    15. Verify onboarded users can't access /onboarding
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Settings page renders correctly
- [ ] Investor sees investor profile form
- [ ] Service provider sees provider profile form
- [ ] Sidebar navigation works
- [ ] Profile data saves and loads correctly
- [ ] Complete flow works end-to-end
- [ ] `npm run build` succeeds
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- Complete profile management flow working
- Phase 3: Profiles complete
</success_criteria>

<output>
After completion, create `.planning/phases/03-profiles/03-04-SUMMARY.md`:

# Phase 3 Plan 4: Profile Settings Page Summary

**[One-liner summarizing what shipped]**

## Accomplishments

- [Key outcome 1]
- [Key outcome 2]

## Files Created/Modified

- `path/to/file.ts` - Description

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Phase Readiness

Phase 3 complete, ready for Phase 4: Property Marketplace
</output>
