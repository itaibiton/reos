# Plan 58-01: Client List View with Filtering and Document Access

## Overview

Build backend queries and UI for vendors to view their clients (investors assigned to their deals), filter/search them, and access per-client documents grouped by deal.

## Changes

### 1. Backend: Client Management Queries (convex/clientManagement.ts — NEW FILE)

Create new Convex file with vendor-facing client queries:

**Query: `getMyClients`**
- Auth check: must be authenticated service provider
- Based on user role, query deals using existing indexes (by_broker, by_mortgage_advisor, by_lawyer)
- For each deal, fetch investor user data (name, email, imageUrl)
- Return array of: `{ investorId, investorName, investorEmail, investorImage, dealId, propertyTitle, currentStage, createdAt }`
- Deduplicate by investorId (one investor may have multiple deals with same provider)
- Sort by most recent deal first

**Query: `getClientDeals`**
- Args: `{ clientId: v.id("users") }`
- Returns all deals between current provider and specified client
- Enriched with property data (title, address, city, price, image)
- Access check: provider must be assigned to the deals

**Query: `getClientDocuments`**
- Args: `{ dealId: v.id("deals") }`
- Returns all dealFiles for a specific deal via `by_deal` index
- Access check: current user must be participant in the deal
- Include file metadata: fileName, fileType, fileSize, category, description, createdAt, uploadedBy
- Generate download URLs via `ctx.storage.getUrl()`

### 2. Client List Page (src/app/[locale]/(app)/dashboard/clients/page.tsx — NEW)

- Server component with metadata
- Renders `ClientListContent` client component

### 3. Client List Content (src/components/vendor/ClientListContent.tsx — NEW)

- Uses `getMyClients` query
- Desktop: table layout (Name, Email, Property, Stage, Date, Actions)
- Mobile: card layout
- Search/filter by client name
- Stage badge with colors from deal-constants
- Click row → navigate to `/dashboard/clients/[clientId]`
- Empty state for no clients
- Loading skeleton

### 4. Client Detail Page (src/app/[locale]/(app)/dashboard/clients/[clientId]/page.tsx — NEW)

- Server component with dynamic params
- Renders `ClientDetailContent`

### 5. Client Detail Content (src/components/vendor/ClientDetailContent.tsx — NEW)

- Uses `getClientDeals` query
- Header: client name, email, total deals count
- For each deal: card showing property info, current stage, stage badge
- Document section per deal using `getClientDocuments`
- Document list: filename, category badge, size, download button
- Empty state for no documents
- File download via Convex storage URL

### 6. i18n (messages/en.json + messages/he.json)

Add `clientManagement` namespace:
- Page titles, column headers, labels
- Empty states, loading states
- Document categories, stage labels
- Filter/search placeholders
- ~60 keys per language

## Verification

- [ ] `npx tsc --noEmit` passes
- [ ] Client list shows only deals where current provider is assigned
- [ ] Client detail shows documents grouped by deal
- [ ] i18n complete for EN and HE
