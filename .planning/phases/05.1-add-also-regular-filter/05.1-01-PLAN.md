---
phase: 05.1-add-also-regular-filter
plan: 01
type: execute
---

<objective>
Add traditional filter controls alongside smart search for users who prefer explicit dropdowns and inputs.

Purpose: Provide an alternative to NL search for users who want direct control over filter selection.
Output: PropertyFilters component integrated into marketplace page, working in tandem with smart search.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior phase context (Phase 5 - Smart Search):
@.planning/phases/05-smart-search/05-03-SUMMARY.md

# Key source files:
@src/app/(app)/properties/page.tsx
@src/components/search/SearchInput.tsx
@src/components/search/FilterChips.tsx
@convex/search.ts
@src/lib/constants.ts

**Tech stack available:**
- Shadcn/ui components (Select, Input, Button, Popover)
- Hugeicons for icons
- PROPERTY_TYPES, ISRAELI_LOCATIONS constants ready to use
- PropertyFilters type from convex/search.ts

**Established patterns:**
- Search state management in properties page (query, filters, isSearching)
- Filter chip removal with grouped handling
- Two-column form layouts (lg:grid-cols-2)

**Constraining decisions:**
- Phase 5: PropertyFilters type already defined with city, propertyType, price range, bedrooms, bathrooms, size range
- Phase 5: In-memory filtering after index query (Convex limitation)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create PropertyFiltersPanel component</name>
  <files>src/components/search/PropertyFiltersPanel.tsx</files>
  <action>
Create a collapsible filter panel component with:

1. **Structure:**
   - Collapsible panel using Collapsible component from Shadcn
   - Toggle button with "Filters" label and ChevronDown icon
   - Grid layout for filters (lg:grid-cols-3 gap-4)

2. **Filter controls:**
   - **City**: Select dropdown using ISRAELI_LOCATIONS from constants
   - **Property Type**: Select dropdown using PROPERTY_TYPES from constants
   - **Price Range**: Two Input fields (Min/Max) with $ prefix, type="number"
   - **Bedrooms**: Select with options 1-5+ (Any, 1+, 2+, 3+, 4+, 5+)
   - **Bathrooms**: Select with options 1-4+ (Any, 1+, 2+, 3+, 4+)
   - **Size Range**: Two Input fields (Min/Max) in sqm, type="number"

3. **Props interface:**
   ```typescript
   interface PropertyFiltersPanelProps {
     filters: PropertyFilters;
     onFiltersChange: (filters: PropertyFilters) => void;
   }
   ```

4. **Behavior:**
   - Each control updates filters immediately on change (no submit button)
   - "Clear All" button resets all filters to empty object
   - Empty/undefined values should NOT be included in filters object

5. **Styling:**
   - Use consistent spacing with existing search section
   - Labels above each control
   - Compact but readable layout
  </action>
  <verify>Component exists and exports correctly: grep -l "PropertyFiltersPanel" src/components/search/</verify>
  <done>PropertyFiltersPanel component created with all filter controls</done>
</task>

<task type="auto">
  <name>Task 2: Integrate filters into marketplace page</name>
  <files>src/app/(app)/properties/page.tsx</files>
  <action>
Integrate PropertyFiltersPanel into the marketplace page:

1. **Import** PropertyFiltersPanel component

2. **Add to search section** (below SearchInput, above FilterChips):
   ```tsx
   <PropertyFiltersPanel
     filters={filters}
     onFiltersChange={handleFiltersChange}
   />
   ```

3. **Create handleFiltersChange handler:**
   - Updates filters state directly
   - Clears searchQuery when manual filters are applied (to avoid confusion about filter source)
   - Preserves existing filter removal logic

4. **Layout:**
   - SearchInput stays at top
   - PropertyFiltersPanel below (collapsible)
   - FilterChips below both (shows active filters from either source)

5. **Interaction between search and filters:**
   - When user types in SearchInput and submits → AI parses and sets filters
   - When user changes manual filters → updates filters directly
   - FilterChips reflect whichever filters are active
   - Clearing all filters resets both searchQuery and filters
  </action>
  <verify>npm run build passes and page renders without errors</verify>
  <done>PropertyFiltersPanel integrated, manual filters work alongside smart search</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Traditional filter controls alongside smart search</what-built>
  <how-to-verify>
    1. Run: npm run dev
    2. Visit: http://localhost:3000/properties
    3. Click "Filters" to expand the filter panel
    4. Test: Select a city from dropdown → properties filter immediately
    5. Test: Select property type → additional filtering applied
    6. Test: Enter price range (e.g., 100000-500000) → filters apply
    7. Test: Select bedrooms minimum → filters apply
    8. Test: Click "Clear All" → all filters reset
    9. Test: Use smart search → filter chips show parsed filters
    10. Confirm: Both filter methods work and FilterChips reflects active filters
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `npm run build` succeeds without errors
- [ ] PropertyFiltersPanel component created with all controls
- [ ] Filters panel integrates with existing search state
- [ ] Both smart search and manual filters update the same filters state
- [ ] FilterChips correctly displays filters from either source
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No TypeScript errors
- Traditional filters work alongside smart search
- User can filter properties using dropdowns/inputs
- Filters and smart search share the same state
</success_criteria>

<output>
After completion, create `.planning/phases/05.1-add-also-regular-filter/05.1-01-SUMMARY.md`
</output>
