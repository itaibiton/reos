---
phase: 55-contact-and-provider-landing-pages
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - convex/schema.ts
  - convex/contactSubmissions.ts
  - src/app/[locale]/(main)/contact/ContactPageContent.tsx
  - src/app/[locale]/(main)/contact/page.tsx
  - src/app/[locale]/(main)/contact/thank-you/page.tsx
  - messages/en.json
  - messages/he.json
autonomous: true

must_haves:
  truths:
    - "User can fill out and submit a contact form at /contact that saves to Convex"
    - "Form validates with inline Zod errors on submit (name min 2 chars, valid email, subject required, message required)"
    - "Subject dropdown pre-selects based on ?subject= URL parameter"
    - "Honeypot anti-spam field is hidden from real users but catches bots"
    - "After successful submission, user is redirected to /contact/thank-you page"
    - "Alternative contact methods (email, phone) are visible alongside the form"
  artifacts:
    - path: "convex/schema.ts"
      provides: "contactSubmissions table definition"
      contains: "contactSubmissions"
    - path: "convex/contactSubmissions.ts"
      provides: "submit mutation and listSubmissions query"
      exports: ["submit", "listSubmissions"]
    - path: "src/app/[locale]/(main)/contact/ContactPageContent.tsx"
      provides: "Contact form with react-hook-form + Zod + Convex mutation + honeypot + Suspense"
      contains: "useForm"
    - path: "src/app/[locale]/(main)/contact/thank-you/page.tsx"
      provides: "Thank-you confirmation page with metadata"
  key_links:
    - from: "ContactPageContent.tsx"
      to: "convex/contactSubmissions.ts"
      via: "useMutation(api.contactSubmissions.submit)"
      pattern: "api\\.contactSubmissions\\.submit"
    - from: "ContactPageContent.tsx"
      to: "/contact/thank-you"
      via: "router.push after await submitContact"
      pattern: "router\\.push.*thank-you"
    - from: "ContactPageContent.tsx"
      to: "useSearchParams"
      via: "Suspense-wrapped component reading ?subject= param"
      pattern: "useSearchParams"
---

<objective>
Upgrade the contact page from a static HTML form to a fully functional form with Convex backend, react-hook-form + Zod validation, honeypot anti-spam, URL parameter pre-selection, and a thank-you redirect page.

Purpose: Enable real contact form submissions that persist to Convex, with proper validation and anti-spam measures (CONTACT-01 through CONTACT-10).
Output: Working contact form that saves to Convex, redirects to thank-you page, supports URL-based subject pre-selection.
</objective>

<execution_context>
@/Users/Kohelet/.claude/get-shit-done/workflows/execute-plan.md
@/Users/Kohelet/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/55-contact-and-provider-landing-pages/55-RESEARCH.md

# Reference implementations
@src/components/landing/ContactForm/ContactFormSection.tsx
@convex/leads.ts
@convex/schema.ts
@src/app/[locale]/(main)/contact/ContactPageContent.tsx
@src/app/[locale]/(main)/contact/page.tsx
@src/app/[locale]/(main)/pricing/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Convex contactSubmissions backend</name>
  <files>
    convex/schema.ts
    convex/contactSubmissions.ts
  </files>
  <action>
    1. Add `contactSubmissions` table to `convex/schema.ts` (after the `leads` table section):

    ```
    contactSubmissions: defineTable({
      name: v.string(),
      email: v.string(),
      phone: v.optional(v.string()),
      subject: v.union(
        v.literal("general"),
        v.literal("pricing"),
        v.literal("support"),
        v.literal("partnerships"),
        v.literal("provider")
      ),
      message: v.string(),
      createdAt: v.number(),
    })
      .index("by_email", ["email"])
      .index("by_created", ["createdAt"])
      .index("by_subject", ["subject"]),
    ```

    2. Create `convex/contactSubmissions.ts` modeled on `convex/leads.ts`:
    - `submit` mutation: accepts {name, email, phone?, subject, message}, inserts with createdAt: Date.now(), returns { submissionId }
    - `listSubmissions` query: takes optional limit (default 50), queries by_created desc, returns submissions

    IMPORTANT: Subject enum values must be exactly: "general", "pricing", "support", "partnerships", "provider" -- these must match the Zod schema on the client AND the i18n keys.
  </action>
  <verify>
    Run `npx convex dev --once` or check that TypeScript compiles without errors for the Convex files. Verify the generated API types include `api.contactSubmissions.submit`.
  </verify>
  <done>
    contactSubmissions table defined in schema.ts with 3 indexes. contactSubmissions.ts exports submit mutation and listSubmissions query. Subject enum has exactly 5 values matching client schema.
  </done>
</task>

<task type="auto">
  <name>Task 2: Rewrite ContactPageContent with full validation stack + thank-you page</name>
  <files>
    src/app/[locale]/(main)/contact/ContactPageContent.tsx
    src/app/[locale]/(main)/contact/page.tsx
    src/app/[locale]/(main)/contact/thank-you/page.tsx
    messages/en.json
    messages/he.json
  </files>
  <action>
    **A. Update i18n subject keys (messages/en.json and messages/he.json):**

    Change `contact.form.subjects` to align with Convex enum values:
    - Remove "sales" and "media" keys
    - Add "pricing" (was "sales" -> "Sales & pricing" becomes "Pricing question")
    - Add "provider" ("Become a provider")
    - Final subjects: { general: "General inquiry", pricing: "Pricing question", support: "Technical support", partnerships: "Partnerships", provider: "Become a provider" }
    - Hebrew equivalents: { general: "פנייה כללית", pricing: "שאלת תמחור", support: "תמיכה טכנית", partnerships: "שותפויות", provider: "הצטרפות כספק שירות" }

    Add thank-you page i18n under `contact.thankYou`:
    - EN: { title: "Thank you!", description: "Your message has been sent successfully. Our team will get back to you within one business day.", backToHome: "Back to home", sendAnother: "Send another message" }
    - HE: { title: "!תודה", description: "ההודעה שלך נשלחה בהצלחה. הצוות שלנו יחזור אליך תוך יום עסקים אחד.", backToHome: "חזרה לדף הבית", sendAnother: "שליחת הודעה נוספת" }

    Also add validation error i18n under `contact.form.errors`:
    - EN: { nameMin: "Name must be at least 2 characters", emailInvalid: "Please enter a valid email address", subjectRequired: "Please select a subject", messageRequired: "Message is required", submitFailed: "Failed to submit. Please try again." }
    - HE: { nameMin: "השם חייב להכיל לפחות 2 תווים", emailInvalid: "נא להזין כתובת אימייל תקינה", subjectRequired: "נא לבחור נושא", messageRequired: "הודעה היא שדה חובה", submitFailed: "השליחה נכשלה. נא לנסות שוב." }

    **B. Rewrite ContactPageContent.tsx:**

    Replace the current basic HTML form with react-hook-form + Zod + Convex mutation pattern. Follow the `ContactFormSection.tsx` landing component as reference.

    Structure the component with a Suspense boundary (Next.js 15 requirement for useSearchParams):

    ```
    // Outer component wraps in Suspense
    export function ContactPageContent() {
      return (
        <Suspense fallback={<ContactPageSkeleton />}>
          <ContactPageInner />
        </Suspense>
      );
    }

    // Inner component uses useSearchParams
    function ContactPageInner() {
      const searchParams = useSearchParams();
      const subjectParam = searchParams.get("subject");
      // ... form logic
    }
    ```

    Key implementation details:
    - Import: `useForm` from "react-hook-form", `zodResolver` from "@hookform/resolvers/zod", `z` from "zod/v4", `useMutation` from "convex/react", `api` from convex
    - Zod schema with 5 fields: name (min 2), email (z.email()), phone (optional string), subject (z.enum), message (min 1), honeypot (string max 0)
    - Use Shadcn Form, FormField, FormItem, FormLabel, FormControl, FormMessage components (from `@/components/ui/form`)
    - defaultValues: set subject from URL param if valid, otherwise undefined
    - useEffect to update subject when URL param changes (validate against enum values)
    - onSubmit: await submitContact mutation, then router.push(`/${locale}/contact/thank-you`)
    - Honeypot field: input with `style={{ position: "absolute", left: "-9999px" }}`, tabIndex={-1}, autoComplete="off", aria-hidden="true". Name it "website" (not "honeypot") to better trick bots.
    - Use `useTranslations("contact")` for all user-facing text -- never hardcode strings
    - Preserve existing dark hero section, contact info sidebar layout, and framer-motion animations
    - Preserve the alternative contact methods (email, phone, office) sidebar exactly as-is
    - Add `isSubmitting` state from form.formState for loading indicator on submit button
    - Handle root errors with form.setError("root", ...) and display below form

    AVOID:
    - Do NOT use `display: none` for honeypot (bots detect it) -- use position: absolute with negative left
    - Do NOT call router.push before awaiting the mutation (data loss)
    - Do NOT use useSearchParams without Suspense wrapper (Next.js 15 build failure)
    - Do NOT hardcode form labels -- use t() translations

    **C. Create thank-you page:**

    Create `src/app/[locale]/(main)/contact/thank-you/page.tsx`:
    - Server component with generateMetadata (using contact.thankYou namespace)
    - Simple centered layout matching the dark hero styling of the contact page
    - Dark hero section with checkmark icon, thank-you title, description about response time
    - Two CTA buttons: "Back to home" (link to /{locale}) and "Send another message" (link to /{locale}/contact)
    - Use framer-motion fadeInUp animation consistent with other pages
    - Use next-intl getTranslations for metadata, useTranslations for client content
    - Create a ThankYouContent client component for the animated content

    **D. Minor update to contact/page.tsx:**
    - No changes needed -- the existing server component with generateMetadata already works correctly. ContactPageContent is already imported and rendered.
  </action>
  <verify>
    1. Run `npx tsc --noEmit` to verify TypeScript compilation
    2. Run `npm run build` to verify Next.js build passes (especially Suspense boundary check)
    3. Navigate to /en/contact -- form renders with all fields
    4. Navigate to /en/contact?subject=pricing -- pricing pre-selected in dropdown
    5. Submit empty form -- inline validation errors appear
    6. Fill valid form and submit -- redirects to /en/contact/thank-you
    7. Navigate to /he/contact -- Hebrew translations display correctly
  </verify>
  <done>
    Contact form uses react-hook-form + Zod validation with Convex mutation. Honeypot field hidden from users. Subject pre-selects from URL param via Suspense-wrapped useSearchParams. Successful submission redirects to thank-you page. All text uses i18n translations in EN and HE. Alternative contact methods (email, phone, office) visible in sidebar.
  </done>
</task>

</tasks>

<verification>
1. Convex schema includes contactSubmissions table with correct fields and indexes
2. Contact form at /contact validates inputs with Zod and shows FormMessage errors
3. Successful form submission creates a record in Convex contactSubmissions table
4. /contact?subject=pricing pre-selects the pricing option
5. Honeypot field is invisible to users but present in DOM
6. After submission, user sees /contact/thank-you page
7. Both EN and HE translations work for all contact page content
8. Build passes without Suspense boundary warnings
</verification>

<success_criteria>
- CONTACT-01: Contact page exists at /contact with inquiry form
- CONTACT-02: Form has name, email, subject dropdown, message, optional phone
- CONTACT-03: Form validates with inline errors (Zod + react-hook-form)
- CONTACT-04: Submission saves to Convex contactSubmissions table
- CONTACT-05: Success confirmation via thank-you page redirect
- CONTACT-06: Honeypot anti-spam field present and hidden
- CONTACT-07: Alternative contact methods shown (email, phone)
- CONTACT-08: EN and HE i18n for all content
- CONTACT-09: Proper Next.js metadata on contact and thank-you pages
- CONTACT-10: Subject pre-selects from URL parameter
</success_criteria>

<output>
After completion, create `.planning/phases/55-contact-and-provider-landing-pages/55-01-SUMMARY.md`
</output>
