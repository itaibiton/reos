---
phase: 25-user-following
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/feed/FollowStats.tsx
  - src/components/feed/FollowListDialog.tsx
  - src/components/feed/index.ts
autonomous: true

must_haves:
  truths:
    - "User can see follower count for any user"
    - "User can see following count for any user"
    - "User can view list of followers"
    - "User can view list of following"
  artifacts:
    - path: "src/components/feed/FollowStats.tsx"
      provides: "Follower/following count display with click to view lists"
      min_lines: 30
    - path: "src/components/feed/FollowListDialog.tsx"
      provides: "Dialog showing followers or following list"
      min_lines: 60
  key_links:
    - from: "src/components/feed/FollowStats.tsx"
      to: "convex/userFollows.ts"
      via: "useQuery"
      pattern: "api\\.userFollows\\.getFollowCounts"
    - from: "src/components/feed/FollowListDialog.tsx"
      to: "convex/userFollows.ts"
      via: "useQuery"
      pattern: "api\\.userFollows\\.(getFollowers|getFollowing)"
---

<objective>
Create follower/following count display and list viewing components for user profiles.

Purpose: Show social proof and enable users to discover who follows whom
Output: FollowStats component + FollowListDialog for viewing follower/following lists
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@convex/userFollows.ts (getFollowCounts, getFollowers, getFollowing queries)
@src/app/(app)/providers/[id]/page.tsx (provider profile page pattern)
@src/components/ui/dialog.tsx (Shadcn Dialog)
@src/components/ui/avatar.tsx (Shadcn Avatar)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create FollowStats component</name>
  <files>src/components/feed/FollowStats.tsx</files>
  <action>
Create FollowStats component to display follower/following counts:

1. Create `src/components/feed/FollowStats.tsx`:
   - Props: `userId: Id<"users">`
   - Query `api.userFollows.getFollowCounts` with userId
   - Display format: "X followers | Y following"
   - Make counts clickable to open follower/following list dialog
   - Manage dialog state internally

Component structure:
```tsx
"use client";

import { useState } from "react";
import { useQuery } from "convex/react";
import { api } from "../../../convex/_generated/api";
import { Id } from "../../../convex/_generated/dataModel";
import { FollowListDialog } from "./FollowListDialog";

interface FollowStatsProps {
  userId: Id<"users">;
}

export function FollowStats({ userId }: FollowStatsProps) {
  const counts = useQuery(api.userFollows.getFollowCounts, { userId });
  const [dialogType, setDialogType] = useState<"followers" | "following" | null>(null);

  if (counts === undefined) {
    return (
      <div className="flex items-center gap-3 text-sm text-muted-foreground">
        <span>-- followers</span>
        <span>|</span>
        <span>-- following</span>
      </div>
    );
  }

  return (
    <>
      <div className="flex items-center gap-3 text-sm">
        <button
          onClick={() => setDialogType("followers")}
          className="hover:underline"
        >
          <span className="font-semibold">{counts.followerCount}</span>{" "}
          <span className="text-muted-foreground">followers</span>
        </button>
        <span className="text-muted-foreground">|</span>
        <button
          onClick={() => setDialogType("following")}
          className="hover:underline"
        >
          <span className="font-semibold">{counts.followingCount}</span>{" "}
          <span className="text-muted-foreground">following</span>
        </button>
      </div>

      <FollowListDialog
        userId={userId}
        type={dialogType}
        open={dialogType !== null}
        onOpenChange={(open) => !open && setDialogType(null)}
      />
    </>
  );
}
```

Styling notes:
- Keep inline/horizontal for compact display
- Use hover:underline for clickable indication
- Font-semibold for count numbers
- text-muted-foreground for labels
  </action>
  <verify>
    - File exists: `ls src/components/feed/FollowStats.tsx`
    - Uses getFollowCounts: `grep -q "getFollowCounts" src/components/feed/FollowStats.tsx`
    - Has click handlers: `grep -q "setDialogType" src/components/feed/FollowStats.tsx`
  </verify>
  <done>FollowStats component displays counts with click-to-view list functionality</done>
</task>

<task type="auto">
  <name>Task 2: Create FollowListDialog component</name>
  <files>src/components/feed/FollowListDialog.tsx</files>
  <action>
Create FollowListDialog to show followers or following list:

1. Create `src/components/feed/FollowListDialog.tsx`:
   - Props: `userId`, `type: "followers" | "following" | null`, `open`, `onOpenChange`
   - Query `getFollowers` or `getFollowing` based on type
   - Display list of users with avatar, name, role badge
   - Include FollowButton for each user in the list (except for current user)
   - Empty state when no followers/following

Component structure:
```tsx
"use client";

import { useQuery } from "convex/react";
import { api } from "../../../convex/_generated/api";
import { Id } from "../../../convex/_generated/dataModel";
import {
  Dialog,
  DialogContent,
  DialogHeader,
  DialogTitle,
} from "@/components/ui/dialog";
import { Avatar, AvatarFallback, AvatarImage } from "@/components/ui/avatar";
import { Badge } from "@/components/ui/badge";
import { ScrollArea } from "@/components/ui/scroll-area";
import { FollowButton } from "./FollowButton";
import { Users } from "lucide-react";

// Role labels
const ROLE_LABELS: Record<string, string> = {
  investor: "Investor",
  broker: "Broker",
  mortgage_advisor: "Mortgage Advisor",
  lawyer: "Lawyer",
  accountant: "Accountant",
  notary: "Notary",
  tax_consultant: "Tax Consultant",
  appraiser: "Appraiser",
};

function getInitials(name: string): string {
  return name
    .split(" ")
    .map((n) => n[0])
    .join("")
    .toUpperCase()
    .slice(0, 2);
}

interface FollowListDialogProps {
  userId: Id<"users">;
  type: "followers" | "following" | null;
  open: boolean;
  onOpenChange: (open: boolean) => void;
}

export function FollowListDialog({
  userId,
  type,
  open,
  onOpenChange,
}: FollowListDialogProps) {
  // Query based on type
  const followers = useQuery(
    api.userFollows.getFollowers,
    type === "followers" ? { userId } : "skip"
  );
  const following = useQuery(
    api.userFollows.getFollowing,
    type === "following" ? { userId } : "skip"
  );

  // Get current user to determine if viewing own list
  const currentUser = useQuery(api.users.getCurrentUser);

  const users = type === "followers" ? followers : following;
  const title = type === "followers" ? "Followers" : "Following";
  const emptyMessage = type === "followers"
    ? "No followers yet"
    : "Not following anyone yet";

  return (
    <Dialog open={open} onOpenChange={onOpenChange}>
      <DialogContent className="sm:max-w-md">
        <DialogHeader>
          <DialogTitle>{title}</DialogTitle>
        </DialogHeader>

        {users === undefined ? (
          <div className="py-8 flex justify-center">
            <div className="animate-spin h-6 w-6 border-2 border-primary border-t-transparent rounded-full" />
          </div>
        ) : users.length === 0 ? (
          <div className="py-8 text-center text-muted-foreground">
            <Users className="h-12 w-12 mx-auto mb-2 opacity-50" />
            <p>{emptyMessage}</p>
          </div>
        ) : (
          <ScrollArea className="max-h-[60vh]">
            <div className="space-y-3 pr-4">
              {users.map((user) => (
                <div
                  key={user._id}
                  className="flex items-center gap-3"
                >
                  <Avatar className="h-10 w-10">
                    <AvatarImage src={user.imageUrl} alt={user.name} />
                    <AvatarFallback>{getInitials(user.name)}</AvatarFallback>
                  </Avatar>
                  <div className="flex-1 min-w-0">
                    <p className="font-medium text-sm truncate">{user.name}</p>
                    {user.role && (
                      <Badge variant="secondary" className="text-xs">
                        {ROLE_LABELS[user.role] || user.role}
                      </Badge>
                    )}
                  </div>
                  <FollowButton
                    userId={user._id}
                    isOwnPost={currentUser?._id === user._id}
                  />
                </div>
              ))}
            </div>
          </ScrollArea>
        )}
      </DialogContent>
    </Dialog>
  );
}
```

Styling notes:
- max-h-[60vh] with ScrollArea for long lists
- Consistent avatar size (h-10 w-10)
- FollowButton allows following directly from the list
- Users spinner for loading state
  </action>
  <verify>
    - File exists: `ls src/components/feed/FollowListDialog.tsx`
    - Uses getFollowers: `grep -q "getFollowers" src/components/feed/FollowListDialog.tsx`
    - Uses getFollowing: `grep -q "getFollowing" src/components/feed/FollowListDialog.tsx`
    - Has FollowButton: `grep -q "FollowButton" src/components/feed/FollowListDialog.tsx`
  </verify>
  <done>FollowListDialog shows followers or following with ability to follow from list</done>
</task>

<task type="auto">
  <name>Task 3: Export components and verify build</name>
  <files>src/components/feed/index.ts</files>
  <action>
1. Add exports to `src/components/feed/index.ts`:
   ```tsx
   export { FollowStats } from "./FollowStats";
   export { FollowListDialog } from "./FollowListDialog";
   ```

2. Run build to verify everything compiles:
   ```bash
   npm run build
   ```

3. These components are ready for use in:
   - Provider profile pages (Phase 26 will add them)
   - User cards in various contexts
   - Post author areas (optional enhancement)

Note: Plan 02 creates the reusable components. Phase 26 (User Profiles Revamp) will integrate them into user profile pages. For now they are exported and available.
  </action>
  <verify>
    - FollowStats exported: `grep -q "FollowStats" src/components/feed/index.ts`
    - FollowListDialog exported: `grep -q "FollowListDialog" src/components/feed/index.ts`
    - Build passes: `cd /Users/Kohelet/Code/REOS && npm run build 2>&1 | tail -5`
  </verify>
  <done>All follow components exported and build passes</done>
</task>

</tasks>

<verification>
1. Build passes: `npm run build`
2. FollowStats component shows counts
3. Clicking counts opens FollowListDialog
4. Dialog shows list of users with avatars and follow buttons
5. All components properly exported from barrel
</verification>

<success_criteria>
- FollowStats component displays follower/following counts
- Counts are clickable and open FollowListDialog
- FollowListDialog shows list of followers or following
- Each user in list has FollowButton (except current user)
- All components exported from src/components/feed/index.ts
- Build compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/25-user-following/25-02-SUMMARY.md`
</output>
