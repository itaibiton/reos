---
phase: 22-post-creation-ui
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/feed/CreatePostDialog.tsx
  - src/components/feed/index.ts
autonomous: true
user_setup: []

must_haves:
  truths:
    - "User can open create post dialog from a trigger button"
    - "User can switch between 3 post types (Property, Service Request, Discussion)"
    - "User can enter content for any post type"
    - "User can select visibility (Public, Followers Only)"
    - "User can submit a discussion post successfully"
    - "User can submit a service request post with service type selected"
    - "Dialog closes after successful submission"
  artifacts:
    - path: "src/components/feed/CreatePostDialog.tsx"
      provides: "Main create post dialog with tabbed interface"
      min_lines: 200
    - path: "src/components/feed/index.ts"
      provides: "Barrel exports for feed components"
      exports: ["CreatePostDialog"]
  key_links:
    - from: "src/components/feed/CreatePostDialog.tsx"
      to: "convex/posts.ts"
      via: "useMutation for createDiscussionPost, createServiceRequestPost"
      pattern: "useMutation.*api\\.posts\\.(createDiscussionPost|createServiceRequestPost)"
---

<objective>
Create the main Create Post dialog with tabbed interface for selecting post type and forms for Discussion and Service Request posts.

Purpose: Enable users to create posts from anywhere in the feed UI. Property Listing posts will be completed in Plan 02 (requires PropertySelector component).
Output: CreatePostDialog component with working Discussion and Service Request post creation.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/21-feed-infrastructure/21-01-SUMMARY.md

# Existing patterns to follow
@src/components/deals/RequestProviderDialog.tsx (dialog structure, form handling)
@src/components/properties/PropertyForm.tsx (form state management)
@convex/posts.ts (mutations to call)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create CreatePostDialog component</name>
  <files>src/components/feed/CreatePostDialog.tsx</files>
  <action>
Create a dialog component for creating posts with the following structure:

1. **Props interface:**
   - `open: boolean`
   - `onOpenChange: (open: boolean) => void`
   - `defaultType?: "property_listing" | "service_request" | "discussion"` (optional, defaults to "discussion")

2. **State management (useState, not React Hook Form):**
   - `postType` - current tab/type selected
   - `content` - text content (shared across types)
   - `visibility` - "public" | "followers_only" (default "public")
   - `serviceType` - for service requests: "broker" | "mortgage_advisor" | "lawyer"
   - `isSubmitting` - loading state
   - `errors` - validation errors object

3. **UI Structure:**
   ```
   Dialog
   ├── DialogHeader: "Create Post"
   ├── Tabs (3 tabs using Shadcn Tabs)
   │   ├── TabsTrigger: Property (icon: Home01Icon)
   │   ├── TabsTrigger: Service Request (icon: UserMultiple02Icon)
   │   └── TabsTrigger: Discussion (icon: Comment01Icon)
   ├── TabsContent for each type:
   │   ├── Property: Show placeholder "Property selector coming in next update" with disabled state
   │   ├── Service Request: ServiceType selector (RadioGroup) + Content Textarea
   │   └── Discussion: Content Textarea only
   ├── Visibility selector (RadioGroup with Globe icon for Public, Users icon for Followers)
   └── DialogFooter: Cancel + Post button
   ```

4. **Validation:**
   - Content required, min 1 char after trim
   - Service type required for service_request posts

5. **Submission:**
   - Call appropriate mutation based on postType
   - Use try/catch with toast.error for failures, toast.success on success
   - Reset form and close dialog on success
   - Disable Property tab submission (placeholder for Plan 02)

6. **Styling:**
   - Follow RequestProviderDialog pattern
   - Tabs should be full-width with equal sizing
   - Content textarea min-h-[120px] with resize-none
   - Visibility options as horizontal radio buttons with icons

Use these icons from @hugeicons/core-free-icons:
- Home01Icon (property)
- UserMultiple02Icon (service request)
- Comment01Icon (discussion)
- Globe02Icon (public visibility)
- UserGroupIcon (followers only)
  </action>
  <verify>
TypeScript compiles without errors:
```bash
cd /Users/Kohelet/Code/REOS && npx tsc --noEmit
```
  </verify>
  <done>
CreatePostDialog component exists with tabbed interface, Discussion and Service Request forms functional, Property tab shows placeholder, form validates and submits to Convex mutations.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create barrel export and test integration</name>
  <files>src/components/feed/index.ts</files>
  <action>
1. Create barrel export file at src/components/feed/index.ts:
   ```typescript
   export { CreatePostDialog } from "./CreatePostDialog";
   ```

2. Verify the component can be imported and renders:
   - Check that Dialog opens/closes properly
   - Verify tabs switch between post types
   - Test that form state resets when dialog closes
  </action>
  <verify>
```bash
cd /Users/Kohelet/Code/REOS && npx tsc --noEmit
```
  </verify>
  <done>
Barrel export exists, CreatePostDialog can be imported from @/components/feed.
  </done>
</task>

</tasks>

<verification>
1. TypeScript compiles: `npx tsc --noEmit`
2. Component structure follows existing dialog patterns
3. Discussion post can be created (will test in Phase 23 feed display)
4. Service request post can be created with service type selection
5. Property tab shows placeholder (to be completed in Plan 02)
</verification>

<success_criteria>
- CreatePostDialog component renders with 3-tab interface
- Discussion and Service Request posts submit successfully to Convex
- Visibility selector works for both post types
- Form validation prevents empty submissions
- Property tab is disabled/placeholder for Plan 02
- Barrel export enables clean imports
</success_criteria>

<output>
After completion, create `.planning/phases/22-post-creation-ui/22-01-SUMMARY.md`
</output>
