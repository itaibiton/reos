---
phase: 22-post-creation-ui
plan: 02
type: execute
wave: 2
depends_on: ["22-01"]
files_modified:
  - src/components/feed/PropertySelector.tsx
  - src/components/feed/CreatePostDialog.tsx
  - src/components/feed/index.ts
autonomous: true
user_setup: []

must_haves:
  truths:
    - "User can select a property from their listings when creating a property post"
    - "User can search/filter their properties in the selector"
    - "User sees property thumbnail, title, city, and price in selector"
    - "User can submit a property listing post with selected property"
    - "Empty state shows when user has no properties"
  artifacts:
    - path: "src/components/feed/PropertySelector.tsx"
      provides: "Property selection component for post creation"
      min_lines: 80
    - path: "src/components/feed/CreatePostDialog.tsx"
      provides: "Updated dialog with working property selection"
      contains: "PropertySelector"
  key_links:
    - from: "src/components/feed/PropertySelector.tsx"
      to: "convex/properties.ts"
      via: "useQuery for listMyListings"
      pattern: "useQuery.*api\\.properties\\.listMyListings"
    - from: "src/components/feed/CreatePostDialog.tsx"
      to: "convex/posts.ts"
      via: "useMutation for createPropertyPost"
      pattern: "useMutation.*api\\.posts\\.createPropertyPost"
---

<objective>
Create PropertySelector component and integrate it into CreatePostDialog to enable property listing post creation.

Purpose: Complete the post creation flow by allowing users to share their properties as feed posts.
Output: Working property selection with search, and fully functional property listing post creation.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/22-post-creation-ui/22-01-SUMMARY.md

# Pattern to follow
@src/components/chat/DealSelector.tsx (selector with search, thumbnails, selection state)
@convex/properties.ts (listMyListings query)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create PropertySelector component</name>
  <files>src/components/feed/PropertySelector.tsx</files>
  <action>
Create a property selector component following the DealSelector pattern:

1. **Props interface:**
   ```typescript
   interface PropertySelectorProps {
     selectedPropertyId: Id<"properties"> | null;
     onSelect: (propertyId: Id<"properties">) => void;
   }
   ```

2. **Data fetching:**
   - Use `useQuery(api.properties.listMyListings, {})` to get user's properties
   - Handle loading state with Skeleton placeholders (3 items)
   - Handle empty state with Home01Icon and "You haven't listed any properties yet" message

3. **Search functionality:**
   - Local state for searchQuery
   - Filter properties by title, address, city (case-insensitive)
   - Search input with Search01Icon prefix

4. **Property list:**
   - Scrollable list (max-h-64)
   - Each item shows:
     - Thumbnail (48x48, rounded-md) using featuredImage or Home01Icon placeholder
     - Title (font-medium, truncate)
     - City + formatted price (text-xs text-muted-foreground)
     - Status badge (available/pending/sold)
   - Selected state: border-primary bg-primary/5 with CheckmarkCircle01Icon
   - Hover state: hover:bg-muted/50

5. **Price formatting:**
   ```typescript
   function formatPrice(amount: number) {
     if (amount >= 1000000) return `$${(amount / 1000000).toFixed(1)}M`;
     return `$${(amount / 1000).toFixed(0)}K`;
   }
   ```

Use these icons:
- Search01Icon (search input)
- Home01Icon (property placeholder, empty state)
- CheckmarkCircle01Icon (selected indicator)
  </action>
  <verify>
```bash
cd /Users/Kohelet/Code/REOS && npx tsc --noEmit
```
  </verify>
  <done>
PropertySelector component exists with search, property list, selection state, loading/empty states.
  </done>
</task>

<task type="auto">
  <name>Task 2: Integrate PropertySelector into CreatePostDialog</name>
  <files>src/components/feed/CreatePostDialog.tsx, src/components/feed/index.ts</files>
  <action>
Update CreatePostDialog to use PropertySelector for property listing posts:

1. **Add state:**
   - `selectedPropertyId: Id<"properties"> | null` (default null)

2. **Add mutation:**
   - Import and use `useMutation(api.posts.createPropertyPost)`

3. **Update Property TabsContent:**
   - Replace placeholder with PropertySelector component
   - Pass selectedPropertyId and onSelect handler
   - Show content Textarea below the selector for post caption

4. **Update validation:**
   - For property_listing: require selectedPropertyId AND content

5. **Update submission:**
   - Add case for "property_listing" that calls createPropertyPost with:
     - propertyId: selectedPropertyId
     - content: trimmed content
     - visibility: selected visibility

6. **Reset state:**
   - Clear selectedPropertyId when dialog closes or post type changes

7. **Update barrel export:**
   - Add PropertySelector to index.ts exports:
   ```typescript
   export { CreatePostDialog } from "./CreatePostDialog";
   export { PropertySelector } from "./PropertySelector";
   ```
  </action>
  <verify>
```bash
cd /Users/Kohelet/Code/REOS && npx tsc --noEmit
```
  </verify>
  <done>
CreatePostDialog uses PropertySelector for property posts, all 3 post types can be created, form validation includes property selection, barrel exports updated.
  </done>
</task>

</tasks>

<verification>
1. TypeScript compiles: `npx tsc --noEmit`
2. PropertySelector shows user's properties from listMyListings
3. Search filters properties correctly
4. Selection state is visually indicated
5. Property listing posts can be created with selected property
6. Empty state displays when user has no properties
</verification>

<success_criteria>
- PropertySelector component renders user's properties
- Search filters by title/address/city
- Property selection updates visual state
- CreatePostDialog submits property listing posts successfully
- All 3 post types (Property, Service Request, Discussion) now fully functional
- Form validates property selection before submission
</success_criteria>

<output>
After completion, create `.planning/phases/22-post-creation-ui/22-02-SUMMARY.md`
</output>
