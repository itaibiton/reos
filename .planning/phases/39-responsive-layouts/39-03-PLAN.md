---
phase: 39-responsive-layouts
plan: 03
type: execute
wave: 2
depends_on: ["39-01", "39-02"]
files_modified:
  - src/components/ui/button.tsx
  - src/app/[locale]/(app)/feed/page.tsx
  - src/components/feed/PullToRefresh.tsx
  - package.json
autonomous: true
user_setup:
  - service: npm
    why: "Install pull-to-refresh library"
    env_vars: []
    dashboard_config: []

must_haves:
  truths:
    - "User can tap all buttons without precision issues (44px minimum touch targets)"
    - "User on feed page can pull down to refresh content"
    - "User on desktop sees unchanged button sizes"
    - "Pull-to-refresh only active on mobile"
  artifacts:
    - path: "src/components/ui/button.tsx"
      provides: "Touch-target size variants for mobile"
      contains: "min-h-[44px]"
    - path: "src/components/feed/PullToRefresh.tsx"
      provides: "PullToRefresh wrapper component"
      exports: ["PullToRefreshWrapper"]
  key_links:
    - from: "src/app/[locale]/(app)/feed/page.tsx"
      to: "src/components/feed/PullToRefresh.tsx"
      via: "PullToRefreshWrapper import"
      pattern: "PullToRefreshWrapper"
---

<objective>
Add touch-target sizing and pull-to-refresh functionality for mobile.

Purpose: RSP-04 requires 44px minimum touch targets. RSP-05 requires pull-to-refresh on feed pages. This plan adds the infrastructure and implements both features.
Output: Button touch-target variants, PullToRefresh component, and feed page integration.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/milestones/v1.5-ROADMAP.md
@.planning/phases/39-responsive-layouts/39-RESEARCH.md
@src/components/ui/button.tsx
@src/app/[locale]/(app)/feed/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add touch-target button sizes</name>
  <files>src/components/ui/button.tsx</files>
  <action>
Add mobile-optimized touch-target size variants to the button component.

Current button sizes (all below 44px minimum):
- default: h-9 (36px)
- sm: h-8 (32px)
- lg: h-10 (40px)
- icon: size-9 (36px)
- icon-sm: size-8 (32px)
- icon-lg: size-10 (40px)

Add new touch-optimized variants that meet 44px minimum on mobile but revert to original size on desktop:

Add to the `size` variants object:
```typescript
"touch": "h-9 px-4 py-2 has-[>svg]:px-3 min-h-[44px] md:min-h-0",
"touch-sm": "h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5 min-h-[44px] md:min-h-0",
"touch-lg": "h-10 rounded-md px-6 has-[>svg]:px-4 min-h-[44px] md:min-h-0",
"touch-icon": "size-9 min-h-[44px] min-w-[44px] md:min-h-0 md:min-w-0",
"touch-icon-sm": "size-8 min-h-[44px] min-w-[44px] md:min-h-0 md:min-w-0",
"touch-icon-lg": "size-10 min-h-[44px] min-w-[44px] md:min-h-0 md:min-w-0",
```

These variants:
- Have 44px minimum height/width on mobile (<768px)
- Revert to normal size on desktop (>=768px) with md:min-h-0 md:min-w-0
- Keep all other styling from their base variant

This allows gradual adoption - components can opt-in to touch-friendly sizing.
  </action>
  <verify>Button variants compile without errors, touch sizes available</verify>
  <done>Button component has touch-target size variants</done>
</task>

<task type="auto">
  <name>Task 2: Create PullToRefresh component</name>
  <files>
    src/components/feed/PullToRefresh.tsx
    package.json
  </files>
  <action>
First, install the pull-to-refresh library:
```bash
npm install react-simple-pull-to-refresh
```

Create a PullToRefreshWrapper component that only activates on mobile:

```typescript
// src/components/feed/PullToRefresh.tsx
"use client";

import PullToRefresh from "react-simple-pull-to-refresh";
import { useIsMobile } from "@/hooks/use-mobile";

interface PullToRefreshWrapperProps {
  onRefresh: () => Promise<void>;
  children: React.ReactNode;
}

export function PullToRefreshWrapper({
  onRefresh,
  children,
}: PullToRefreshWrapperProps) {
  const isMobile = useIsMobile();

  // Only enable on mobile
  if (!isMobile) {
    return <>{children}</>;
  }

  return (
    <PullToRefresh
      onRefresh={onRefresh}
      resistance={2.5}
      maxPullDownDistance={95}
      pullDownThreshold={67}
      refreshingContent={
        <div className="flex justify-center py-4">
          <div className="h-6 w-6 animate-spin rounded-full border-2 border-primary border-t-transparent" />
        </div>
      }
      pullingContent={
        <div className="flex justify-center py-4">
          <div className="h-6 w-6 rounded-full border-2 border-muted-foreground border-t-transparent" />
        </div>
      }
    >
      {children}
    </PullToRefresh>
  );
}
```

Key implementation details:
- Only wraps children with PullToRefresh on mobile
- On desktop, renders children directly (no pull-to-refresh behavior)
- Uses consistent spinner styling with Tailwind
- resistance: 2.5 (how hard to pull)
- maxPullDownDistance: 95 (max pixels can pull)
- pullDownThreshold: 67 (pixels before refresh triggers)
  </action>
  <verify>Component file exists, library installed in package.json</verify>
  <done>PullToRefreshWrapper component created</done>
</task>

<task type="auto">
  <name>Task 3: Integrate pull-to-refresh on feed page</name>
  <files>src/app/[locale]/(app)/feed/page.tsx</files>
  <action>
Integrate PullToRefreshWrapper into the feed page.

1. Import the component:
```typescript
import { PullToRefreshWrapper } from "@/components/feed/PullToRefresh";
```

2. Create a refresh handler that reloads the feed data:
```typescript
const handleRefresh = async () => {
  // Force refetch by invalidating the query
  // With Convex, we can trigger a refetch by navigating to same page
  // or by using the router.refresh() method
  router.refresh();
  // Add small delay for UX
  await new Promise(resolve => setTimeout(resolve, 500));
};
```

3. Wrap the main feed column content with PullToRefreshWrapper:
```tsx
<PullToRefreshWrapper onRefresh={handleRefresh}>
  <div className="flex-1 space-y-6">
    {/* Header */}
    {/* Tabs */}
    {/* Posts list */}
    {/* Load more button */}
  </div>
</PullToRefreshWrapper>
```

Note: The wrapper should be inside the lg:flex container, wrapping only the main feed column (not the sidebar).

The component structure becomes:
```tsx
<div className="max-w-5xl mx-auto p-6">
  <div className="lg:flex lg:gap-6">
    <PullToRefreshWrapper onRefresh={handleRefresh}>
      {/* Main feed column content */}
    </PullToRefreshWrapper>

    {/* Discovery sidebar - hidden on mobile */}
    <aside className="hidden lg:block w-80 ...">
      ...
    </aside>
  </div>
</div>
```

Also update barrel export if needed:
Check if src/components/feed/index.ts exists and add PullToRefreshWrapper export.
  </action>
  <verify>Pull down on feed page (mobile viewport) triggers refresh animation</verify>
  <done>Feed page has working pull-to-refresh on mobile</done>
</task>

</tasks>

<verification>
1. Run `npm run build` - no TypeScript errors
2. Test touch targets:
   - Buttons with `size="touch-icon"` have 44px touch area on mobile
   - Same buttons have normal size on desktop
3. Test pull-to-refresh on feed page (mobile viewport):
   - Pull down shows loading spinner
   - Release triggers refresh
   - Content reloads
4. Test on desktop:
   - Pull-to-refresh not active
   - Button sizes unchanged
5. Test all RSP requirements:
   - RSP-04: Touch targets 44px (check a few key buttons)
   - RSP-05: Pull-to-refresh works on feed
   - RSP-06: Desktop unchanged
</verification>

<success_criteria>
- Button component has touch-target size variants (RSP-04 infrastructure)
- PullToRefreshWrapper component created
- Feed page has pull-to-refresh on mobile (RSP-05)
- Desktop layouts remain unchanged (RSP-06)
- No TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/39-responsive-layouts/39-03-SUMMARY.md`
</output>
