---
phase: 06-deal-flow
plan: 05
type: execute
---

<objective>
Create deal flow UI - deals list page and deal detail page for investors and providers.

Purpose: Allow users to view and manage their deals through a clean interface.
Output: /deals page with list view, /deals/[id] detail page with tabs for info, files, activity.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior plans in this phase:
@.planning/phases/06-deal-flow/06-01-SUMMARY.md
@.planning/phases/06-deal-flow/06-02-SUMMARY.md
@.planning/phases/06-deal-flow/06-03-SUMMARY.md
@.planning/phases/06-deal-flow/06-04-SUMMARY.md

# Key source files:
@convex/deals.ts
@convex/dealFiles.ts
@convex/serviceRequests.ts
@src/components/deals/FileUpload.tsx
@src/app/(app)/properties/[id]/page.tsx (for layout pattern)

**UI patterns established:**
- Two-column layout for detail pages
- Tabs for section organization
- Card-based sections
- Skeleton loaders for loading states
- Shadcn components throughout
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create deals list page</name>
  <files>src/app/(app)/deals/page.tsx</files>
  <action>
Create the deals list page at /deals:

1. Use `useQuery(api.deals.list)` to fetch user's deals
2. Display as cards with:
   - Property info (title, image, city) from joined property
   - Current stage as colored badge
   - Created date
   - Assigned providers (if any)
   - Click to navigate to /deals/[id]

3. Empty state:
   - For investors: "No deals yet. Start by saving a property and requesting a broker."
   - Link to /properties

4. Filter/sort options:
   - Filter by stage (dropdown)
   - Sort by date (newest/oldest)

5. Loading state with skeleton cards

Use DealCard component (create inline or as separate component).
Stage badges: use appropriate colors (green for completed, yellow for in-progress, red for cancelled).
  </action>
  <verify>Page renders without errors, shows deals for logged-in user</verify>
  <done>Deals list page with filtering, sorting, and navigation</done>
</task>

<task type="auto">
  <name>Task 2: Create deal detail page</name>
  <files>src/app/(app)/deals/[id]/page.tsx</files>
  <action>
Create the deal detail page at /deals/[id]:

**Header section:**
- Property card (image, title, price, location)
- Deal stage progress indicator (horizontal steps)
- Action buttons based on stage and role

**Tabbed content (using Shadcn Tabs):**

**Tab 1: Overview**
- Property summary
- Deal info (offer price if set, created date)
- Assigned providers list with contact info

**Tab 2: Providers**
- Current providers assigned to deal
- For each stage without provider: "Find a [Provider Type]" button
- If investor: request provider UI
- If provider: handoff UI (recommend next provider)

**Tab 3: Files**
- FileUpload component (if user can upload)
- File list with download/delete actions
- Filter by category

**Tab 4: Activity**
- Activity log timeline
- Show who did what and when
- Use Timeline component pattern (vertical list)

**Access control:**
- Redirect to /deals if deal not found
- Redirect if user is not a participant
- Show read-only view for completed/cancelled deals
  </action>
  <verify>Page renders with all tabs, data loads correctly</verify>
  <done>Deal detail page with tabs for overview, providers, files, activity</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete deal flow UI with deals list and detail pages</what-built>
  <how-to-verify>
    1. Run: npm run dev
    2. Sign in as an investor
    3. Visit: http://localhost:3000/deals
    4. Verify empty state shows correctly (if no deals)
    5. Create a deal:
       - Go to /properties, click a property
       - Look for "Start Deal" or similar button (may need to add)
       - Create a deal
    6. Return to /deals, verify deal appears in list
    7. Click deal to open /deals/[id]
    8. Test tabs:
       - Overview: shows property info
       - Providers: shows request UI
       - Files: shows upload UI
       - Activity: shows timeline
    9. Test file upload:
       - Upload a test file (PDF or image)
       - Verify it appears in files list
       - Verify it logs to activity
    10. Mobile: resize to 375px, verify layout works
  </how-to-verify>
  <resume-signal>Type "approved" to complete Phase 6, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] /deals page lists user's deals
- [ ] /deals/[id] shows deal with all tabs
- [ ] File upload works
- [ ] Activity log displays
- [ ] Mobile responsive
- [ ] `npm run build` passes
</verification>

<success_criteria>
- Users can view their deals in a list
- Deal detail page shows comprehensive info
- File management works end-to-end
- Activity provides audit trail visibility
- Human verification passed
- Phase 6 complete
</success_criteria>

<output>
After completion, create `.planning/phases/06-deal-flow/06-05-SUMMARY.md` with:

# Phase 6 Plan 05: Deals UI Summary

**[One-liner describing what shipped]**

## Accomplishments
- [Key outcomes]

## Files Created/Modified
- [File list]

## Decisions Made
- [Key decisions]

## Issues Encountered
- [Problems and resolutions]

## Next Phase Readiness
- Phase 6 complete - Deal flow tracking implemented
- Ready for Phase 7: Dashboards
</output>
