---
phase: 12-questionnaire-content-2
plan: 01
type: execute
---

<objective>
Add 5 more questionnaire steps: budget range, investment horizon, investment goals, yield preferences, and financing needs.

Purpose: Gather financial context from investors to enable property matching and service provider recommendations.
Output: 5 new step components integrated into questionnaire wizard, with schema updates and persistence.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11-questionnaire-content-1/11-01-SUMMARY.md

# Key files (from Phase 11):
@src/components/questionnaire/steps/CitizenshipStep.tsx
@src/app/(app)/onboarding/questionnaire/page.tsx
@convex/schema.ts
@convex/investorQuestionnaires.ts

**Established patterns:**
- Step component pattern: value/onChange props, QuestionBubble + AnswerArea structure
- Local useState for immediate UI, Convex sync on step change
- RadioGroup with rounded-lg border p-4 styling for single-select
- Draft restoration via useEffect on questionnaire load

**Tech stack available:**
- Shadcn components: RadioGroup, Slider, Checkbox, Input
- Tailwind v4 for styling
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add schema fields and create 5 step components</name>
  <files>convex/schema.ts, convex/investorQuestionnaires.ts, src/components/questionnaire/steps/BudgetStep.tsx, src/components/questionnaire/steps/HorizonStep.tsx, src/components/questionnaire/steps/GoalsStep.tsx, src/components/questionnaire/steps/YieldStep.tsx, src/components/questionnaire/steps/FinancingStep.tsx, src/components/questionnaire/steps/index.ts</files>
  <action>
1. Update convex/schema.ts investorQuestionnaires table - add 5 optional fields:
   - budgetMin: v.optional(v.number()) // USD minimum
   - budgetMax: v.optional(v.number()) // USD maximum
   - investmentHorizon: v.optional(v.string()) // "short_term" | "medium_term" | "long_term"
   - investmentGoals: v.optional(v.array(v.string())) // ["appreciation", "rental_income", "diversification", "tax_benefits"]
   - yieldPreference: v.optional(v.string()) // "rental_yield" | "appreciation" | "balanced"
   - financingApproach: v.optional(v.string()) // "cash" | "mortgage" | "exploring"

2. Update convex/investorQuestionnaires.ts saveAnswers mutation - add the 5 new fields to args and patch

3. Create 5 step components following established pattern (QuestionBubble + AnswerArea):

   **BudgetStep.tsx**:
   - Question: "What's your investment budget range?"
   - Description: Helps us show properties that match your financial capacity
   - Use two Input fields for min/max USD with currency formatting display
   - Props: budgetMin/budgetMax/onBudgetChange (separate or combined)

   **HorizonStep.tsx**:
   - Question: "What's your investment timeline?"
   - Description: Your timeline helps us recommend appropriate investment strategies
   - RadioGroup with 3 options:
     - short_term: "Short-term (under 2 years)" - Quick flip or short-term rental
     - medium_term: "Medium-term (2-5 years)" - Hold for appreciation
     - long_term: "Long-term (5+ years)" - Long-term wealth building
   - Props: value/onChange pattern

   **GoalsStep.tsx**:
   - Question: "What are your investment goals?"
   - Description: Select all that apply - this helps us understand your priorities
   - Use Checkbox components (multiple selection) for goals:
     - appreciation: "Capital appreciation"
     - rental_income: "Rental income"
     - diversification: "Portfolio diversification"
     - tax_benefits: "Tax benefits"
   - Props: value (string[])/onChange pattern

   **YieldStep.tsx**:
   - Question: "What's your yield preference?"
   - Description: This affects which properties we prioritize in recommendations
   - RadioGroup with 3 options:
     - rental_yield: "Rental yield focus" - Prioritize cash flow
     - appreciation: "Appreciation focus" - Prioritize value growth
     - balanced: "Balanced approach" - Both matter equally
   - Props: value/onChange pattern

   **FinancingStep.tsx**:
   - Question: "How do you plan to finance your investment?"
   - Description: Understanding your financing approach helps us connect you with the right mortgage advisors
   - RadioGroup with 3 options:
     - cash: "All cash" - No financing needed
     - mortgage: "Mortgage/Financing" - Will need mortgage advisor
     - exploring: "Still exploring options" - Not sure yet
   - Props: value/onChange pattern

4. Update src/components/questionnaire/steps/index.ts - export all 5 new components
  </action>
  <verify>npm run build passes, new components exported correctly</verify>
  <done>Schema has 5 new fields, saveAnswers accepts them, 5 step components created and exported</done>
</task>

<task type="auto">
  <name>Task 2: Wire up questionnaire page with new steps</name>
  <files>src/app/(app)/onboarding/questionnaire/page.tsx</files>
  <action>
1. Import the 5 new step components from @/components/questionnaire/steps

2. Add local state for each new field:
   - budgetMin: number | undefined
   - budgetMax: number | undefined
   - investmentHorizon: string | undefined
   - investmentGoals: string[] | undefined (default to empty array for checkbox)
   - yieldPreference: string | undefined
   - financingApproach: string | undefined

3. Update useEffect for draft restoration to include the new fields from questionnaire

4. Add 5 new steps to the steps array (after existing 5 steps):
   - { id: "budget", title: "Budget", component: <BudgetStep ... /> }
   - { id: "horizon", title: "Timeline", component: <HorizonStep ... /> }
   - { id: "goals", title: "Goals", component: <GoalsStep ... /> }
   - { id: "yield", title: "Yield", component: <YieldStep ... /> }
   - { id: "financing", title: "Financing", component: <FinancingStep ... /> }

5. Update saveProgress function to include all new fields in saveAnswers call

6. Update useMemo deps array to include all new state variables

Note: BudgetStep may need special handling since it has two values (min/max). Either:
- Pass both as separate props with separate onChange handlers, OR
- Pass as { min, max } object with single onChange
Choose the pattern that feels cleanest - recommend separate props like CitizenshipStep but for two values.
  </action>
  <verify>npm run dev works, navigate through all 10 steps, answers persist on refresh</verify>
  <done>Questionnaire has 10 steps (5 original + 5 new), all answers save to Convex, draft restoration works for all fields</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `npm run build` succeeds without errors
- [ ] All 10 questionnaire steps render correctly
- [ ] RadioGroup selections work on single-select steps
- [ ] Checkbox selections work on GoalsStep (multiple select)
- [ ] Budget inputs accept and display USD values
- [ ] Answers persist when navigating back/forward
- [ ] Answers restore on page refresh (draft persistence)
- [ ] Complete button works on step 10
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No TypeScript errors
- 10-step questionnaire flow works end-to-end
- All answers save to Convex and restore from draft
</success_criteria>

<output>
After completion, create `.planning/phases/12-questionnaire-content-2/12-01-SUMMARY.md`
</output>
