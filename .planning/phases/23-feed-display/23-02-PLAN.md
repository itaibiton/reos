---
phase: 23-feed-display
plan: 02
type: execute
wave: 2
depends_on: ["23-01"]
files_modified:
  - src/app/(app)/feed/page.tsx
  - src/lib/navigation.ts
autonomous: true

must_haves:
  truths:
    - "User can view a feed of posts at /feed"
    - "User can filter posts by type (All, Properties, Service Requests, Discussions)"
    - "User can scroll to load more posts (infinite scroll)"
    - "User can create a new post from the feed page"
    - "User sees empty state when no posts match filter"
    - "Filter state persists in URL for shareable links"
  artifacts:
    - path: "src/app/(app)/feed/page.tsx"
      provides: "Main feed page with infinite scroll and filtering"
      min_lines: 100
    - path: "src/lib/navigation.ts"
      provides: "Updated navigation with Feed link"
      contains: "feed"
  key_links:
    - from: "src/app/(app)/feed/page.tsx"
      to: "convex/posts.ts globalFeed"
      via: "usePaginatedQuery"
      pattern: "usePaginatedQuery.*globalFeed"
    - from: "src/app/(app)/feed/page.tsx"
      to: "src/components/feed/PostCard.tsx"
      via: "import and render"
      pattern: "PostCard"
    - from: "src/app/(app)/feed/page.tsx"
      to: "src/components/feed/CreatePostDialog.tsx"
      via: "button trigger"
      pattern: "CreatePostDialog"
---

<objective>
Create the main feed page at /feed with infinite scroll using Convex usePaginatedQuery, post type filtering via URL params, and a create post button.

Purpose: The feed page is the central social hub where users discover and interact with posts from the community.

Output: Feed page with working infinite scroll, filtering, and post creation trigger
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/23-feed-display/23-01-SUMMARY.md - Post card components
@convex/posts.ts - globalFeed query with paginationOpts and postType filter
@src/app/(app)/properties/page.tsx - URL params pattern for filters
@src/components/feed/index.ts - barrel exports including PostCard, CreatePostDialog
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create feed page with infinite scroll and post type filtering</name>
  <files>src/app/(app)/feed/page.tsx</files>
  <action>
Create the feed page at src/app/(app)/feed/page.tsx:

**Imports:**
- usePaginatedQuery from "convex/react" (NOT useQuery - this is critical for pagination)
- useSearchParams, useRouter from "next/navigation"
- api from convex/_generated/api
- PostCard, PostCardSkeleton, CreatePostDialog from @/components/feed
- Shadcn: Button, Tabs, TabsList, TabsTrigger
- Hugeicons: Add01Icon, Rss01Icon (or similar feed icon)

**URL-based filter state:**
- Read `type` param from searchParams: "all" | "property_listing" | "service_request" | "discussion"
- Default to "all" if not present
- Map "all" to undefined for the query (no filter)

**Infinite scroll with usePaginatedQuery:**
```typescript
const { results, status, loadMore } = usePaginatedQuery(
  api.posts.globalFeed,
  { postType: filterType === "all" ? undefined : filterType },
  { initialNumItems: 10 }
);
```

- `results` is the accumulated array of posts
- `status` is "LoadingFirstPage" | "LoadingMore" | "CanLoadMore" | "Exhausted"
- `loadMore(count)` fetches more items

**Page layout:**
```
<div className="max-w-2xl mx-auto p-6 space-y-6">
  {/* Header */}
  <div className="flex items-center justify-between">
    <h1 className="text-2xl font-bold">Feed</h1>
    <Button onClick={() => setDialogOpen(true)} className="gap-2">
      <HugeiconsIcon icon={Add01Icon} size={16} />
      Create Post
    </Button>
  </div>

  {/* Filter Tabs */}
  <Tabs value={filterType} onValueChange={handleFilterChange}>
    <TabsList className="grid w-full grid-cols-4">
      <TabsTrigger value="all">All</TabsTrigger>
      <TabsTrigger value="property_listing">Properties</TabsTrigger>
      <TabsTrigger value="service_request">Services</TabsTrigger>
      <TabsTrigger value="discussion">Discussions</TabsTrigger>
    </TabsList>
  </Tabs>

  {/* Posts list */}
  {/* Loading / Empty / Content states */}

  {/* Load more button */}
</div>

<CreatePostDialog open={dialogOpen} onOpenChange={setDialogOpen} />
```

**handleFilterChange:**
- Update URL with new type param: `router.push(\`/feed?type=\${value}\`)`
- If "all", push `/feed` (no param)

**Loading state (status === "LoadingFirstPage"):**
- Show 3 PostCardSkeleton components

**Empty state (results.length === 0 && status !== "LoadingFirstPage"):**
- Icon: Rss01Icon in muted circle
- Title: "No posts yet" or "No {type} posts yet" based on filter
- Description: Encourage creating a post
- CTA: Button to open CreatePostDialog

**Content state:**
- Map results to PostCard components with key={post._id}
- Posts in flex flex-col gap-4 layout

**Load more button:**
- Show only when status === "CanLoadMore"
- Button variant="outline" className="w-full"
- Text: "Load more"
- onClick: () => loadMore(10)

**LoadingMore state:**
- Show spinner or "Loading..." in load more button when status === "LoadingMore"
  </action>
  <verify>
TypeScript compiles: `npx tsc --noEmit`
Page renders at /feed (manual check)
Filter tabs update URL params
  </verify>
  <done>
Feed page displays posts with infinite scroll, filter tabs update URL, create post button opens dialog
  </done>
</task>

<task type="auto">
  <name>Task 2: Add Feed to navigation</name>
  <files>src/lib/navigation.ts</files>
  <action>
Update navigation.ts to add Feed link for all user roles.

Find the navigation configuration and add a Feed item. Based on existing patterns:
- Add Feed to the main navigation section (likely after Dashboard or similar)
- Use Rss01Icon or similar feed icon from Hugeicons
- Link to /feed
- Should be visible to all authenticated roles (investor, broker, mortgage_advisor, lawyer)

The exact location depends on the navigation structure - add it in a logical place (likely in a "Community" or main section).

If there's a getNavigationForRole function, ensure Feed is included for all roles.
  </action>
  <verify>
TypeScript compiles: `npx tsc --noEmit`
Feed link appears in navigation for all roles
  </verify>
  <done>
Feed accessible from sidebar navigation for all user roles
  </done>
</task>

</tasks>

<verification>
- /feed page loads without errors
- Posts display using PostCard components
- Filter tabs work and update URL (?type=property_listing, etc.)
- "Load more" button appears when more posts available
- Empty state shows when no posts
- Create Post button opens CreatePostDialog
- Feed link appears in navigation sidebar
</verification>

<success_criteria>
- User can navigate to /feed from sidebar
- Feed shows posts from globalFeed query
- Scrolling to bottom or clicking "Load more" loads additional posts
- Clicking filter tab updates URL and filters posts
- Clicking "Create Post" opens the dialog from Phase 22
- Empty state displays appropriate message and CTA
</success_criteria>

<output>
After completion, create `.planning/phases/23-feed-display/23-02-SUMMARY.md`
</output>
