---
phase: 30-rtl-component-patches
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/ui/sidebar.tsx
  - src/components/layout/Sidebar.tsx
autonomous: true

must_haves:
  truths:
    - "User in Hebrew mode sees sidebar on the right side of the screen"
    - "User in Hebrew mode sees tooltip appearing to the left of collapsed sidebar items"
    - "Mobile sidebar sheet slides from correct edge based on direction"
  artifacts:
    - path: "src/components/ui/sidebar.tsx"
      provides: "Direction-aware sidebar with dynamic side prop"
      contains: "useDirection"
    - path: "src/components/layout/Sidebar.tsx"
      provides: "AppSidebar using direction-aware configuration"
      contains: "useDirection"
  key_links:
    - from: "src/components/ui/sidebar.tsx"
      to: "@radix-ui/react-direction"
      via: "useDirection hook"
      pattern: "useDirection"
    - from: "src/components/layout/Sidebar.tsx"
      to: "src/components/ui/sidebar.tsx"
      via: "Sidebar side prop"
      pattern: "side=\\{sidebarSide\\}"
---

<objective>
Make the Shadcn Sidebar component direction-aware so it appears on the right side in RTL mode (Hebrew) and left side in LTR mode (English).

Purpose: Sidebar placement is a fundamental RTL layout expectation - users reading right-to-left expect navigation on the right (the start side).

Output: Sidebar.tsx and layout/Sidebar.tsx updated with direction-aware side prop and tooltip positioning.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/milestones/v1.4-ROADMAP.md
@.planning/STATE.md
@.planning/phases/30-rtl-component-patches/30-RESEARCH.md
@src/components/ui/sidebar.tsx
@src/components/layout/Sidebar.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add direction-awareness to sidebar.tsx</name>
  <files>src/components/ui/sidebar.tsx</files>
  <action>
Update the Sidebar component in src/components/ui/sidebar.tsx to make the `side` prop direction-aware:

1. Add import at top:
   ```typescript
   import { useDirection } from "@radix-ui/react-direction";
   ```

2. Inside the `Sidebar` function component, after the `useSidebar()` call, add direction detection:
   ```typescript
   const direction = useDirection();
   const effectiveSide = side ?? (direction === "rtl" ? "right" : "left");
   ```

3. Replace all usages of `side` variable with `effectiveSide` within the function:
   - In the mobile Sheet's SheetContent `side={effectiveSide}`
   - In the desktop sidebar's `data-side={effectiveSide}` attribute
   - In the sidebar-container's className conditionals (`effectiveSide === "left"` etc.)

4. Update `SidebarMenuButton` tooltip to be direction-aware:
   - Inside the function, after getting `isMobile` and `state` from useSidebar:
     ```typescript
     const direction = useDirection();
     const tooltipSide = direction === "rtl" ? "left" : "right";
     ```
   - Change `<TooltipContent side="right"` to `<TooltipContent side={tooltipSide}`

Note: The `side` prop now acts as an override. If not provided, the component automatically chooses the appropriate side based on document direction.
  </action>
  <verify>Run `grep -n "useDirection" src/components/ui/sidebar.tsx` - should show 2 usages (Sidebar and SidebarMenuButton)</verify>
  <done>Sidebar component automatically positions on right in RTL mode, left in LTR mode. Tooltip appears on opposite side of sidebar.</done>
</task>

<task type="auto">
  <name>Task 2: Update layout AppSidebar to use direction</name>
  <files>src/components/layout/Sidebar.tsx</files>
  <action>
Update src/components/layout/Sidebar.tsx to explicitly pass direction-aware side prop to Sidebar:

1. Add import:
   ```typescript
   import { useDirection } from "@radix-ui/react-direction";
   ```

2. Inside the `AppSidebar` function, add:
   ```typescript
   const direction = useDirection();
   const sidebarSide = direction === "rtl" ? "right" : "left";
   ```

3. Update the Sidebar component usage:
   ```tsx
   <Sidebar side={sidebarSide} collapsible="icon">
   ```

This makes the direction explicit at the usage site, ensuring clear intent and easier debugging.
  </action>
  <verify>Run `grep -n "side={sidebarSide}" src/components/layout/Sidebar.tsx` - should show the prop being passed</verify>
  <done>AppSidebar explicitly passes direction-aware side prop to Sidebar component</done>
</task>

</tasks>

<verification>
1. Start the dev server: `npm run dev`
2. Navigate to `/he/dashboard` (Hebrew/RTL mode)
3. Verify sidebar appears on the RIGHT side of the screen
4. Navigate to `/en/dashboard` (English/LTR mode)
5. Verify sidebar appears on the LEFT side of the screen
6. Test collapsed sidebar tooltip:
   - In `/he/` mode: collapse sidebar, hover over icon - tooltip should appear on LEFT
   - In `/en/` mode: collapse sidebar, hover over icon - tooltip should appear on RIGHT
7. Test mobile sidebar:
   - In `/he/` mode: open mobile sidebar - sheet should slide from RIGHT
   - In `/en/` mode: open mobile sidebar - sheet should slide from LEFT
</verification>

<success_criteria>
- Sidebar positioned correctly in both locales
- Tooltip positioned correctly in both locales
- Mobile sheet slides from correct edge
- No console errors related to direction
</success_criteria>

<output>
After completion, create `.planning/phases/30-rtl-component-patches/30-01-SUMMARY.md`
</output>
