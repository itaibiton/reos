---
phase: 35-mobile-foundation
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/layout/AppShell.tsx
  - src/app/[locale]/(main)/page.tsx
  - src/app/[locale]/(auth)/sign-in/[[...sign-in]]/page.tsx
  - src/app/[locale]/(auth)/sign-up/[[...sign-up]]/page.tsx
  - src/components/landing/Hero/Hero.tsx
  - src/app/[locale]/(app)/properties/[id]/page.tsx
  - src/app/[locale]/(app)/layout.tsx
autonomous: true
user_setup: []

must_haves:
  truths:
    - "User on iOS Safari sees full-height layouts without address bar overlap"
    - "User on mobile can scroll to bottom of page without content being cut off"
    - "useIsMobile() hook returns true for viewports under 768px"
  artifacts:
    - path: "src/components/layout/AppShell.tsx"
      provides: "Dynamic viewport height for main content"
      contains: "100dvh"
    - path: "src/app/[locale]/(app)/layout.tsx"
      provides: "Dynamic viewport height for loading/error states"
      contains: "min-h-dvh"
    - path: "src/app/[locale]/(main)/page.tsx"
      provides: "Dynamic viewport height for landing page"
      contains: "min-h-dvh"
  key_links:
    - from: "src/components/layout/AppShell.tsx"
      to: "useIsMobile hook"
      via: "import from hooks/use-mobile"
      pattern: "useIsMobile"
---

<objective>
Convert all 100vh/min-h-screen usages to 100dvh/min-h-dvh for iOS Safari compatibility.

Purpose: iOS Safari calculates 100vh as maximum viewport height (when browser chrome is hidden), causing content to be clipped when browser UI is visible. Dynamic viewport units (dvh) fix this by adjusting to actual visible viewport.

Output: All full-height layouts use dynamic viewport units, working correctly on iOS Safari.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/milestones/v1.5-ROADMAP.md
@.planning/STATE.md
@.planning/phases/35-mobile-foundation/35-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Convert AppShell and app layout</name>
  <files>
    src/components/layout/AppShell.tsx
    src/app/[locale]/(app)/layout.tsx
  </files>
  <action>
    In src/components/layout/AppShell.tsx:
    - Find line ~372 with `h-[calc(100vh-4rem)]`
    - Change to `h-[calc(100dvh-4rem)]`
    - This is the main content area height calculation

    In src/app/[locale]/(app)/layout.tsx:
    - Find all instances of `min-h-screen` (lines ~61, ~70)
    - Change to `min-h-dvh`
    - These are loading and error state containers

    Keep all other classes unchanged. Only replace the viewport unit.
  </action>
  <verify>
    Run `npm run build` - should complete without errors.
    Grep for "100vh" in AppShell.tsx - should NOT find any.
    Grep for "min-h-screen" in (app)/layout.tsx - should NOT find any.
    Grep for "100dvh" in AppShell.tsx - should find it.
  </verify>
  <done>
    - AppShell.tsx uses h-[calc(100dvh-4rem)] for content height
    - (app)/layout.tsx uses min-h-dvh for loading/error states
    - No 100vh or min-h-screen remaining in these files
  </done>
</task>

<task type="auto">
  <name>Task 2: Convert auth and landing pages</name>
  <files>
    src/app/[locale]/(auth)/sign-in/[[...sign-in]]/page.tsx
    src/app/[locale]/(auth)/sign-up/[[...sign-up]]/page.tsx
    src/app/[locale]/(main)/page.tsx
    src/components/landing/Hero/Hero.tsx
  </files>
  <action>
    In src/app/[locale]/(auth)/sign-in/[[...sign-in]]/page.tsx:
    - Find `min-h-screen` (line ~5)
    - Change to `min-h-dvh`

    In src/app/[locale]/(auth)/sign-up/[[...sign-up]]/page.tsx:
    - Find `min-h-screen` (line ~5)
    - Change to `min-h-dvh`

    In src/app/[locale]/(main)/page.tsx:
    - Find `min-h-screen` (line ~25)
    - Change to `min-h-dvh`

    In src/components/landing/Hero/Hero.tsx:
    - Find `min-h-screen` (line ~256)
    - Change to `min-h-dvh`

    Keep all other classes unchanged.
  </action>
  <verify>
    Run `npm run build` - should complete without errors.
    Grep for "min-h-screen" in these 4 files - should NOT find any.
    Grep for "min-h-dvh" in these 4 files - should find them.
  </verify>
  <done>
    - sign-in page uses min-h-dvh
    - sign-up page uses min-h-dvh
    - main landing page uses min-h-dvh
    - Hero component uses min-h-dvh
  </done>
</task>

<task type="auto">
  <name>Task 3: Convert property detail page</name>
  <files>
    src/app/[locale]/(app)/properties/[id]/page.tsx
  </files>
  <action>
    In src/app/[locale]/(app)/properties/[id]/page.tsx:
    - Find all instances of `min-h-screen` (lines ~61, ~105, ~230)
    - Change all to `min-h-dvh`
    - These are for loading, error, and not-found states plus main content wrapper

    Keep all other classes unchanged.
  </action>
  <verify>
    Run `npm run build` - should complete without errors.
    Grep for "min-h-screen" in properties/[id]/page.tsx - should NOT find any.
    Grep for "min-h-dvh" in properties/[id]/page.tsx - should find multiple.
  </verify>
  <done>
    - Property detail page uses min-h-dvh for all full-height containers
    - No min-h-screen remaining
  </done>
</task>

</tasks>

<verification>
After all tasks complete:
1. `npm run build` succeeds without errors
2. `grep -r "100vh\|min-h-screen" src/` shows no matches in modified files (may exist in unrelated files)
3. All converted files use dvh units instead:
   - `grep -r "100dvh\|min-h-dvh" src/components/layout/AppShell.tsx src/app/[locale]/(app)/layout.tsx src/app/[locale]/(main)/page.tsx src/components/landing/Hero/Hero.tsx src/app/[locale]/(app)/properties/[id]/page.tsx src/app/[locale]/(auth)/`
</verification>

<success_criteria>
- FND-01 satisfied: Viewport uses 100dvh for full-height layouts (not 100vh)
- All 8 instances of 100vh/min-h-screen converted to dvh equivalents
- Build passes without errors
- No visual regressions on desktop (same behavior)
</success_criteria>

<output>
After completion, create `.planning/phases/35-mobile-foundation/35-02-SUMMARY.md`
</output>
