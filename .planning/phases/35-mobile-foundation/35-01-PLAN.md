---
phase: 35-mobile-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/[locale]/layout.tsx
  - src/app/[locale]/Providers.tsx
  - src/app/globals.css
autonomous: true
user_setup: []

must_haves:
  truths:
    - "User on iPhone with notch sees content not hidden behind home indicator"
    - "App root wrapped with next-themes ThemeProvider"
    - "Sonner toast useTheme hook receives valid theme value (not undefined)"
  artifacts:
    - path: "src/app/[locale]/layout.tsx"
      provides: "Viewport configuration with viewportFit: cover"
      contains: "viewportFit: 'cover'"
    - path: "src/app/[locale]/layout.tsx"
      provides: "suppressHydrationWarning on html tag"
      contains: "suppressHydrationWarning"
    - path: "src/app/[locale]/Providers.tsx"
      provides: "ThemeProvider wrapper"
      contains: "ThemeProvider"
    - path: "src/app/globals.css"
      provides: "Safe area CSS utilities"
      contains: "safe-area-inset-bottom"
  key_links:
    - from: "src/app/[locale]/Providers.tsx"
      to: "next-themes"
      via: "ThemeProvider import"
      pattern: "import.*ThemeProvider.*from.*next-themes"
    - from: "src/app/[locale]/layout.tsx"
      to: "viewport meta"
      via: "export const viewport"
      pattern: "export const viewport"
---

<objective>
Configure viewport meta tag for iOS safe-area support and wire up ThemeProvider.

Purpose: Establish the CSS and provider foundation required for mobile responsive features. Without viewport-fit: cover, safe-area-inset CSS variables return 0. Without ThemeProvider, the existing Sonner component's useTheme hook returns undefined.

Output: Configured viewport export, ThemeProvider wrapping application, safe-area CSS utility classes.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/milestones/v1.5-ROADMAP.md
@.planning/STATE.md
@.planning/phases/35-mobile-foundation/35-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Configure viewport and ThemeProvider</name>
  <files>
    src/app/[locale]/layout.tsx
    src/app/[locale]/Providers.tsx
  </files>
  <action>
    In src/app/[locale]/layout.tsx:
    1. Import Viewport type from "next"
    2. Add viewport export AFTER metadata export:
       ```typescript
       export const viewport: Viewport = {
         width: 'device-width',
         initialScale: 1,
         viewportFit: 'cover',  // CRITICAL for env(safe-area-inset-*) to work
       };
       ```
    3. Add suppressHydrationWarning to the html tag (required for next-themes):
       ```typescript
       <html
         lang={locale}
         dir={direction}
         suppressHydrationWarning  // Required for next-themes
         className={...}
       >
       ```

    In src/app/[locale]/Providers.tsx:
    1. Import ThemeProvider from "next-themes"
    2. Wrap the existing provider tree with ThemeProvider as the OUTERMOST wrapper:
       ```typescript
       export function Providers({ children, locale, direction, messages }: Props) {
         return (
           <ThemeProvider
             attribute="class"           // Matches Tailwind's .dark class selector
             defaultTheme="system"       // Respects OS preference
             enableSystem                // Auto-switch on OS change
             disableTransitionOnChange   // Prevents flash during theme switch
           >
             <DirectionProvider dir={direction}>
               <NextIntlClientProvider locale={locale} messages={messages}>
                 {children}
               </NextIntlClientProvider>
             </DirectionProvider>
           </ThemeProvider>
         );
       }
       ```

    Configuration reasoning:
    - attribute="class": REOS uses @custom-variant dark (&:is(.dark *)) which expects .dark class
    - defaultTheme="system": Respects user's OS dark mode preference
    - enableSystem: Auto-switches when user changes OS preference
    - disableTransitionOnChange: Prevents jarring color flash during hydration
  </action>
  <verify>
    Run `npm run build` - should complete without errors.
    Grep for "suppressHydrationWarning" in layout.tsx - should find it.
    Grep for "ThemeProvider" in Providers.tsx - should find it.
  </verify>
  <done>
    - layout.tsx exports viewport with viewportFit: 'cover'
    - layout.tsx html tag has suppressHydrationWarning
    - Providers.tsx wraps children with ThemeProvider
    - Build succeeds
  </done>
</task>

<task type="auto">
  <name>Task 2: Add safe-area CSS utilities</name>
  <files>
    src/app/globals.css
  </files>
  <action>
    Add to src/app/globals.css AFTER the existing :root block (before .dark):

    1. Add CSS variables for layout heights (add to :root block):
       ```css
       :root {
         /* ... existing variables ... */
         --header-height: 4rem;      /* 64px - matches current h-16 */
         --tab-bar-height: 4rem;     /* 64px - for bottom tab bar */
       }
       ```

    2. Add safe-area utility classes in a NEW @layer utilities block (at the end of file):
       ```css
       /* Safe area utilities for mobile devices with notches/home indicators */
       @layer utilities {
         .safe-area-bottom {
           padding-bottom: env(safe-area-inset-bottom, 0px);
         }

         .safe-area-top {
           padding-top: env(safe-area-inset-top, 0px);
         }

         .safe-area-left {
           padding-left: env(safe-area-inset-left, 0px);
         }

         .safe-area-right {
           padding-right: env(safe-area-inset-right, 0px);
         }

         /* Full height accounting for header (used in app layouts) */
         .h-app-content {
           height: calc(100dvh - var(--header-height));
         }

         /* Full height accounting for header and tab bar (mobile with bottom nav) */
         .h-app-content-mobile {
           height: calc(100dvh - var(--header-height) - var(--tab-bar-height) - env(safe-area-inset-bottom, 0px));
         }
       }
       ```

    Note: These utilities will be used by the bottom tab bar in Phase 37.
  </action>
  <verify>
    Run `npm run build` - should complete without errors.
    Grep for "safe-area-inset-bottom" in globals.css - should find it.
    Grep for "--tab-bar-height" in globals.css - should find it.
  </verify>
  <done>
    - globals.css has --header-height and --tab-bar-height CSS variables
    - globals.css has .safe-area-bottom, .safe-area-top utility classes
    - globals.css has .h-app-content and .h-app-content-mobile utilities
    - Build succeeds
  </done>
</task>

</tasks>

<verification>
After both tasks complete:
1. `npm run build` succeeds without errors
2. `grep -r "viewportFit" src/app/[locale]/layout.tsx` shows viewport-fit: cover
3. `grep -r "ThemeProvider" src/app/[locale]/Providers.tsx` shows import and usage
4. `grep -r "safe-area-inset" src/app/globals.css` shows utility classes
</verification>

<success_criteria>
- FND-02 satisfied: CSS env() safe-area-inset variables configured and utility classes available
- FND-03 satisfied: ThemeProvider properly wraps application with attribute="class", defaultTheme="system", enableSystem
- Build passes without errors
- No hydration warnings related to theme
</success_criteria>

<output>
After completion, create `.planning/phases/35-mobile-foundation/35-01-SUMMARY.md`
</output>
