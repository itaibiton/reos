---
phase: 32-locale-formatting
plan: 05
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/properties/NeighborhoodInfo.tsx
  - src/components/search/FilterChips.tsx
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "NeighborhoodInfo displays population and price in locale-aware format"
    - "FilterChips displays prices in locale-aware format"
  artifacts:
    - path: "src/components/properties/NeighborhoodInfo.tsx"
      provides: "Locale-aware neighborhood statistics"
      contains: "useFormatter"
    - path: "src/components/search/FilterChips.tsx"
      provides: "Locale-aware filter chip display"
      contains: "useFormatter"
  key_links:
    - from: "src/components/properties/NeighborhoodInfo.tsx"
      to: "next-intl"
      via: "useFormatter import"
      pattern: "import.*useFormatter.*from.*next-intl"
    - from: "src/components/search/FilterChips.tsx"
      to: "next-intl"
      via: "useFormatter import"
      pattern: "import.*useFormatter.*from.*next-intl"
---

<objective>
Close formatting gaps found in Phase 32 verification: migrate 2 remaining components from hardcoded `Intl.NumberFormat("en-US")` to locale-aware `useFormatter()`.

Purpose: Complete FMT-02 and FMT-03 requirements by removing all hardcoded locale formatters.
Output: Both components display numbers and currency in user's locale.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/milestones/v1.4-ROADMAP.md
@.planning/phases/32-locale-formatting/32-VERIFICATION.md

# Pattern reference
@src/components/properties/PropertyCard.tsx (lines 1-50 for useFormatter pattern)
@src/i18n/request.ts (format presets)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate NeighborhoodInfo.tsx to useFormatter</name>
  <files>src/components/properties/NeighborhoodInfo.tsx</files>
  <action>
Replace hardcoded Intl.NumberFormat calls with next-intl useFormatter:

1. Add useFormatter to the existing next-intl import:
   `import { useTranslations, useFormatter } from "next-intl";`

2. Inside the component, get the formatter:
   `const format = useFormatter();`

3. Remove the standalone helper functions (formatPopulation and formatPricePerSqm) from outside the component.

4. Replace inline usages:
   - `formatPopulation(population)` becomes `format.number(population)`
   - `formatPricePerSqm(avgPricePerSqm)` becomes `format.number(avgPricePerSqm, { style: 'currency', currency: 'USD', maximumFractionDigits: 0 })`

Note: Keep formatPercentChange as-is since percentage formatting with sign prefix is specialized logic not handled by standard number formatters.
  </action>
  <verify>
Run `grep -n "Intl.NumberFormat" src/components/properties/NeighborhoodInfo.tsx` - should return no matches.
Run `grep -n "useFormatter" src/components/properties/NeighborhoodInfo.tsx` - should show the import and usage.
  </verify>
  <done>NeighborhoodInfo uses format.number() for population and currency display, no hardcoded "en-US" remains.</done>
</task>

<task type="auto">
  <name>Task 2: Migrate FilterChips.tsx to useFormatter</name>
  <files>src/components/search/FilterChips.tsx</files>
  <action>
Replace hardcoded Intl.NumberFormat in formatPrice helper:

1. Add useFormatter import from next-intl:
   `import { useFormatter } from "next-intl";`

2. Inside the FilterChips component, get the formatter:
   `const format = useFormatter();`

3. Replace the formatPrice helper function. Instead of standalone function:
   ```
   const formatPrice = (price: number): string => {
     return new Intl.NumberFormat("en-US", {
       style: "currency",
       currency: "USD",
       minimumFractionDigits: 0,
       maximumFractionDigits: 0,
     }).format(price);
   };
   ```

   Use inline or a simple wrapper:
   ```
   const formatPrice = (price: number): string => {
     return format.number(price, { style: 'currency', currency: 'USD', maximumFractionDigits: 0 });
   };
   ```

4. The rest of the component (formatPropertyType, filter chip rendering) remains unchanged.

Note: FilterChips also has hardcoded English labels like "City", "Type", "Price", "From", "Up to", "beds", "baths", "Clear all". These are translation concerns (Phase 31) not formatting concerns. Focus only on the number formatting for this gap closure.
  </action>
  <verify>
Run `grep -n "Intl.NumberFormat" src/components/search/FilterChips.tsx` - should return no matches.
Run `grep -n "useFormatter" src/components/search/FilterChips.tsx` - should show the import and usage.
  </verify>
  <done>FilterChips uses format.number() for price display, no hardcoded "en-US" remains.</done>
</task>

</tasks>

<verification>
After both tasks complete:

1. No hardcoded locales in target files:
   ```bash
   grep -r "Intl.NumberFormat.*en-US" src/components/properties/NeighborhoodInfo.tsx src/components/search/FilterChips.tsx
   ```
   Expected: No output (no matches)

2. Both files use useFormatter:
   ```bash
   grep -l "useFormatter" src/components/properties/NeighborhoodInfo.tsx src/components/search/FilterChips.tsx
   ```
   Expected: Both files listed

3. Build passes:
   ```bash
   npm run build
   ```
   Expected: No TypeScript errors related to changed files
</verification>

<success_criteria>
- NeighborhoodInfo.tsx displays population and price/sqm using locale-aware formatter
- FilterChips.tsx displays prices using locale-aware formatter
- No "en-US" hardcoded strings remain in either file
- Build completes without errors
- FMT-02 and FMT-03 requirements now fully satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/32-locale-formatting/32-05-SUMMARY.md`
</output>
