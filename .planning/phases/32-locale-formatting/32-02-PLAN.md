---
phase: 32-locale-formatting
plan: 02
type: execute
wave: 2
depends_on: ["01"]
files_modified:
  - src/components/dashboard/ProviderDashboard.tsx
  - src/components/dashboard/InvestorDashboard.tsx
  - src/components/dashboard/RecommendedProperties.tsx
  - src/components/dashboard/DashboardMapClient.tsx
  - src/components/notifications/NotificationCenter.tsx
  - src/components/chat/ConversationSelector.tsx
  - src/components/chat/ChatMessage.tsx
autonomous: true

must_haves:
  truths:
    - "Dashboard components display dates and currency in locale-aware format"
    - "Relative time displays locale-appropriate strings (e.g., 'yesterday' vs Hebrew equivalent)"
    - "Chat timestamps display in locale-aware format"
    - "Notification timestamps use locale-aware relative time"
  artifacts:
    - path: "src/components/dashboard/ProviderDashboard.tsx"
      provides: "Locale-aware provider dashboard"
      contains: "useFormatter"
    - path: "src/components/notifications/NotificationCenter.tsx"
      provides: "Locale-aware notification timestamps"
      contains: "useFormatter"
    - path: "src/components/chat/ChatMessage.tsx"
      provides: "Locale-aware chat timestamps"
      contains: "useFormatter"
  key_links:
    - from: "src/components/dashboard/ProviderDashboard.tsx"
      to: "next-intl"
      via: "useFormatter and useNow for relative time"
      pattern: "format\\.relativeTime"
---

<objective>
Migrate dashboard and real-time components (notifications, chat) to use locale-aware formatting.

Purpose: Convert date, currency, and relative time formatting in dashboard and communication components to use useFormatter, ensuring Hebrew users see properly localized timestamps.

Output: 7 components using useFormatter for dates, currency, and relative time display.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/milestones/v1.4-ROADMAP.md
@.planning/STATE.md
@.planning/phases/32-locale-formatting/32-RESEARCH.md
@.planning/phases/32-locale-formatting/32-01-SUMMARY.md

@src/components/dashboard/ProviderDashboard.tsx
@src/components/notifications/NotificationCenter.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate ProviderDashboard formatting</name>
  <files>src/components/dashboard/ProviderDashboard.tsx</files>
  <action>
1. Add imports: `import { useFormatter, useNow } from "next-intl";`
2. Remove local helper functions: `formatDate`, `formatRelativeTime`, `formatUSD`
3. In component, add:
   ```typescript
   const format = useFormatter();
   const now = useNow({ updateInterval: 1000 * 60 }); // Update every minute
   ```
4. Replace `formatUSD(amount)` with:
   `format.number(amount, { style: 'currency', currency: 'USD', maximumFractionDigits: 0 })`
5. Replace `formatDate(timestamp)` with:
   `format.dateTime(new Date(timestamp), 'monthDay')`
6. Replace `formatRelativeTime(timestamp)` with:
   `format.relativeTime(new Date(timestamp), now)`

Note: The relativeTime will automatically return locale-appropriate strings like "just now", "2 hours ago", "yesterday" in English, and Hebrew equivalents when locale is he.
  </action>
  <verify>File compiles: `cd /Users/Kohelet/Code/REOS && npx tsc --noEmit src/components/dashboard/ProviderDashboard.tsx`</verify>
  <done>ProviderDashboard uses useFormatter for all date, currency, and relative time formatting</done>
</task>

<task type="auto">
  <name>Task 2: Migrate NotificationCenter, ConversationSelector, ChatMessage</name>
  <files>src/components/notifications/NotificationCenter.tsx, src/components/chat/ConversationSelector.tsx, src/components/chat/ChatMessage.tsx</files>
  <action>
For NotificationCenter.tsx:
1. Add imports: `import { useFormatter, useNow } from "next-intl";`
2. Remove local `formatRelativeTime` function
3. Create a wrapper component or pass format/now as props to NotificationItem, OR move the formatting into NotificationCenter and pass formatted string
4. Alternative: Use useFormatter inside NotificationItem directly (simpler)
5. Replace `formatRelativeTime(notification.createdAt)` with:
   `format.relativeTime(new Date(notification.createdAt), now)`

For ConversationSelector.tsx:
1. Check if it has formatRelativeTime - if so, same pattern as above
2. Add useFormatter, useNow imports
3. Replace hardcoded relative time with format.relativeTime()

For ChatMessage.tsx:
1. Add imports: `import { useFormatter, useNow, useTranslations } from "next-intl";`
2. Remove local `formatMessageTime` function
3. Get formatter and now:
   ```typescript
   const format = useFormatter();
   const now = useNow({ updateInterval: 1000 * 60 });
   const t = useTranslations("chat");
   ```
4. For time display logic:
   - If today: `format.dateTime(new Date(timestamp), 'time')`
   - If yesterday: `t('time.yesterday') + ' ' + format.dateTime(new Date(timestamp), 'time')`
     (Add "yesterday" to chat.time namespace if not exists, or use format.relativeTime for day check)
   - Otherwise: `format.dateTime(new Date(timestamp), 'dateTime')`

Note: For "Yesterday" string, either:
- Add translation key chat.time.yesterday
- Or use custom logic with format.dateTime for the time portion only
  </action>
  <verify>All files compile: `cd /Users/Kohelet/Code/REOS && npx tsc --noEmit src/components/notifications/NotificationCenter.tsx src/components/chat/ConversationSelector.tsx src/components/chat/ChatMessage.tsx`</verify>
  <done>Notification and chat components use locale-aware time formatting</done>
</task>

<task type="auto">
  <name>Task 3: Migrate remaining dashboard components</name>
  <files>src/components/dashboard/InvestorDashboard.tsx, src/components/dashboard/RecommendedProperties.tsx, src/components/dashboard/DashboardMapClient.tsx</files>
  <action>
For InvestorDashboard.tsx:
1. Check for formatDate usage
2. Add `import { useFormatter } from "next-intl";`
3. Replace any hardcoded date formatting with format.dateTime()

For RecommendedProperties.tsx:
1. Add `import { useFormatter } from "next-intl";`
2. Remove local formatUSD/formatILS helpers
3. Replace currency formatting with:
   `format.number(priceUsd, { style: 'currency', currency: 'USD', maximumFractionDigits: 0 })`
   `format.number(priceIls, { style: 'currency', currency: 'ILS', maximumFractionDigits: 0 })`

For DashboardMapClient.tsx:
1. Add `import { useFormatter } from "next-intl";`
2. Remove local formatUSD helper
3. Replace currency formatting with useFormatter pattern
  </action>
  <verify>All files compile: `cd /Users/Kohelet/Code/REOS && npx tsc --noEmit src/components/dashboard/InvestorDashboard.tsx src/components/dashboard/RecommendedProperties.tsx src/components/dashboard/DashboardMapClient.tsx`</verify>
  <done>All dashboard components use locale-aware formatting</done>
</task>

</tasks>

<verification>
1. TypeScript compiles without errors: `npx tsc --noEmit`
2. No hardcoded formatRelativeTime remains: `grep -r "function formatRelativeTime" src/components/dashboard src/components/notifications src/components/chat` returns nothing
3. useFormatter is imported in all migrated files
</verification>

<success_criteria>
- ProviderDashboard uses useFormatter for currency, dates, and relative time
- InvestorDashboard uses useFormatter for date formatting
- RecommendedProperties uses useFormatter for dual currency (USD/ILS)
- DashboardMapClient uses useFormatter for currency
- NotificationCenter uses useFormatter with useNow for relative timestamps
- ConversationSelector uses useFormatter for timestamps
- ChatMessage uses useFormatter for message timestamps
- No hardcoded "en-US" locale strings remain in migrated files
- TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/32-locale-formatting/32-02-SUMMARY.md`
</output>
