---
phase: 32-locale-formatting
plan: 04
type: execute
wave: 2
depends_on: ["01"]
files_modified:
  - src/components/questionnaire/steps/BudgetStep.tsx
  - src/components/questionnaire/steps/PropertySizeStep.tsx
  - src/components/search/GlobalSearchBar.tsx
  - src/components/settings/AvailabilitySettings.tsx
  - src/components/properties/ValueHistoryChart.tsx
  - src/components/ui/calendar.tsx
autonomous: true

must_haves:
  truths:
    - "Questionnaire steps display numbers in locale-aware format"
    - "Search displays results with locale-aware formatting"
    - "Calendar displays month names in user's locale"
    - "Chart axes display locale-aware formatted values"
  artifacts:
    - path: "src/components/questionnaire/steps/BudgetStep.tsx"
      provides: "Locale-aware budget input display"
      contains: "useFormatter"
    - path: "src/components/settings/AvailabilitySettings.tsx"
      provides: "Locale-aware date display in settings"
      contains: "useFormatter"
    - path: "src/components/ui/calendar.tsx"
      provides: "Locale-aware calendar"
      contains: "useLocale"
  key_links:
    - from: "src/components/questionnaire/steps/BudgetStep.tsx"
      to: "next-intl"
      via: "useFormatter import"
      pattern: "useFormatter.*from.*next-intl"
    - from: "src/components/ui/calendar.tsx"
      to: "next-intl"
      via: "useLocale for month names"
      pattern: "useLocale"
---

<objective>
Migrate remaining components including questionnaire, search, settings, charts, and calendar to use locale-aware formatting.

Purpose: Complete the locale formatting migration by converting questionnaire inputs, search results, availability settings, charts, and the calendar component to respect the user's locale.

Output: 6 files using useFormatter or locale-aware patterns for number and date display.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/milestones/v1.4-ROADMAP.md
@.planning/STATE.md
@.planning/phases/32-locale-formatting/32-RESEARCH.md
@.planning/phases/32-locale-formatting/32-01-SUMMARY.md

@src/components/ui/calendar.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate questionnaire steps</name>
  <files>src/components/questionnaire/steps/BudgetStep.tsx, src/components/questionnaire/steps/PropertySizeStep.tsx</files>
  <action>
For BudgetStep.tsx:
1. Add `import { useFormatter } from "next-intl";`
2. Get formatter: `const format = useFormatter();`
3. Replace `toLocaleString("en-US")` with:
   `format.number(value)` for plain numbers
4. For currency display in labels/hints:
   `format.number(value, { style: 'currency', currency: 'USD', maximumFractionDigits: 0 })`

For PropertySizeStep.tsx:
1. Add `import { useFormatter } from "next-intl";`
2. Get formatter: `const format = useFormatter();`
3. Replace any `toLocaleString("en-US")` calls with:
   `format.number(value)` for square meters display
  </action>
  <verify>Both files compile: `cd /Users/Kohelet/Code/REOS && npx tsc --noEmit src/components/questionnaire/steps/BudgetStep.tsx src/components/questionnaire/steps/PropertySizeStep.tsx`</verify>
  <done>Questionnaire steps display numbers in locale-aware format</done>
</task>

<task type="auto">
  <name>Task 2: Migrate search, settings, and chart components</name>
  <files>src/components/search/GlobalSearchBar.tsx, src/components/settings/AvailabilitySettings.tsx, src/components/properties/ValueHistoryChart.tsx</files>
  <action>
For GlobalSearchBar.tsx:
1. Check for any toLocaleString or date formatting
2. Add `import { useFormatter } from "next-intl";` if formatting exists
3. Replace with useFormatter pattern

For AvailabilitySettings.tsx:
1. Add `import { useFormatter } from "next-intl";`
2. Check for formatDate helper or toLocaleDateString calls
3. Replace date formatting with:
   `format.dateTime(new Date(timestamp), 'short')` or 'medium'

For ValueHistoryChart.tsx:
1. Add `import { useFormatter } from "next-intl";`
2. Check for formatDate helper
3. For chart axis labels, format data before passing to chart:
   ```typescript
   const formattedData = data.map(point => ({
     ...point,
     formattedDate: format.dateTime(new Date(point.date), 'monthDay'),
     formattedValue: format.number(point.value, { style: 'currency', currency: 'USD', maximumFractionDigits: 0 })
   }));
   ```
4. Use formattedDate/formattedValue as dataKey in chart
  </action>
  <verify>All files compile: `cd /Users/Kohelet/Code/REOS && npx tsc --noEmit src/components/search/GlobalSearchBar.tsx src/components/settings/AvailabilitySettings.tsx src/components/properties/ValueHistoryChart.tsx`</verify>
  <done>Search, settings, and chart components use locale-aware formatting</done>
</task>

<task type="auto">
  <name>Task 3: Make Calendar locale-aware</name>
  <files>src/components/ui/calendar.tsx</files>
  <action>
The Calendar component uses react-day-picker which has built-in locale support.

1. Add import: `import { useLocale } from "next-intl";`
2. Inside Calendar component, get locale: `const locale = useLocale();`
3. Check if react-day-picker needs a locale prop:
   - If yes, import the appropriate locale from date-fns/locale and pass it
   - react-day-picker v9+ uses native Intl for formatting, so may just need:
     ```typescript
     <DayPicker
       locale={locale}  // or construct Intl-based locale object
       ...
     />
     ```
4. For the formatMonthDropdown formatter, replace hardcoded "default" with locale-aware:
   ```typescript
   formatMonthDropdown: (date) =>
     date.toLocaleString(locale, { month: "short" }),
   ```

Note: react-day-picker v9 uses the browser's Intl API by default. Setting the locale string should work:
- Check DayPicker props for locale support
- If it accepts a string locale, pass `locale` from useLocale()
- If it needs a date-fns locale object, we may need to map 'en' -> enUS, 'he' -> he from date-fns/locale
  </action>
  <verify>Calendar compiles and displays correctly: `cd /Users/Kohelet/Code/REOS && npx tsc --noEmit src/components/ui/calendar.tsx`</verify>
  <done>Calendar component displays month names and weekday headers in user's locale</done>
</task>

</tasks>

<verification>
1. TypeScript compiles without errors: `npx tsc --noEmit`
2. No hardcoded "en-US" in migrated files: `grep -r '"en-US"\|"he-IL"' src/components/questionnaire src/components/search src/components/settings` returns nothing (except intentional uses)
3. Grep confirms useFormatter or useLocale in all migrated files
</verification>

<success_criteria>
- BudgetStep displays currency values in locale-aware format
- PropertySizeStep displays numbers in locale-aware format
- GlobalSearchBar uses locale-aware formatting if applicable
- AvailabilitySettings displays dates in locale-aware format
- ValueHistoryChart displays locale-aware axis labels
- Calendar displays month names and weekdays in user's locale
- No hardcoded "en-US" locale strings remain in migrated files (except where intentional)
- TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/32-locale-formatting/32-04-SUMMARY.md`
</output>
