---
phase: 32-locale-formatting
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/i18n/request.ts
  - src/components/properties/PropertyCard.tsx
  - src/components/properties/MortgageCalculator.tsx
  - src/components/profile/PortfolioSection.tsx
autonomous: true

must_haves:
  truths:
    - "Format configuration exists with date, number, and currency presets"
    - "PropertyCard displays prices in locale-aware format"
    - "MortgageCalculator displays currency in locale-aware format"
    - "PortfolioSection displays currency in locale-aware format"
  artifacts:
    - path: "src/i18n/request.ts"
      provides: "Format presets configuration"
      contains: "formats:"
    - path: "src/components/properties/PropertyCard.tsx"
      provides: "Locale-aware property card"
      contains: "useFormatter"
    - path: "src/components/properties/MortgageCalculator.tsx"
      provides: "Locale-aware mortgage calculator"
      contains: "useFormatter"
    - path: "src/components/profile/PortfolioSection.tsx"
      provides: "Locale-aware portfolio section"
      contains: "useFormatter"
  key_links:
    - from: "src/i18n/request.ts"
      to: "next-intl"
      via: "getRequestConfig formats"
      pattern: "formats:\\s*\\{"
    - from: "src/components/properties/PropertyCard.tsx"
      to: "next-intl"
      via: "useFormatter import"
      pattern: "useFormatter.*from.*next-intl"
---

<objective>
Set up locale formatting infrastructure and migrate core property components to use useFormatter.

Purpose: Establish format presets in i18n config and convert the most-used property components to locale-aware formatting, replacing hardcoded "en-US" Intl calls.

Output: Format configuration in request.ts and 3 property-related components using useFormatter for currency display.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/milestones/v1.4-ROADMAP.md
@.planning/STATE.md
@.planning/phases/32-locale-formatting/32-RESEARCH.md

@src/i18n/request.ts
@src/components/properties/PropertyCard.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add format configuration to i18n/request.ts</name>
  <files>src/i18n/request.ts</files>
  <action>
Add formats configuration object to the getRequestConfig return value:

```typescript
formats: {
  dateTime: {
    short: {
      day: 'numeric',
      month: 'short',
      year: 'numeric'
    },
    medium: {
      day: 'numeric',
      month: 'long',
      year: 'numeric'
    },
    monthDay: {
      day: 'numeric',
      month: 'short'
    },
    full: {
      weekday: 'long',
      day: 'numeric',
      month: 'long',
      year: 'numeric'
    },
    dateTime: {
      day: 'numeric',
      month: 'short',
      year: 'numeric',
      hour: 'numeric',
      minute: 'numeric'
    },
    time: {
      hour: 'numeric',
      minute: '2-digit'
    }
  },
  number: {
    integer: {
      maximumFractionDigits: 0
    },
    decimal: {
      minimumFractionDigits: 2,
      maximumFractionDigits: 2
    },
    compact: {
      notation: 'compact'
    },
    percent: {
      style: 'percent',
      minimumFractionDigits: 1
    }
  }
}
```

This provides reusable format presets that useFormatter can reference by name.
  </action>
  <verify>TypeScript compiles without errors: `cd /Users/Kohelet/Code/REOS && npx tsc --noEmit`</verify>
  <done>Format presets exist in i18n/request.ts for dateTime and number formatting</done>
</task>

<task type="auto">
  <name>Task 2: Migrate PropertyCard to useFormatter</name>
  <files>src/components/properties/PropertyCard.tsx</files>
  <action>
Replace the hardcoded formatUSD and formatILS helper functions with useFormatter:

1. Import useFormatter from next-intl (already has useTranslations)
2. Remove the local `formatUSD` and `formatILS` helper functions
3. Get formatter in component: `const format = useFormatter();`
4. Replace `formatUSD(priceUsd)` with:
   `format.number(priceUsd, { style: 'currency', currency: 'USD', maximumFractionDigits: 0 })`
5. Replace `formatILS(...)` with:
   `format.number(ilsAmount, { style: 'currency', currency: 'ILS', maximumFractionDigits: 0 })`
6. Replace `formatUSD(monthlyRent)` similarly

Keep the formatPercent helper as-is (percentages don't need locale-specific formatting for MVP).
  </action>
  <verify>File compiles: `cd /Users/Kohelet/Code/REOS && npx tsc --noEmit src/components/properties/PropertyCard.tsx`</verify>
  <done>PropertyCard uses useFormatter for all currency formatting, no hardcoded "en-US" or "he-IL" locales</done>
</task>

<task type="auto">
  <name>Task 3: Migrate MortgageCalculator and PortfolioSection</name>
  <files>src/components/properties/MortgageCalculator.tsx, src/components/profile/PortfolioSection.tsx</files>
  <action>
For MortgageCalculator.tsx:
1. Add `import { useFormatter } from "next-intl";`
2. Remove local formatUSD helper function
3. Get formatter: `const format = useFormatter();`
4. Replace all `formatUSD(amount)` calls with:
   `format.number(amount, { style: 'currency', currency: 'USD', maximumFractionDigits: 0 })`

For PortfolioSection.tsx:
1. Add `import { useFormatter } from "next-intl";`
2. Remove local formatUSD helper function
3. Get formatter: `const format = useFormatter();`
4. Replace all `formatUSD(amount)` calls with:
   `format.number(amount, { style: 'currency', currency: 'USD', maximumFractionDigits: 0 })`
  </action>
  <verify>Both files compile: `cd /Users/Kohelet/Code/REOS && npx tsc --noEmit src/components/properties/MortgageCalculator.tsx src/components/profile/PortfolioSection.tsx`</verify>
  <done>MortgageCalculator and PortfolioSection use useFormatter for currency formatting</done>
</task>

</tasks>

<verification>
1. TypeScript compiles without errors: `npx tsc --noEmit`
2. Grep confirms no hardcoded formatUSD in migrated files: `grep -l "formatUSD" src/components/properties/PropertyCard.tsx` returns nothing
3. Grep confirms useFormatter is imported: `grep "useFormatter" src/components/properties/PropertyCard.tsx`
</verification>

<success_criteria>
- Format configuration exists in src/i18n/request.ts with dateTime and number presets
- PropertyCard uses useFormatter for USD and ILS currency formatting
- MortgageCalculator uses useFormatter for USD currency formatting
- PortfolioSection uses useFormatter for USD currency formatting
- No hardcoded "en-US" or "he-IL" locale strings remain in migrated files
- TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/32-locale-formatting/32-01-SUMMARY.md`
</output>
