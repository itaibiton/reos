---
phase: 26-user-profiles-revamp
plan: 02
type: execute
wave: 2
depends_on: ["26-01"]
files_modified:
  - src/components/profile/PortfolioSection.tsx
  - src/components/profile/StatsRow.tsx
  - src/components/profile/index.ts
  - src/app/(app)/profile/[id]/page.tsx
  - src/components/feed/DiscussionPostCard.tsx
  - src/components/feed/ServiceRequestPostCard.tsx
  - src/components/feed/PropertyPostCard.tsx
autonomous: true

must_haves:
  truths:
    - "Service provider profiles show stats row (rating, reviews, deals, experience)"
    - "Service provider profiles show Portfolio tab with completed deals"
    - "Clicking author avatar/name in post cards navigates to /profile/[authorId]"
    - "Portfolio section shows property images, titles, cities, prices"
  artifacts:
    - path: "src/components/profile/PortfolioSection.tsx"
      provides: "Portfolio display for service providers"
      min_lines: 40
    - path: "src/components/profile/StatsRow.tsx"
      provides: "Stats cards row for service providers"
      min_lines: 30
    - path: "src/components/feed/DiscussionPostCard.tsx"
      provides: "Updated post card with profile links"
      contains: "Link.*profile"
  key_links:
    - from: "src/components/feed/DiscussionPostCard.tsx"
      to: "/profile/[id]"
      via: "Link component on author area"
      pattern: "href=.*profile"
    - from: "src/app/(app)/profile/[id]/page.tsx"
      to: "src/components/profile/PortfolioSection.tsx"
      via: "PortfolioSection component"
      pattern: "PortfolioSection"
---

<objective>
Add portfolio section for service providers and link post author areas to profiles

Purpose: Complete the profile page with provider-specific content and enable social navigation from posts to profiles
Output: Service provider profiles show stats + portfolio; clicking any post author navigates to their profile
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/26-user-profiles-revamp/26-RESEARCH.md
@.planning/phases/26-user-profiles-revamp/26-01-SUMMARY.md

# Profile page from Plan 01
@src/app/(app)/profile/[id]/page.tsx
@src/components/profile/index.ts

# Provider profile pattern to follow for portfolio
@src/app/(app)/providers/[id]/page.tsx

# Post cards to update with profile links
@src/components/feed/DiscussionPostCard.tsx
@src/components/feed/ServiceRequestPostCard.tsx
@src/components/feed/PropertyPostCard.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create StatsRow and PortfolioSection components</name>
  <files>
    src/components/profile/StatsRow.tsx
    src/components/profile/PortfolioSection.tsx
    src/components/profile/index.ts
  </files>
  <action>
Create provider-specific profile components following the provider profile page pattern:

**StatsRow.tsx:**
- "use client" directive
- Props: `stats` object with { averageRating, totalReviews, completedDeals, yearsExperience }
- 4 stat cards in a grid (grid-cols-2 md:grid-cols-4 gap-4)
- Each card: Card > CardContent > centered value + label
- Card 1: Star icon (yellow-500) + averageRating.toFixed(1) + "Avg Rating"
- Card 2: User icon (blue-500) + totalReviews + "Reviews"
- Card 3: CheckmarkCircle01Icon (green-500) + completedDeals + "Deals Completed"
- Card 4: Calendar01Icon (purple-500) + yearsExperience + "Years Experience"
- Copy exact styling from provider profile page StatsRow section

**PortfolioSection.tsx:**
- "use client" directive
- Props: `portfolio` array (from getUserProfile query)
- Empty state: Building icon + "No completed deals yet." (centered, py-8, text-muted-foreground)
- If portfolio has items, map to deal cards:
  - Each card: flex gap-3 p-2 rounded-lg hover:bg-muted/50 transition-colors
  - Left: 14x14 rounded-md image (or Building05Icon placeholder)
  - Right: property title (font-medium text-sm truncate), city with Location01Icon, price in green
- Use formatUSD helper for price display
- Copy exact pattern from provider profile page Portfolio section

**Update index.ts:**
```typescript
export { ProfileHeader } from "./ProfileHeader";
export { UserPostsFeed } from "./UserPostsFeed";
export { StatsRow } from "./StatsRow";
export { PortfolioSection } from "./PortfolioSection";
```
  </action>
  <verify>
Components compile without TypeScript errors. Check with `npm run dev`.
  </verify>
  <done>
StatsRow and PortfolioSection components created with provider profile styling.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update profile page with provider sections and portfolio tab</name>
  <files>src/app/(app)/profile/[id]/page.tsx</files>
  <action>
Enhance the profile page to show provider-specific content:

1. Import StatsRow and PortfolioSection from @/components/profile
2. Determine if profile is service provider: `const isServiceProvider = profile.stats !== null;`
3. After ProfileHeader, add StatsRow conditionally:
   ```tsx
   {isServiceProvider && profile.stats && (
     <StatsRow stats={profile.stats} />
   )}
   ```
4. Update Tabs to conditionally show Portfolio tab:
   ```tsx
   <Tabs defaultValue="posts">
     <TabsList>
       <TabsTrigger value="posts">Posts</TabsTrigger>
       {isServiceProvider && (
         <TabsTrigger value="portfolio">Portfolio</TabsTrigger>
       )}
     </TabsList>
     <TabsContent value="posts" className="mt-4">
       <UserPostsFeed userId={userId} />
     </TabsContent>
     {isServiceProvider && (
       <TabsContent value="portfolio" className="mt-4">
         <PortfolioSection portfolio={profile.portfolio || []} />
       </TabsContent>
     )}
   </Tabs>
   ```
5. Ensure portfolio tab only renders for service providers
  </action>
  <verify>
1. Navigate to a service provider's profile - should show stats row + Portfolio tab
2. Navigate to an investor's profile - should NOT show stats row or Portfolio tab
3. Click Portfolio tab for provider - should show completed deals (or empty state)
  </verify>
  <done>
Profile page conditionally shows StatsRow and Portfolio tab for service providers.
  </done>
</task>

<task type="auto">
  <name>Task 3: Add profile links to post card author areas</name>
  <files>
    src/components/feed/DiscussionPostCard.tsx
    src/components/feed/ServiceRequestPostCard.tsx
    src/components/feed/PropertyPostCard.tsx
  </files>
  <action>
Update all three post card components to make author avatar and name clickable, linking to their profile.

For each file:

1. Add import: `import Link from "next/link";`

2. Wrap the Avatar component with Link:
   ```tsx
   <Link href={`/profile/${post.authorId}`}>
     <Avatar className="h-8 w-8 hover:opacity-80 transition-opacity">
       ...
     </Avatar>
   </Link>
   ```

3. Wrap the author name span with Link:
   ```tsx
   <Link
     href={`/profile/${post.authorId}`}
     className="font-medium text-sm truncate hover:underline"
   >
     {post.authorName}
   </Link>
   ```

4. Remove the outer span around the name (if it exists) since Link provides the element

Ensure:
- Avatar has hover:opacity-80 transition-opacity for visual feedback
- Name has hover:underline for visual feedback
- Links use the exact path format: `/profile/${post.authorId}`
- FollowButton remains outside the Link (should not be clickable as part of profile navigation)
- Role badge remains separate (not part of the link)

Apply the same pattern to all three post card files.
  </action>
  <verify>
1. View the feed page (/feed)
2. Click on a post author's avatar - should navigate to /profile/[authorId]
3. Click on a post author's name - should navigate to /profile/[authorId]
4. Verify hover states show (opacity change on avatar, underline on name)
5. Verify FollowButton still works independently (doesn't trigger navigation)
  </verify>
  <done>
All post cards have clickable author avatars and names that navigate to /profile/[authorId].
  </done>
</task>

</tasks>

<verification>
- [ ] StatsRow displays 4 stat cards for service providers
- [ ] PortfolioSection shows completed deals or empty state
- [ ] Profile page shows stats + Portfolio tab for service providers only
- [ ] Investor profiles do NOT show stats row or Portfolio tab
- [ ] Clicking author avatar in any post card navigates to profile
- [ ] Clicking author name in any post card navigates to profile
- [ ] Hover states visible on avatar (opacity) and name (underline)
- [ ] FollowButton in post cards still functions independently
</verification>

<success_criteria>
- Service provider profiles complete with stats and portfolio
- Social navigation enabled: users can discover profiles by clicking post authors
- Consistent hover feedback on clickable author elements
- Clean separation between profile links and follow actions
</success_criteria>

<output>
After completion, create `.planning/phases/26-user-profiles-revamp/26-02-SUMMARY.md`
</output>
