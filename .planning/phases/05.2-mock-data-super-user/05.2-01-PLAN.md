---
phase: 05.2-mock-data-super-user
plan: 01
type: execute
---

<objective>
Add mock property data, admin role, and role-switching for testing.

Purpose: Enable admins to test all user perspectives and populate marketplace with realistic Israeli properties.
Output: Seed data for 10-15 properties, admin role in schema, role-switching dropdown (admin-only).
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior phase context:
@.planning/phases/05.1-add-also-regular-filter/05.1-01-SUMMARY.md

# Key source files:
@convex/schema.ts
@convex/properties.ts
@convex/users.ts
@src/components/layout/Header.tsx
@src/lib/constants.ts

**Tech stack available:** Next.js, Convex, Shadcn/ui, Clerk
**Established patterns:**
- Convex mutations for data operations
- Shadcn DropdownMenu for selection UI
- UserButton placement in Header

**Constraining decisions:**
- Phase 4: USD/ILS rate as constant (3.7) for MVP
- Phase 4: Any authenticated user can create properties
- Phase 2: User roles: investor, broker, mortgage_advisor, lawyer
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add admin role to schema</name>
  <files>convex/schema.ts, convex/users.ts, src/lib/constants.ts</files>
  <action>
Add "admin" as a 5th user role:

1. `convex/schema.ts` - Add `v.literal("admin")` to userRoles union

2. `convex/users.ts` - Update setUserRole mutation to accept "admin" in the validator

3. `src/lib/constants.ts` - Add USER_ROLES constant array:
   ```ts
   export const USER_ROLES = [
     { value: "investor", label: "Investor" },
     { value: "broker", label: "Broker" },
     { value: "mortgage_advisor", label: "Mortgage Advisor" },
     { value: "lawyer", label: "Lawyer" },
     { value: "admin", label: "Admin" },
   ] as const;
   ```

Admin role is for platform administrators who can:
- Switch to view as any other role (for testing)
- Later: manage properties, users, etc.
  </action>
  <verify>
Run `npx convex dev` - schema pushes without errors. Check schema.ts has 5 roles.
  </verify>
  <done>
Admin role added to schema, users mutation, and constants. Convex schema deployed.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create mock property data and seed function</name>
  <files>convex/seedData.ts, convex/seed.ts</files>
  <action>
Create two files:

1. `convex/seedData.ts` - Mock property data array with 12-15 diverse Israeli properties:
   - Cover all ISRAELI_LOCATIONS (at least Tel Aviv, Jerusalem, Haifa, Herzliya, Netanya)
   - Mix of property types (residential, commercial, mixed_use)
   - Price range: $150k to $2M USD (with ILS at 3.7 rate)
   - Include all optional metrics (ROI, cap rate, cash-on-cash, monthly rent)
   - Bedrooms: 1-5, Bathrooms: 1-3, Square meters: 40-300
   - Year built: 1990-2024
   - Use realistic Israeli addresses (street names like "Rothschild Blvd", "Dizengoff St", "King George St")
   - All status: "available"
   - Images: use placeholder URLs like "https://placehold.co/800x600?text=Property+1"

2. `convex/seed.ts` - Seed mutation:
   - Export `seedProperties` mutation (no auth required for seeding)
   - Insert all properties from seedData
   - Use a hardcoded system user ID or skip createdBy validation for seed data
   - Return count of inserted properties
   - Add `clearProperties` mutation to delete all properties (for reset)

Note: Seed mutation needs to work without auth since it's called from Convex dashboard or CLI.
  </action>
  <verify>
Run `npx convex dev` - no TypeScript errors. Check convex/seed.ts exports seedProperties and clearProperties.
  </verify>
  <done>
Two files created. Seed mutations exported. Data includes 12+ properties across Israeli cities with varied types and price ranges.
  </done>
</task>

<task type="auto">
  <name>Task 3: Add role-switching dropdown to Header (admin-only)</name>
  <files>src/components/layout/Header.tsx</files>
  <action>
Modify Header.tsx to add a role-switching dropdown for admin users:

1. Add imports: DropdownMenu, DropdownMenuTrigger, DropdownMenuContent, DropdownMenuItem, DropdownMenuLabel, DropdownMenuSeparator from Shadcn
2. Import useMutation, useQuery from "convex/react" and api
3. Import USER_ROLES from "@/lib/constants"

4. Inside Authenticated block, before UserButton:
   - Query current user with `useQuery(api.users.getCurrentUser)`
   - **Only render dropdown if user?.role === "admin"**
   - DropdownMenu trigger: Badge or small button showing current "viewing as" role
   - List all 5 roles from USER_ROLES constant
   - On click, call `useMutation(api.users.setUserRole)` with selected role
   - Show checkmark icon on current role
   - Use compact styling (Badge variant="outline" or text-xs button)

5. Label the dropdown "View as:" to indicate role-switching for testing

6. Non-admin users see nothing extra - just the UserButton as before
  </action>
  <verify>
Run `npm run dev`. Set a user to admin role via Convex dashboard. Log in as admin, see "View as" dropdown. Switch roles, verify it works. Log in as non-admin, confirm dropdown is hidden.
  </verify>
  <done>
Admin users see role-switching dropdown in header. Non-admin users see standard header. Role switching persists.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Admin role, mock data seed, and role-switching UI</what-built>
  <how-to-verify>
    1. Run: `npm run dev` and `npx convex dev`
    2. Open Convex dashboard: Set your user's role to "admin"
    3. Open Convex dashboard: Run `seedProperties` mutation
    4. Visit: http://localhost:3000/properties
    5. Confirm: 12+ properties displayed with various cities, prices, types
    6. Check header: "View as" dropdown visible (admin-only)
    7. Test: Switch between roles (Investor, Broker, Mortgage Advisor, Lawyer, Admin)
    8. Verify: Role switch persists after page refresh
    9. Test non-admin: Change role to "investor", refresh - dropdown should be hidden
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `npm run build` succeeds without errors
- [ ] `npx convex dev` shows no TypeScript errors
- [ ] Schema includes 5 roles (investor, broker, mortgage_advisor, lawyer, admin)
- [ ] Seed mutation populates 12+ properties in Convex dashboard
- [ ] Properties visible on marketplace page with filters working
- [ ] Admin users see "View as" dropdown in header
- [ ] Non-admin users do NOT see the dropdown
- [ ] Role switch persists after refresh
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No errors or warnings introduced
- Admin role enables viewing app as any user type
- Mock data provides realistic testing scenarios
</success_criteria>

<output>
After completion, create `.planning/phases/05.2-mock-data-super-user/05.2-01-SUMMARY.md`
</output>
