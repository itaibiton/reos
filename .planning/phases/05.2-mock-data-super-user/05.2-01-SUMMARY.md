---
phase: 05.2-mock-data-super-user
plan: 01
subsystem: admin, data
tags: [admin, seed-data, role-switching, convex]

# Dependency graph
requires:
  - phase: 05.1
    provides: Traditional filter panel and smart search
provides:
  - Admin role with role-switching capability
  - 15 mock Israeli properties for testing
  - Role-aware navigation and settings
  - viewingAsRole pattern for admin impersonation
affects: [dashboards, deal-flow]

# Tech tracking
tech-stack:
  added: []
  patterns:
    - viewingAsRole field for admin impersonation without changing actual role
    - useCurrentUser hook with effectiveRole for role-aware UI
    - Role-based navigation filtering in Sidebar

key-files:
  created:
    - convex/seedData.ts
    - convex/seed.ts
  modified:
    - convex/schema.ts
    - convex/users.ts
    - src/hooks/useCurrentUser.ts
    - src/components/layout/Header.tsx
    - src/components/layout/Sidebar.tsx
    - src/app/(app)/settings/page.tsx
    - src/components/properties/PropertyCard.tsx
    - src/lib/constants.ts

key-decisions:
  - "Use viewingAsRole field separate from role to preserve admin access"
  - "Role-aware sidebar shows different nav items per effective role"
  - "Property card image height fixed at h-48 (192px)"

patterns-established:
  - "effectiveRole = viewingAsRole ?? role pattern for admin impersonation"
  - "NavItem with roles array for role-based visibility"

issues-created: []

# Metrics
duration: 18min
completed: 2026-01-14
---

# Phase 5.2 Plan 01: Mock Data & Super User Summary

**Admin role with role-switching dropdown, 15 mock Israeli properties, and role-aware UI throughout the app**

## Performance

- **Duration:** 18 min
- **Started:** 2026-01-14T19:27:00Z
- **Completed:** 2026-01-14T19:45:00Z
- **Tasks:** 4 (3 auto + 1 checkpoint)
- **Files modified:** 10

## Accomplishments

- Added "admin" as 5th user role with viewingAsRole for impersonation
- Created 15 diverse mock Israeli properties across 9 cities
- Built role-switching dropdown in Header (admin-only)
- Made Sidebar navigation role-aware (different items per role)
- Updated Settings page to show role-appropriate content
- Fixed property card image size (h-48)

## Task Commits

Each task was committed atomically:

1. **Task 1: Add admin role to schema** - `5a7d0a2` (feat)
2. **Task 2: Create mock property data and seed function** - `edec52f` (feat)
3. **Task 3: Add role-switching dropdown to Header** - `1c7376b` (feat)
   - Also includes: viewingAsRole pattern, role-aware Sidebar, Settings updates, image size fix

**Plan metadata:** (this commit)

## Files Created/Modified

- `convex/schema.ts` - Added admin role and viewingAsRole field
- `convex/users.ts` - Added setViewingAsRole mutation
- `convex/seedData.ts` - 15 mock properties with Israeli addresses
- `convex/seed.ts` - seedProperties and clearProperties mutations
- `src/lib/constants.ts` - USER_ROLES constant array
- `src/hooks/useCurrentUser.ts` - effectiveRole, isAdmin, isServiceProvider helpers
- `src/components/layout/Header.tsx` - Role-switching dropdown for admins
- `src/components/layout/Sidebar.tsx` - Role-aware navigation
- `src/app/(app)/settings/page.tsx` - Role-appropriate settings content
- `src/components/properties/PropertyCard.tsx` - Image height h-48

## Decisions Made

- **viewingAsRole pattern**: Admin's actual role stays "admin" while viewingAsRole changes for impersonation. This keeps the dropdown always visible.
- **Role-based navigation**: Sidebar filters items based on effectiveRole:
  - Investor: Dashboard, Marketplace, Saved Properties, Deals, Settings
  - Service providers: Dashboard, Marketplace, Clients, Settings
  - Admin: All items + Add Property
- **Image sizing**: Property card images set to fixed h-48 (192px) for consistent compact display

## Deviations from Plan

### Extended Implementation

**1. [Rule 2 - Missing Critical] Added viewingAsRole field**
- **Found during:** Checkpoint verification
- **Issue:** Original implementation changed actual role, causing dropdown to disappear when switching away from admin
- **Fix:** Added viewingAsRole field and setViewingAsRole mutation
- **Files modified:** convex/schema.ts, convex/users.ts, Header.tsx

**2. [Rule 2 - Missing Critical] Made UI role-aware**
- **Found during:** Checkpoint verification
- **Issue:** User expected role switching to change the entire app experience for demos
- **Fix:** Updated useCurrentUser with effectiveRole, made Sidebar and Settings role-aware
- **Files modified:** useCurrentUser.ts, Sidebar.tsx, settings/page.tsx

**3. [User Request] Property card image size**
- **Found during:** Checkpoint verification
- **Issue:** User reported card images too large, then too small
- **Fix:** Set to h-48 (192px) fixed height
- **Files modified:** PropertyCard.tsx, properties/page.tsx

---

**Total deviations:** 3 extensions (all user-requested refinements during verification)
**Impact on plan:** Expanded scope to make role-switching functional for demos. No scope creep.

## Issues Encountered

None - all issues were resolved during checkpoint verification.

## Next Phase Readiness

- Admin role and role-switching fully functional
- 15 mock properties available for testing all filters
- Ready for Phase 6 (Deal Flow) or user's requested Phase 5.3

---
*Phase: 05.2-mock-data-super-user*
*Completed: 2026-01-14*
