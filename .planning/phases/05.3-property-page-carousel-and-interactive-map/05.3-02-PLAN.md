---
phase: 05.3-property-page-carousel-and-interactive-map
plan: 02
type: execute
---

<objective>
Create an interactive map component and integrate carousel + map into the property detail page.

Purpose: Display property location on a map and replace static images with the carousel.
Output: PropertyMap component, updated property detail page with carousel and map.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05.3-property-page-carousel-and-interactive-map/05.3-01-SUMMARY.md

**Key files:**
@src/app/(app)/properties/[id]/page.tsx
@src/components/properties/PropertyImageCarousel.tsx (created in Plan 01)

**Tech to install:**
- react-leaflet: React wrapper for Leaflet maps
- leaflet: Core mapping library

**Established patterns:**
- Property detail page uses two-column layout (3:2 ratio on lg screens)
- Right column is sticky with cards for price, metrics, details
- Shadcn Card component for consistent styling
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install react-leaflet and create PropertyMap component</name>
  <files>src/components/properties/PropertyMap.tsx</files>
  <action>
1. Install dependencies: `npm install react-leaflet leaflet`
2. Install types: `npm install -D @types/leaflet`

3. Create PropertyMap component:

Props:
- latitude: number
- longitude: number
- title: string - property title for popup
- address: string - full address for popup
- className?: string

Features:
- OpenStreetMap tile layer (free, no API key required)
- Single marker at property location
- Popup on marker click showing title and address
- Fixed height (h-64 or similar)
- Rounded corners to match card aesthetic
- Zoom controls enabled
- Default zoom level ~15 for neighborhood view

Important: Leaflet requires CSS import. Add this to the component file or create a separate CSS import.
Use dynamic import with ssr: false since Leaflet doesn't support SSR.

Create as a client component with "use client" directive.
Handle the case where coordinates are undefined (show placeholder message).
  </action>
  <verify>npm run build succeeds without errors</verify>
  <done>react-leaflet installed, PropertyMap component created with marker and popup</done>
</task>

<task type="auto">
  <name>Task 2: Integrate carousel and map into property detail page</name>
  <files>src/app/(app)/properties/[id]/page.tsx</files>
  <action>
Update the property detail page to use the new components:

1. Replace the image gallery section (lines ~198-240) with PropertyImageCarousel:
   - Pass images array (or [featuredImage] if images is empty)
   - Pass title for alt text
   - Keep the property type badge (move to carousel or keep separate)

2. Add PropertyMap in the right column:
   - Add as a new Card below "Property Details" card
   - Only show if latitude and longitude are defined
   - Title: "Location"
   - Pass latitude, longitude, title, address

3. Update the skeleton loader to include map placeholder

4. Ensure proper loading states:
   - Carousel handles empty/loading images gracefully
   - Map shows placeholder if no coordinates

Keep existing layout structure (two-column, sticky right sidebar).
Maintain all existing functionality (save button, contact broker, etc.).
  </action>
  <verify>npm run dev - visit property detail page, carousel and map render correctly</verify>
  <done>Property detail page shows image carousel and interactive map</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Property detail page with image carousel and interactive map</what-built>
  <how-to-verify>
    1. Run: npm run dev
    2. Visit: http://localhost:3000/properties
    3. Click on any property card to open detail page
    4. Verify carousel:
       - Images display in carousel format
       - Previous/Next buttons work
       - Dot indicators show current position
       - Property type badge visible
    5. Verify map:
       - Map displays in right column
       - Marker shows at property location
       - Click marker to see popup with title/address
       - Zoom controls work
    6. Test with property that has multiple images (if any)
    7. Confirm responsive layout still works (resize browser)
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `npm run build` succeeds without errors
- [ ] Property detail page renders carousel for images
- [ ] Property detail page renders map with marker
- [ ] Carousel navigation (prev/next/dots) works
- [ ] Map marker popup shows property info
- [ ] Responsive layout maintained
</verification>

<success_criteria>

- react-leaflet installed and working
- PropertyMap component shows property location
- Property detail page uses PropertyImageCarousel
- Map and carousel fully functional
- Phase 5.3 complete
</success_criteria>

<output>
After completion, create `.planning/phases/05.3-property-page-carousel-and-interactive-map/05.3-02-SUMMARY.md`
</output>
