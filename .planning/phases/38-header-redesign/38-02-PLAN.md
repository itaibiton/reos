---
phase: 38-header-redesign
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/header/MobileSearchExpander.tsx
  - src/components/header/index.ts
autonomous: true

must_haves:
  truths:
    - "User on mobile sees search icon button"
    - "User taps icon and sees smooth width expansion animation"
    - "Expanded state triggers GlobalSearchBar command dialog"
    - "User can tap X or click outside to collapse search"
  artifacts:
    - path: "src/components/header/MobileSearchExpander.tsx"
      provides: "Animated mobile search trigger"
      exports: ["MobileSearchExpander"]
  key_links:
    - from: "src/components/header/MobileSearchExpander.tsx"
      to: "framer-motion"
      via: "AnimatePresence for expansion"
      pattern: "AnimatePresence"
    - from: "src/components/header/MobileSearchExpander.tsx"
      to: "src/components/search/GlobalSearchBar.tsx"
      via: "Opens command dialog"
      pattern: "setOpen\\(true\\)"
---

<objective>
Create the MobileSearchExpander component with smooth animated expansion for mobile search.

Purpose: Provide mobile users with a compact search trigger that expands smoothly on tap per HDR-01 and HDR-08.

Output: MobileSearchExpander component in src/components/header/.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/milestones/v1.5-ROADMAP.md
@.planning/phases/38-header-redesign/38-RESEARCH.md
@src/components/search/GlobalSearchBar.tsx
@src/components/landing/shared/animations.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create MobileSearchExpander with framer-motion animation</name>
  <files>
    src/components/header/MobileSearchExpander.tsx
  </files>
  <action>
Create MobileSearchExpander component with animated expansion:

1. State management:
   - useState for isExpanded (boolean)
   - Collapsed: shows search icon button
   - Expanded: shows search input that auto-focuses + close button

2. Animation with framer-motion:
   - Use AnimatePresence with mode="wait" for clean transitions
   - Collapsed state: motion.button with key="search-icon"
   - Expanded state: motion.div with key="search-input"
   - Width animation: 40px -> 100% (or specific width like 200px)
   - Opacity animation: 0 -> 1
   - Duration: 0.3s with easeOut easing

3. Behavior:
   - On icon tap: setIsExpanded(true)
   - On expand: auto-focus input, after short delay open GlobalSearchBar dialog
   - Actually, SIMPLER approach: just open the CommandDialog directly
   - The "expansion" is visual feedback, then immediately open the full search dialog

4. Simplified implementation:
```typescript
"use client";

import { useState, useEffect } from "react";
import { motion, AnimatePresence } from "framer-motion";
import { useTranslations } from "next-intl";
import { Button } from "@/components/ui/button";
import { HugeiconsIcon } from "@hugeicons/react";
import { Search01Icon, Cancel01Icon } from "@hugeicons/core-free-icons";

interface MobileSearchExpanderProps {
  onOpenSearch: () => void;
}

export function MobileSearchExpander({ onOpenSearch }: MobileSearchExpanderProps) {
  const t = useTranslations("search");

  return (
    <Button
      variant="ghost"
      size="icon"
      className="md:hidden h-8 w-8"
      onClick={onOpenSearch}
      aria-label={t("placeholder")}
    >
      <HugeiconsIcon
        icon={Search01Icon}
        size={20}
        strokeWidth={1.5}
      />
    </Button>
  );
}
```

Wait - per research, we want animated expansion. Let me reconsider.

Better approach: The animation is a micro-interaction before opening the dialog.

```typescript
export function MobileSearchExpander({ onOpenSearch }: MobileSearchExpanderProps) {
  const t = useTranslations("search");
  const [isAnimating, setIsAnimating] = useState(false);

  const handleClick = () => {
    setIsAnimating(true);
  };

  return (
    <div className="md:hidden">
      <AnimatePresence mode="wait">
        {!isAnimating ? (
          <motion.div
            key="icon"
            initial={{ opacity: 1 }}
            exit={{ opacity: 0, scale: 0.8 }}
            transition={{ duration: 0.15 }}
          >
            <Button
              variant="ghost"
              size="icon"
              className="h-8 w-8"
              onClick={handleClick}
              aria-label={t("placeholder")}
            >
              <HugeiconsIcon icon={Search01Icon} size={20} strokeWidth={1.5} />
            </Button>
          </motion.div>
        ) : (
          <motion.div
            key="expanding"
            initial={{ width: 32, opacity: 0.5 }}
            animate={{ width: 160, opacity: 1 }}
            transition={{ duration: 0.2, ease: "easeOut" }}
            onAnimationComplete={() => {
              setIsAnimating(false);
              onOpenSearch();
            }}
            className="h-8 bg-muted rounded-md flex items-center justify-center"
          >
            <HugeiconsIcon icon={Search01Icon} size={16} strokeWidth={1.5} className="text-muted-foreground" />
          </motion.div>
        )}
      </AnimatePresence>
    </div>
  );
}
```

This gives:
1. User taps search icon
2. Icon animates to expanded bar shape (0.2s)
3. On complete, opens the full CommandDialog
4. When dialog closes, component resets to icon state

5. Update barrel export in index.ts to include MobileSearchExpander
  </action>
  <verify>
TypeScript compiles: `npx tsc --noEmit`
Animation triggers on button click
Dialog opens after animation completes
  </verify>
  <done>
MobileSearchExpander component with animated expansion that triggers search dialog
  </done>
</task>

<task type="auto">
  <name>Task 2: Update barrel export</name>
  <files>
    src/components/header/index.ts
  </files>
  <action>
Update the barrel export file to include MobileSearchExpander:

```typescript
export { AvatarDropdown } from "./AvatarDropdown";
export { NotificationsTab } from "./NotificationsTab";
export { SettingsTab } from "./SettingsTab";
export { MobileSearchExpander } from "./MobileSearchExpander";
```
  </action>
  <verify>
Import works: `import { MobileSearchExpander } from "@/components/header"`
  </verify>
  <done>
All header components exported via barrel
  </done>
</task>

</tasks>

<verification>
1. TypeScript: `npx tsc --noEmit` passes
2. MobileSearchExpander shows only on mobile (md:hidden)
3. Tapping icon triggers expansion animation
4. Animation completes and calls onOpenSearch callback
5. No visual glitches on rapid taps (mode="wait" handles this)
</verification>

<success_criteria>
- Search icon visible on mobile only (HDR-01)
- Tapping triggers smooth animated expansion (HDR-08)
- Animation completes and opens search dialog
- Component resets to icon state when dialog closes
</success_criteria>

<output>
After completion, create `.planning/phases/38-header-redesign/38-02-SUMMARY.md`
</output>
