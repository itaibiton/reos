---
phase: 45-mobile-experience
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/hooks/use-keyboard-visible.ts
  - src/components/profile/MobileInvestorSummary.tsx
  - src/components/profile/index.ts
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Mobile shows tabbed interface switching between Profile and AI Assistant views"
    - "Tab switching animates smoothly (no jarring transitions)"
  artifacts:
    - path: "src/hooks/use-keyboard-visible.ts"
      provides: "Keyboard detection via VisualViewport API"
      exports: ["useKeyboardVisible"]
    - path: "src/components/profile/MobileInvestorSummary.tsx"
      provides: "Tabbed mobile layout with animated transitions"
      exports: ["MobileInvestorSummary"]
  key_links:
    - from: "MobileInvestorSummary.tsx"
      to: "ProfileSummaryPanel, AIChatPanel"
      via: "tab content rendering"
      pattern: "<ProfileSummaryPanel|<AIChatPanel"
    - from: "MobileInvestorSummary.tsx"
      to: "framer-motion AnimatePresence"
      via: "tab transition animation"
      pattern: "AnimatePresence.*mode=\"wait\""
---

<objective>
Create the core mobile infrastructure: keyboard detection hook and tabbed layout component.

Purpose: Establish the foundation for mobile experience with proper keyboard handling and smooth tab transitions between Profile and AI Assistant views.

Output: useKeyboardVisible hook and MobileInvestorSummary component ready for page integration.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/45-mobile-experience/45-CONTEXT.md
@.planning/phases/45-mobile-experience/45-RESEARCH.md
@src/hooks/use-mobile.ts
@src/components/layout/MobileBottomNav.tsx
@src/components/profile/ProfileSummaryPanel.tsx
@src/components/ai/AIChatPanel.tsx
@src/components/profile/QuickReplyButtons.tsx
@src/app/globals.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create useKeyboardVisible hook</name>
  <files>src/hooks/use-keyboard-visible.ts</files>
  <action>
Create keyboard detection hook using VisualViewport API.

Implementation:
- Use window.visualViewport to detect keyboard open/close
- Track height difference from initial viewport height
- Use 100px threshold to distinguish keyboard from toolbar changes
- Return keyboard height (0 when closed, actual height when open)
- Handle SSR (check typeof window before accessing)
- Clean up event listener on unmount

Reference pattern from RESEARCH.md:
```typescript
function useKeyboardVisible() {
  const [keyboardHeight, setKeyboardHeight] = useState(0);

  useEffect(() => {
    if (typeof window === "undefined" || !window.visualViewport) return;

    const viewport = window.visualViewport;
    const initialHeight = viewport.height;

    const handleResize = () => {
      const heightDiff = initialHeight - viewport.height;
      setKeyboardHeight(heightDiff > 100 ? heightDiff : 0);
    };

    viewport.addEventListener("resize", handleResize);
    return () => viewport.removeEventListener("resize", handleResize);
  }, []);

  return keyboardHeight;
}
```

Export as named export.
  </action>
  <verify>TypeScript compiles without errors: `npx tsc --noEmit`</verify>
  <done>Hook exists at src/hooks/use-keyboard-visible.ts and exports useKeyboardVisible</done>
</task>

<task type="auto">
  <name>Task 2: Create MobileInvestorSummary component</name>
  <files>src/components/profile/MobileInvestorSummary.tsx, src/components/profile/index.ts</files>
  <action>
Create the main mobile tabbed layout component.

Implementation:
- Use Radix Tabs for accessible tab structure (TabsList, TabsTrigger, TabsContent)
- Use Framer Motion AnimatePresence with mode="wait" for smooth transitions (NOT exitBeforeEnter - deprecated)
- Bottom tab bar with icons + labels (Profile, AI Assistant)
- Full viewport height minus header and tab bar: `h-[calc(100dvh-var(--header-height)-var(--tab-bar-height))]`
- Track tab direction for slide animation: direction = newIndex > prevIndex ? 1 : -1
- Keep both tabs mounted to preserve scroll position (use display:none/block for inactive)
- Use safe-area-bottom for notched devices

Tab icons from Hugeicons (already in project):
- Profile: UserCircle02Icon or similar
- AI Assistant: AiChat02Icon or MessageQuestionIcon

Animation config:
```typescript
initial={{ x: direction * 100, opacity: 0 }}
animate={{ x: 0, opacity: 1 }}
exit={{ x: direction * -100, opacity: 0 }}
transition={{ duration: 0.2, ease: "easeInOut" }}
```

Tab bar styling:
- Fixed at bottom: `fixed bottom-0 inset-x-0`
- Height from CSS var: `h-[var(--tab-bar-height)]`
- Border top, background: `border-t bg-background`
- Minimum 44px touch targets for tab buttons
- Safe area padding: `safe-area-bottom` class (from globals.css)

Props:
- profileComplete: boolean (passed to QuickReplyButtons)

Internal state:
- activeTab: "profile" | "chat"
- direction: 1 | -1 (for animation direction)
- prevTab: for computing direction on change

Content rendering:
- Profile tab: <ProfileSummaryPanel />
- Chat tab: <AIChatPanel renderQuickReplies={...} />

Pass renderQuickReplies to AIChatPanel same as desktop:
```tsx
renderQuickReplies={(sendMessage) => (
  <QuickReplyButtons
    onPromptSelect={sendMessage}
    profileComplete={profileComplete}
  />
)}
```

Add export to src/components/profile/index.ts barrel file.
  </action>
  <verify>TypeScript compiles: `npx tsc --noEmit`</verify>
  <done>MobileInvestorSummary component exists and is exported from barrel</done>
</task>

</tasks>

<verification>
- [ ] `npx tsc --noEmit` passes
- [ ] useKeyboardVisible hook exports correctly
- [ ] MobileInvestorSummary uses AnimatePresence with mode="wait" (not exitBeforeEnter)
- [ ] Tab bar has minimum 44px touch targets (min-h-11)
- [ ] Safe area insets handled with safe-area-bottom class
</verification>

<success_criteria>
- Keyboard hook detects keyboard open/close via VisualViewport
- MobileInvestorSummary renders tabbed interface with animated transitions
- Tab switching slides content horizontally with direction awareness
- Both components compile and export correctly
</success_criteria>

<output>
After completion, create `.planning/phases/45-mobile-experience/45-01-SUMMARY.md`
</output>
