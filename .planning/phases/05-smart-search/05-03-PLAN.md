---
phase: 05-smart-search
plan: 03
type: execute
---

<objective>
Build search UI with natural language input and filter chips.

Purpose: Give users the "AI-powered" search experience - type naturally, see intelligent results.
Output: Marketplace page with search input, active filter chips, and filtered property results.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
@~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-smart-search/05-01-SUMMARY.md
@.planning/phases/05-smart-search/05-02-SUMMARY.md

**Existing code:**
@src/app/(app)/properties/page.tsx — Current marketplace page
@convex/search.ts — parseSearchQuery action + PropertyFilters type
@convex/properties.ts — Enhanced list query with all filters
@src/components/properties/PropertyCard.tsx — Card component

**UI patterns established:**
- Page layout: `<div className="p-6">`
- Skeleton loaders matching component structure
- Empty state: icon + title + description + CTA
- HugeiconsIcon for icons
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SearchInput component</name>
  <files>src/components/search/SearchInput.tsx</files>
  <action>
  Create a search input component with:

  1. Text input with placeholder like "Search properties... try 'apartments in Tel Aviv under $500k'"
  2. Search icon (SearchMagnifyGlass01Icon from hugeicons)
  3. Loading state while parsing (show spinner replacing search icon)
  4. On submit (Enter key or button), call onSearch callback with the query string
  5. Clear button when input has value

  Props:
  - onSearch: (query: string) => void
  - isLoading?: boolean
  - placeholder?: string

  Style with Shadcn Input component, add search icon as prefix, match existing form patterns.
  </action>
  <verify>Component renders without errors, accepts input</verify>
  <done>SearchInput component created with search icon, loading state, clear button</done>
</task>

<task type="auto">
  <name>Task 2: Create FilterChips component</name>
  <files>src/components/search/FilterChips.tsx</files>
  <action>
  Create a component to display active filters as removable chips:

  1. Takes filters object (PropertyFilters type) and onRemove callback
  2. Renders a chip/badge for each active filter:
     - city: "Tel Aviv" with X button
     - propertyType: "Residential" with X button
     - priceRange: "$200k - $500k" with X button
     - bedrooms: "3+ beds" with X button
     - etc.
  3. Each chip has remove (X) button that calls onRemove(filterKey)
  4. "Clear all" button when multiple filters active

  Use Shadcn Badge component with variant="secondary" and add close button.
  Format prices with Intl.NumberFormat for USD.
  </action>
  <verify>Component renders with sample filters, chips are clickable</verify>
  <done>FilterChips displays active filters as removable badges</done>
</task>

<task type="auto">
  <name>Task 3: Integrate search into marketplace page</name>
  <files>src/app/(app)/properties/page.tsx</files>
  <action>
  Update the marketplace page to use smart search:

  1. Add state for:
     - searchQuery (string)
     - filters (PropertyFilters)
     - isSearching (boolean for loading)

  2. Add SearchInput above the property grid, after the header
  3. Add FilterChips below search input (only show when filters exist)

  4. On search submit:
     - Set isSearching = true
     - Call parseSearchQuery action with the query
     - Set filters from response
     - Set isSearching = false

  5. Pass filters to properties.list query (replace empty {} with filters)

  6. On filter chip remove:
     - Remove that key from filters
     - Clear searchQuery if all filters removed

  7. Handle the case where search returns no matching filters:
     - Show properties with empty filters (all properties)
     - Optionally show message "Couldn't parse filters from search"

  Keep existing skeleton loading, empty state, and grid patterns.
  </action>
  <verify>npm run build passes, page renders with search</verify>
  <done>Marketplace has search input, calls AI parser, shows filtered results with chips</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Smart search with natural language parsing and filter chips</what-built>
  <how-to-verify>
    1. Run: npm run dev
    2. Visit: http://localhost:3000/properties
    3. Type in search: "apartments in Tel Aviv under $500,000"
    4. Verify: Search shows loading state, then displays filter chips (city: Tel Aviv, type: Residential, max price: $500,000)
    5. Verify: Property grid filters to matching results
    6. Click X on a filter chip
    7. Verify: Filter is removed, results update
    8. Try: "3 bedroom houses in Jerusalem"
    9. Verify: Parses to bedrooms: 3+, city: Jerusalem, type: Residential
    10. Try clearing all filters
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds
- [ ] SearchInput component renders with icon and placeholder
- [ ] FilterChips shows active filters with remove buttons
- [ ] Natural language search parses to structured filters
- [ ] Filter chips update when search is performed
- [ ] Removing a chip updates results
- [ ] Human verified the search flow works end-to-end
</verification>

<success_criteria>
- Search input visible on marketplace page
- Natural language queries parse to filters
- Active filters displayed as removable chips
- Property grid updates based on filters
- Phase 5: Smart Search complete
</success_criteria>

<output>
After completion, create `.planning/phases/05-smart-search/05-03-SUMMARY.md`
</output>
