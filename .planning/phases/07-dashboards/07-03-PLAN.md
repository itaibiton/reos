---
phase: 07-dashboards
plan: 03
type: execute
---

<objective>
Create service provider dashboard with client metrics, pending requests, and recent activity.

Purpose: Give brokers, mortgage advisors, and lawyers a dedicated dashboard view with their business metrics.
Output: Provider dashboard showing pending requests, active clients, and recent deal activity.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior plans in this phase:
@.planning/phases/07-dashboards/07-01-PLAN.md
@.planning/phases/07-dashboards/07-02-PLAN.md

# Relevant source files:
@src/app/(app)/dashboard/page.tsx
@src/app/(app)/clients/page.tsx
@convex/dashboard.ts
@convex/serviceRequests.ts
@convex/deals.ts

**Tech stack available:** Next.js 16, Convex, Clerk auth, Shadcn/ui, Hugeicons
**Established patterns:**
- Dashboard stat cards with icon + value + label
- RequestCard component in clients page
- Activity timeline from deals detail page
- Skeleton loaders for loading states
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create provider dashboard component</name>
  <files>src/components/dashboard/ProviderDashboard.tsx</files>
  <action>
Create ProviderDashboard.tsx component that:

1. Uses useQuery to fetch dashboard.getStats for provider stats
2. Shows provider-specific stat cards in 2x2 grid:
   - Pending Requests (Clock icon, yellow) - links to /clients?filter=pending
   - Active Clients (UserMultiple icon, green) - links to /clients?filter=accepted
   - Total Clients (User icon, blue)
   - Recent Activity (Activity icon, purple) - activity count last 7 days

3. Shows "Pending Requests" section:
   - Fetch serviceRequests.listForProvider (filter status=pending, limit 3)
   - Render compact request cards (investor name, property title, date)
   - "Accept" and "Decline" buttons using existing mutation
   - "View All" link to /clients
   - Empty state: "No pending requests - check back soon"

4. Shows "Recent Activity" section:
   - Fetch deal activity for deals where provider is assigned (last 5 items)
   - Render ActivityItem-style entries (actor, action, timestamp)
   - If no activity: "No recent activity"

Use Card, Badge, Avatar, Button, Skeleton from Shadcn.
Pattern: Follow existing clients page for request handling.
  </action>
  <verify>npm run build passes, component renders without errors</verify>
  <done>ProviderDashboard component created with stats, pending requests, and activity</done>
</task>

<task type="auto">
  <name>Task 2: Add recent activity query and integrate provider dashboard</name>
  <files>convex/dashboard.ts, src/app/(app)/dashboard/page.tsx</files>
  <action>
In convex/dashboard.ts, add `getRecentActivity` query:
- Takes optional limit (default 5)
- For providers: get deals where they're assigned, then fetch dealActivity for those deals
- Return last N activities across all their deals, sorted by createdAt desc
- Include actor info (name, imageUrl) and deal property info
- For investors: get activity on their deals
- For admin: get all activity

In dashboard page:
- Import ProviderDashboard component
- Update role routing:
  - investor: InvestorDashboard + RecommendedProperties (existing)
  - broker/mortgage_advisor/lawyer: ProviderDashboard
  - admin (no viewingAsRole): Keep generic admin stats
- Maintain two-column layout with map on right for all roles
- Add proper skeleton loader for provider dashboard
  </action>
  <verify>npm run build passes, provider dashboard shows when logged in as provider role</verify>
  <done>Provider dashboard integrated into main dashboard page with activity feed</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Service provider dashboard with client metrics and activity feed</what-built>
  <how-to-verify>
    1. Run: npm run dev
    2. Log in as admin, switch to broker role via role switcher
    3. Visit: http://localhost:3000/dashboard
    4. Verify provider stats show (Pending, Active, Total Clients, Activity)
    5. Verify "Pending Requests" section shows requests or empty state
    6. Click Accept/Decline on a pending request (if any)
    7. Verify "Recent Activity" section shows deal events
    8. Switch to investor role - verify investor dashboard shows instead
    9. Test loading states (refresh)
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] Provider dashboard shows for broker/mortgage_advisor/lawyer roles
- [ ] Stats reflect actual provider data
- [ ] Pending requests can be accepted/declined from dashboard
- [ ] Activity feed shows recent deal events
- [ ] Role switching shows correct dashboard variant
</verification>

<success_criteria>

- ProviderDashboard component exists with stats and activity
- getRecentActivity query returns deal activity
- Dashboard page shows provider dashboard for service provider roles
- Accept/Decline functionality works on dashboard
- Phase 7 complete with both investor and provider dashboards
</success_criteria>

<output>
After completion, create `.planning/phases/07-dashboards/07-03-SUMMARY.md`:

# Phase 7 Plan 03: Provider Dashboard Summary

**[One-liner about what was accomplished]**

## Accomplishments
- [Key outcomes]

## Files Created/Modified
- [List files]

## Decisions Made
- [Key decisions]

## Issues Encountered
- [Problems and resolutions]

## Next Phase Readiness
- Phase 7 complete - Dashboards implemented
- Ready for Phase 8: Real-time Features
</output>
