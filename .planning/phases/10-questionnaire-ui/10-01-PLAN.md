---
phase: 10-questionnaire-ui
plan: 01
type: execute
---

<objective>
Build the multi-step questionnaire wizard framework with AI-style conversational UI and draft persistence.

Purpose: Create reusable wizard infrastructure that Phases 11-14 will populate with actual questions. The conversational UI creates an engaging, guided experience rather than a traditional form.
Output: QuestionnaireWizard component, conversational UI components, Convex integration for step persistence.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Phase 9 infrastructure (direct dependency):
@.planning/phases/09-onboarding-gate/09-01-SUMMARY.md

# Existing patterns to follow:
@src/components/profile/InvestorProfileForm.tsx
@src/app/(app)/onboarding/questionnaire/page.tsx
@convex/investorQuestionnaires.ts
@convex/schema.ts

**Tech stack available:**
- Shadcn UI components (Card, Button, RadioGroup, Progress, etc.)
- Convex for real-time state
- Tailwind v4 for styling

**Established patterns:**
- useState for form state, manual validation
- Two-column layouts (lg:grid-cols-2)
- RadioGroup with descriptive options
- MultiSelectPopover for multi-choice
- Toast for feedback (sonner)
- Loading states with Spinner component

**Constraining decisions from Phase 9:**
- investorQuestionnaires table stores currentStep field
- updateStep mutation advances step
- markComplete mutation finalizes questionnaire
- "Skip for now" bypasses questionnaire via completeOnboarding

**Design intent (AI-style conversational UI):**
- Questions appear as "assistant" bubbles (like ChatGPT)
- User answers in styled response areas
- Smooth transitions between questions
- Progress visible at all times
- Friendly, guided tone rather than clinical form
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create QuestionnaireWizard component shell</name>
  <files>src/components/questionnaire/QuestionnaireWizard.tsx, src/components/questionnaire/QuestionnaireProgress.tsx</files>
  <action>
Create the wizard framework:

1. **QuestionnaireWizard.tsx** - Main container component:
   - Props: steps (array of step configs), currentStep (from Convex), onStepChange, onComplete, onSkip
   - Each step config: { id: string, title: string, component: ReactNode }
   - Renders: Progress indicator at top, current step content in center, navigation at bottom
   - Uses Card for visual container with generous padding
   - Full height layout (min-h-[80vh]) with content centered

2. **QuestionnaireProgress.tsx** - Step progress indicator:
   - Shows current step / total steps (e.g., "Step 3 of 7")
   - Visual progress bar (use Shadcn Progress component)
   - Step titles shown for current + maybe next step
   - Subtle animation on step change (transition-all)

3. Navigation controls:
   - "Back" button (disabled on step 1, outline variant)
   - "Continue" button (primary, prominent)
   - "Skip for now" link at bottom (text-muted-foreground, small)
   - Keyboard support: Enter to continue, Escape for skip prompt

Style: Clean, spacious, premium feel. Max-width container (~600px) for focused attention.
  </action>
  <verify>
Component files exist and export properly:
- grep -r "QuestionnaireWizard" src/components/questionnaire/
- TypeScript compiles: npx tsc --noEmit
  </verify>
  <done>QuestionnaireWizard and QuestionnaireProgress components created with step state management and navigation</done>
</task>

<task type="auto">
  <name>Task 2: Create conversational UI components</name>
  <files>src/components/questionnaire/QuestionBubble.tsx, src/components/questionnaire/AnswerArea.tsx, src/components/questionnaire/index.ts</files>
  <action>
Create the AI-style conversational components:

1. **QuestionBubble.tsx** - The "assistant" question display:
   - Props: question (string), description? (string), icon? (ReactNode)
   - Styled as chat bubble (rounded-2xl, bg-muted, left-aligned)
   - Optional avatar/icon on left (default: sparkle or similar)
   - Question text as main content (text-lg font-medium)
   - Description as secondary (text-sm text-muted-foreground)
   - Subtle appear animation (animate-in fade-in slide-in-from-bottom-2)

2. **AnswerArea.tsx** - Container for user's answer input:
   - Props: children (the actual input controls)
   - Right-aligned styling to contrast with question
   - Subtle background or border to define answer zone
   - Generous spacing from question
   - Supports any child input type (RadioGroup, Input, MultiSelect, etc.)

3. **index.ts** - Barrel export for all questionnaire components

4. **Animation/transitions:**
   - Questions fade in when step loads
   - Answers slide up slightly
   - Use Tailwind animation utilities (not framer-motion - keep it lightweight)

Visual inspiration: ChatGPT's onboarding, Linear's setup wizard, Notion's welcome flow.
  </action>
  <verify>
Components render properly:
- Import test in questionnaire page: import { QuestionBubble, AnswerArea } from "@/components/questionnaire"
- npx tsc --noEmit
  </verify>
  <done>QuestionBubble and AnswerArea components created with conversational styling and animations</done>
</task>

<task type="auto">
  <name>Task 3: Integrate wizard with Convex persistence and update questionnaire page</name>
  <files>src/app/(app)/onboarding/questionnaire/page.tsx, convex/investorQuestionnaires.ts</files>
  <action>
Wire up the wizard to Convex for draft persistence:

1. **Update questionnaire page** to use new wizard:
   - Fetch current questionnaire state with useQuery(api.investorQuestionnaires.getByUser)
   - Pass currentStep to QuestionnaireWizard
   - Define placeholder steps (will be replaced in Phases 11-14):
     - Step 1: "Let's get started" - Welcome message with citizenship question preview
     - Step 2: "Almost done" - Placeholder for remaining questions
   - Wire onStepChange to updateStep mutation
   - Wire onComplete to markComplete + router.push("/dashboard")
   - Wire onSkip to completeOnboarding (existing skip functionality)

2. **Enhance investorQuestionnaires.ts** if needed:
   - Add saveAnswers mutation for persisting individual answers
   - Args: partial answer object (citizenship?, residencyStatus?, etc.)
   - Updates questionnaire record with provided fields + updatedAt

3. **Loading and error states:**
   - Show Spinner while questionnaire loads
   - Handle case where questionnaire doesn't exist (shouldn't happen due to Phase 9 gate)
   - Toast on save errors

4. **Navigation behavior:**
   - Back: updateStep(currentStep - 1), UI updates reactively
   - Continue: updateStep(currentStep + 1), UI updates reactively
   - Skip: completeOnboarding, redirect to dashboard
   - On final step, Continue becomes "Complete" and calls markComplete
  </action>
  <verify>
Full flow works:
- Navigate to /onboarding/questionnaire as investor
- See wizard with progress and placeholder steps
- Click Back/Continue to navigate steps (step persists in Convex)
- Refresh page - returns to correct step
- Skip for now still works
- Complete on final step redirects to dashboard
  </verify>
  <done>Questionnaire page uses wizard framework with Convex persistence, placeholder steps ready for Phase 11+ content</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] All components in src/components/questionnaire/ export correctly
- [ ] `npx tsc --noEmit` passes with no errors
- [ ] Questionnaire page renders wizard with progress indicator
- [ ] Step navigation works (Back/Continue)
- [ ] Current step persists to Convex (verify in dashboard)
- [ ] Page refresh preserves step position
- [ ] Skip for now still completes onboarding
- [ ] Mobile responsive (test at 375px width)
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No TypeScript errors
- Wizard framework ready for Phase 11 to add actual questions
- Conversational UI components reusable for all question types
</success_criteria>

<output>
After completion, create `.planning/phases/10-questionnaire-ui/10-01-SUMMARY.md` following the summary template with:
- Frontmatter including dependency graph (requires Phase 9, provides wizard framework, affects Phases 11-14)
- Key files created/modified
- Patterns established (wizard pattern, conversational UI pattern)
- Duration metrics
</output>
