---
phase: 31-translation-infrastructure
plan: 04
type: execute
wave: 2
depends_on: ["31-01"]
files_modified:
  - messages/en.json
  - src/app/[locale]/(app)/deals/page.tsx
  - src/app/[locale]/(app)/deals/[id]/page.tsx
  - src/components/deals/FileUpload.tsx
  - src/components/deals/InvestorQuestionnaireCard.tsx
autonomous: true

must_haves:
  truths:
    - "Deal listing page shows translated labels"
    - "Deal detail page shows translated content"
    - "Deal stage names are translated"
  artifacts:
    - path: "messages/en.json"
      provides: "deals namespace"
      contains: '"deals":'
  key_links:
    - from: "src/app/[locale]/(app)/deals/page.tsx"
      to: "messages/en.json"
      via: "useTranslations('deals')"
      pattern: "useTranslations.*deals"
---

<objective>
Add deals namespace and translate all deal-related pages and components.

Purpose: Deals is a core feature tracking the real estate transaction flow. ~50 strings across listing, detail, and provider interaction.

Output: deals namespace in en.json, all deal pages using useTranslations.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/milestones/v1.4-ROADMAP.md
@.planning/phases/31-translation-infrastructure/31-RESEARCH.md
@messages/en.json
@src/app/[locale]/(app)/deals/page.tsx
@src/app/[locale]/(app)/deals/[id]/page.tsx
@src/components/deals/InvestorQuestionnaireCard.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add deals namespace to en.json</name>
  <files>messages/en.json</files>
  <action>
Add a `deals` namespace to messages/en.json.

```json
"deals": {
  "title": "Deals",
  "myDeals": "My Deals",
  "activeDeal": "Active Deal",
  "activeDeals": "Active Deals",
  "completedDeals": "Completed Deals",

  "stages": {
    "interest": "Interest",
    "brokerAssigned": "With Broker",
    "mortgage": "Mortgage",
    "legal": "Legal Review",
    "closing": "Closing",
    "completed": "Completed"
  },

  "card": {
    "started": "Started",
    "stage": "Stage",
    "providers": "Providers",
    "investor": "Investor",
    "property": "Property",
    "value": "Deal Value",
    "viewDetails": "View Details"
  },

  "detail": {
    "overview": "Overview",
    "providers": "Providers",
    "files": "Files",
    "activity": "Activity",
    "stageProgress": "Stage Progress",
    "dealInfo": "Deal Information",
    "propertyInfo": "Property Information",
    "investorInfo": "Investor Information"
  },

  "providers": {
    "title": "Service Providers",
    "assigned": "Assigned Providers",
    "pending": "Pending Requests",
    "recommended": "Recommended Providers",
    "requestProvider": "Request Provider",
    "broker": "Broker",
    "mortgageAdvisor": "Mortgage Advisor",
    "lawyer": "Lawyer",
    "accept": "Accept",
    "decline": "Decline",
    "cancel": "Cancel Request"
  },

  "files": {
    "title": "Documents",
    "upload": "Upload File",
    "uploadDescription": "Upload documents related to this deal",
    "noFiles": "No files uploaded yet",
    "categories": {
      "contract": "Contract",
      "idDocument": "ID Document",
      "financial": "Financial",
      "legal": "Legal",
      "other": "Other"
    },
    "visibility": {
      "all": "All Participants",
      "providersOnly": "Providers Only"
    }
  },

  "activity": {
    "title": "Activity Log",
    "noActivity": "No activity yet",
    "stageChange": "Stage changed to {stage}",
    "fileUploaded": "{user} uploaded {file}",
    "providerAssigned": "{provider} joined as {role}",
    "handoff": "Handed off to {role}"
  },

  "empty": {
    "noDeals": "No deals yet",
    "startDeal": "Start a deal from a property page",
    "noActiveDeals": "No active deals",
    "noCompletedDeals": "No completed deals yet"
  },

  "filters": {
    "all": "All Deals",
    "active": "Active",
    "completed": "Completed",
    "byStage": "By Stage"
  },

  "questionnaire": {
    "title": "Investor Profile",
    "noProfile": "No profile available",
    "sections": {
      "background": "Background",
      "investmentPreferences": "Investment Preferences",
      "propertyPreferences": "Property Preferences",
      "timelineServices": "Timeline & Services"
    },
    "fields": {
      "citizenship": "Citizenship",
      "residencyStatus": "Residency Status",
      "investmentExperience": "Investment Experience",
      "ownsProperty": "Owns Property in Israel",
      "investmentType": "Investment Type",
      "budgetRange": "Budget Range",
      "investmentHorizon": "Investment Horizon",
      "goals": "Goals",
      "yieldPreference": "Yield Preference",
      "financingApproach": "Financing Approach",
      "propertyTypes": "Property Types",
      "locations": "Locations",
      "size": "Size",
      "amenities": "Amenities",
      "locationFlexibility": "Location Flexibility",
      "purchaseTimeline": "Purchase Timeline",
      "servicesNeeded": "Services Needed",
      "additionalPreferences": "Additional Preferences"
    },
    "values": {
      "notSpecified": "Not specified",
      "yes": "Yes",
      "no": "No",
      "from": "From {amount}",
      "upTo": "Up to {amount}",
      "range": "{min} - {max}",
      "bedroomsRange": "{min} - {max} bedrooms",
      "bedroomsMin": "{min}+ bedrooms",
      "bedroomsMax": "Up to {max} bedrooms",
      "areaRange": "{min} - {max} sqm",
      "areaMin": "{min}+ sqm",
      "areaMax": "Up to {max} sqm"
    }
  }
}
```

Keep existing namespaces intact.
  </action>
  <verify>
Run: `node -e "const m = require('./messages/en.json'); console.log(Object.keys(m.deals).join(', '))"`
Should output: title, myDeals, activeDeal, activeDeals, completedDeals, stages, card, detail, providers, files, activity, empty, filters, questionnaire
  </verify>
  <done>deals namespace added with all deal-related translation keys</done>
</task>

<task type="auto">
  <name>Task 2: Translate deal pages</name>
  <files>
    src/app/[locale]/(app)/deals/page.tsx
    src/app/[locale]/(app)/deals/[id]/page.tsx
  </files>
  <action>
Update deal pages to use translations.

For each file:

1. Add import:
```typescript
import { useTranslations } from "next-intl";
```

2. Get translator at component start:
```typescript
const t = useTranslations("deals");
```

3. Replace hardcoded strings:

**deals/page.tsx:**
- Page title: `t("title")` or `t("myDeals")`
- Tab labels: `t("filters.all")`, `t("filters.active")`, `t("filters.completed")`
- Stage names: `t("stages.interest")`, etc.
- Empty state: `t("empty.noDeals")`, `t("empty.startDeal")`
- Card labels: `t("card.started")`, `t("card.stage")`, etc.

**deals/[id]/page.tsx:**
- Tab labels: `t("detail.overview")`, `t("detail.providers")`, `t("detail.files")`, `t("detail.activity")`
- Section titles: `t("detail.stageProgress")`, `t("detail.dealInfo")`
- Provider labels: `t("providers.assigned")`, `t("providers.pending")`
- File section: `t("files.title")`, `t("files.upload")`
- Activity: `t("activity.title")`

For stage names, consider a helper function:
```typescript
const getStageLabel = (stage: string) => t(`stages.${stage}`);
```
  </action>
  <verify>
Run: `grep -c "useTranslations" src/app/\[locale\]/\(app\)/deals/page.tsx src/app/\[locale\]/\(app\)/deals/\[id\]/page.tsx`
Should show counts for both files
  </verify>
  <done>Deal pages use useTranslations for all user-facing strings</done>
</task>

<task type="auto">
  <name>Task 3: Translate deal components</name>
  <files>
    src/components/deals/FileUpload.tsx
    src/components/deals/InvestorQuestionnaireCard.tsx
  </files>
  <action>
Update deal components to use translations.

**FileUpload.tsx:**
1. Add `useTranslations("deals")` import and hook
2. Replace:
   - "Upload File" -> `t("files.upload")`
   - File category labels -> `t("files.categories.contract")`, etc.
   - Visibility labels -> `t("files.visibility.all")`, etc.

**InvestorQuestionnaireCard.tsx:**
This component has ~78 hardcoded strings in QUESTIONNAIRE_LABELS.

1. Add imports:
```typescript
import { useTranslations } from "next-intl";
```

2. Get translators:
```typescript
const t = useTranslations("deals.questionnaire");
const tCommon = useTranslations("common");
```

3. REMOVE the QUESTIONNAIRE_LABELS constant entirely

4. Update getLabel function to use translations:
```typescript
function getLabel(category: string, value: string): string {
  // Try questionnaire-specific values first
  const key = `values.${category}.${value}`;
  // Fallback to common namespace for shared values
  return t.has(key) ? t(key) : tCommon(`${category}.${value}`) || value;
}
```

5. Update section titles:
- "Background" -> `t("sections.background")`
- "Investment Preferences" -> `t("sections.investmentPreferences")`
- "Property Preferences" -> `t("sections.propertyPreferences")`
- "Timeline & Services" -> `t("sections.timelineServices")`

6. Update field labels:
- "Citizenship" -> `t("fields.citizenship")`
- "Residency Status" -> `t("fields.residencyStatus")`
- etc.

7. Update value display:
- "Not specified" -> `t("values.notSpecified")`
- "Yes"/"No" -> `t("values.yes")`, `t("values.no")`

For questionnaire option values (citizenship types, experience levels, etc.), add them to common namespace since they're reused elsewhere, or add a deals.questionnaire.options section.
  </action>
  <verify>
Run: `grep -c "useTranslations" src/components/deals/FileUpload.tsx src/components/deals/InvestorQuestionnaireCard.tsx`
Should show counts for both files

Run: `grep -c "QUESTIONNAIRE_LABELS" src/components/deals/InvestorQuestionnaireCard.tsx`
Should be 0 (constant removed, using translations instead)
  </verify>
  <done>Deal components use translations for all user-facing strings</done>
</task>

</tasks>

<verification>
1. messages/en.json parses without error
2. deals namespace has all expected sections
3. All deal pages compile without TypeScript errors
4. InvestorQuestionnaireCard no longer has QUESTIONNAIRE_LABELS constant
5. Dev server shows translated deal content
</verification>

<success_criteria>
1. deals namespace exists with 50+ translation keys
2. All deal pages use useTranslations
3. InvestorQuestionnaireCard uses translations (no hardcoded labels)
4. FileUpload uses translations
5. Zero hardcoded user-facing strings on deal pages
</success_criteria>

<output>
After completion, create `.planning/phases/31-translation-infrastructure/31-04-SUMMARY.md`
</output>
