---
phase: 34-language-switcher-polish
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/i18n/routing.ts
  - src/components/LocaleSwitcher.tsx
  - messages/en.json
  - messages/he.json
autonomous: true

must_haves:
  truths:
    - "User locale preference persists across browser sessions"
    - "LocaleSwitcher component exists and is importable"
    - "Translation keys exist for language switcher UI"
  artifacts:
    - path: "src/i18n/routing.ts"
      provides: "localeCookie configuration with 1-year maxAge"
      contains: "localeCookie"
    - path: "src/components/LocaleSwitcher.tsx"
      provides: "Language switcher dropdown component"
      exports: ["LocaleSwitcher"]
    - path: "messages/en.json"
      provides: "English language switcher translations"
      contains: "language"
    - path: "messages/he.json"
      provides: "Hebrew language switcher translations"
      contains: "language"
  key_links:
    - from: "src/components/LocaleSwitcher.tsx"
      to: "src/i18n/routing.ts"
      via: "imports routing.locales"
      pattern: "routing\\.locales"
    - from: "src/components/LocaleSwitcher.tsx"
      to: "src/i18n/navigation.ts"
      via: "imports useRouter, usePathname"
      pattern: "useRouter|usePathname"
---

<objective>
Create the LocaleSwitcher component and configure cookie persistence for user locale preferences.

Purpose: Enable language switching with persistent preferences that survive browser sessions.
Output: LocaleSwitcher component ready for integration, routing configured with cookie persistence.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/milestones/v1.4-ROADMAP.md
@.planning/STATE.md
@.planning/phases/34-language-switcher-polish/34-RESEARCH.md

@src/i18n/routing.ts
@src/i18n/navigation.ts
@src/components/ui/dropdown-menu.tsx
@src/components/ui/button.tsx
@messages/en.json
@messages/he.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Configure cookie persistence in routing.ts</name>
  <files>src/i18n/routing.ts</files>
  <action>
Update the routing configuration to add `localeCookie` with a 1-year maxAge for persistent user preferences.

Add to the `defineRouting` call:
```typescript
localeCookie: {
  name: 'NEXT_LOCALE',
  maxAge: 60 * 60 * 24 * 365, // 1 year
},
```

This enables next-intl's automatic cookie persistence when users switch locales via `router.replace()`. The middleware will read this cookie on subsequent visits to restore the user's language preference.

Note: Browser Accept-Language detection is already built into next-intl middleware and works automatically for first-time visitors when no cookie exists.
  </action>
  <verify>Check file has localeCookie configuration: `grep -A 3 "localeCookie" src/i18n/routing.ts`</verify>
  <done>routing.ts exports localeCookie config with 1-year maxAge</done>
</task>

<task type="auto">
  <name>Task 2: Create LocaleSwitcher component</name>
  <files>src/components/LocaleSwitcher.tsx</files>
  <action>
Create a new client component for language switching using shadcn's DropdownMenu.

Implementation details:
- Use `useLocale` from `next-intl` to get current locale
- Use `useRouter`, `usePathname` from `@/i18n/navigation` for locale-aware navigation
- Use `routing.locales` from `@/i18n/routing` for locale list (not hardcoded)
- Use `useTranslations('common.language')` for UI text
- Use Lucide `Languages` icon as trigger (consistent with existing icon usage)
- Trigger button: `variant="ghost" size="icon"` with `h-8 w-8` sizing
- Dropdown alignment: `align="end"` (works correctly with RTL via DirectionProvider)
- Show native language names: `English` and `עברית` (Hebrew in Hebrew script)
- Highlight current locale with `bg-accent` class on active item
- Call `router.replace(pathname, { locale: newLocale })` on selection
- Include sr-only label for accessibility

Locale name mapping (hardcoded in component, not in translations):
```typescript
const localeNames: Record<string, string> = {
  en: 'English',
  he: 'עברית',
};
```

This pattern shows each language in its native script, which is the standard UX pattern for language switchers (users should be able to find their language even if they can't read the current language).
  </action>
  <verify>Check component exists and exports LocaleSwitcher: `grep -l "export.*LocaleSwitcher" src/components/LocaleSwitcher.tsx`</verify>
  <done>LocaleSwitcher.tsx exports a working client component that switches locales via router.replace</done>
</task>

<task type="auto">
  <name>Task 3: Add translation keys for language switcher</name>
  <files>messages/en.json, messages/he.json</files>
  <action>
Add a `language` section under `common` namespace in both translation files.

For messages/en.json, add inside "common" object (after "confirm" section):
```json
"language": {
  "switchLanguage": "Switch language",
  "currentLanguage": "Current language"
}
```

For messages/he.json, add inside "common" object (after "confirm" section):
```json
"language": {
  "switchLanguage": "החלף שפה",
  "currentLanguage": "שפה נוכחית"
}
```

Note: The actual language names (English/עברית) are NOT in translation files because they should always display in their native script regardless of current UI language.
  </action>
  <verify>Check both files have language keys: `grep -l '"language"' messages/en.json messages/he.json`</verify>
  <done>Both en.json and he.json have common.language translation keys</done>
</task>

</tasks>

<verification>
1. Verify routing.ts has localeCookie: `grep "localeCookie" src/i18n/routing.ts`
2. Verify LocaleSwitcher exports correctly: `grep "export" src/components/LocaleSwitcher.tsx`
3. Verify translation keys exist: `grep -A 2 '"language"' messages/en.json`
4. Run TypeScript check: `npx tsc --noEmit`
</verification>

<success_criteria>
- routing.ts has localeCookie config with maxAge of 1 year (31536000 seconds)
- LocaleSwitcher.tsx exists as a client component with proper imports
- Both message files have common.language.switchLanguage key
- No TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/34-language-switcher-polish/34-01-SUMMARY.md`
</output>
