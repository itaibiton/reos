---
phase: 34-language-switcher-polish
plan: 02
type: execute
wave: 2
depends_on: ["34-01"]
files_modified:
  - src/components/layout/AppShell.tsx
  - src/components/layout/Sidebar.tsx
autonomous: false

must_haves:
  truths:
    - "User can see language switcher in header/navigation area"
    - "User can click language switcher and choose between English and Hebrew"
    - "User switching languages sees page immediately update without full reload"
    - "User returning to site sees their previously selected language"
    - "New user with Hebrew browser settings sees Hebrew by default"
  artifacts:
    - path: "src/components/layout/AppShell.tsx"
      provides: "LocaleSwitcher in header"
      contains: "LocaleSwitcher"
    - path: "src/components/layout/Sidebar.tsx"
      provides: "LocaleSwitcher in sidebar footer"
      contains: "LocaleSwitcher"
  key_links:
    - from: "src/components/layout/AppShell.tsx"
      to: "src/components/LocaleSwitcher.tsx"
      via: "import and render"
      pattern: "import.*LocaleSwitcher"
    - from: "src/components/layout/Sidebar.tsx"
      to: "src/components/LocaleSwitcher.tsx"
      via: "import and render"
      pattern: "import.*LocaleSwitcher"
---

<objective>
Integrate LocaleSwitcher component into the application layout (header and sidebar).

Purpose: Make language switching accessible from the main navigation areas.
Output: Users can switch languages from header or sidebar, with immediate UI update.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/milestones/v1.4-ROADMAP.md
@.planning/STATE.md
@.planning/phases/34-language-switcher-polish/34-RESEARCH.md
@.planning/phases/34-language-switcher-polish/34-01-SUMMARY.md

@src/components/layout/AppShell.tsx
@src/components/layout/Sidebar.tsx
@src/components/LocaleSwitcher.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add LocaleSwitcher to AppShell header</name>
  <files>src/components/layout/AppShell.tsx</files>
  <action>
Add the LocaleSwitcher component to the header, positioned BEFORE the UserButton in the right section.

1. Add import at top of file:
```typescript
import { LocaleSwitcher } from "@/components/LocaleSwitcher";
```

2. In the `ProviderHeaderContent` function, add LocaleSwitcher before the role-switching dropdown and UserButton:

Inside the return, add LocaleSwitcher as the first item in the flex container:
```tsx
<div className="flex items-center gap-3">
  {/* Language switcher */}
  <LocaleSwitcher />

  {/* Notification center */}
  <NotificationCenter />

  {/* Role-switching dropdown - admin only */}
  {isAdmin && (
    // ... existing code
  )}

  <UserButton ... />
</div>
```

The order should be: LocaleSwitcher -> NotificationCenter -> RoleDropdown -> UserButton

This provides quick access to language switching while keeping auth controls at the far right.
  </action>
  <verify>Check LocaleSwitcher is imported and rendered in header: `grep "LocaleSwitcher" src/components/layout/AppShell.tsx`</verify>
  <done>AppShell header includes LocaleSwitcher component before other controls</done>
</task>

<task type="auto">
  <name>Task 2: Add LocaleSwitcher to Sidebar footer</name>
  <files>src/components/layout/Sidebar.tsx</files>
  <action>
Add the LocaleSwitcher component to the SidebarFooter for secondary access point.

1. Add import at top of file:
```typescript
import { LocaleSwitcher } from "@/components/LocaleSwitcher";
```

2. Update the SidebarFooter to include the LocaleSwitcher:

The current SidebarFooter is empty with just a comment. Replace it with:
```tsx
<SidebarFooter>
  <SidebarMenu>
    <SidebarMenuItem>
      <div className="flex items-center justify-center py-2">
        <LocaleSwitcher />
      </div>
    </SidebarMenuItem>
  </SidebarMenu>
</SidebarFooter>
```

This places the LocaleSwitcher centered in the sidebar footer, providing a secondary access point that's always visible when the sidebar is expanded.

Note: When sidebar is in collapsed "icon" mode, the footer will show just the icon which is still clickable to open the dropdown.
  </action>
  <verify>Check LocaleSwitcher is imported and rendered in sidebar footer: `grep "LocaleSwitcher" src/components/layout/Sidebar.tsx`</verify>
  <done>Sidebar footer includes LocaleSwitcher component</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete language switching functionality:
- LocaleSwitcher component with dropdown menu
- Cookie persistence for user preference (1 year)
- Header placement (quick access)
- Sidebar footer placement (secondary access)
- Automatic browser language detection for first-time visitors
  </what-built>
  <how-to-verify>
1. Start dev server: `npm run dev`
2. Open browser to http://localhost:3000/en/properties (or any protected route)
3. **Test language switcher visibility:**
   - Verify Languages icon (globe-like) appears in header before notification bell
   - Verify Languages icon appears in sidebar footer when sidebar expanded
4. **Test language switching:**
   - Click Languages icon in header
   - Verify dropdown shows "English" and "עברית" options
   - Click "עברית" to switch to Hebrew
   - Verify URL changes from /en/... to /he/...
   - Verify page content updates to Hebrew (no full page reload)
   - Verify layout flips to RTL
5. **Test persistence:**
   - Close browser completely (not just tab)
   - Reopen browser and navigate to http://localhost:3000/properties (no locale prefix)
   - Verify it redirects to /he/... (remembers Hebrew preference)
6. **Test auto-detection (optional - requires browser language change):**
   - Clear cookies (Application tab -> Cookies -> Clear)
   - Set browser language to Hebrew (Chrome: Settings -> Languages)
   - Navigate to http://localhost:3000/properties
   - Verify it redirects to /he/... based on browser preference
  </how-to-verify>
  <resume-signal>Type "approved" if language switching works correctly, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
1. Verify LocaleSwitcher in AppShell: `grep -A 1 "LocaleSwitcher" src/components/layout/AppShell.tsx`
2. Verify LocaleSwitcher in Sidebar: `grep -A 1 "LocaleSwitcher" src/components/layout/Sidebar.tsx`
3. Run TypeScript check: `npx tsc --noEmit`
4. Manual verification via checkpoint
</verification>

<success_criteria>
- LocaleSwitcher visible in header (before NotificationCenter)
- LocaleSwitcher visible in sidebar footer
- Clicking switcher opens dropdown with English and Hebrew options
- Selecting language updates URL and page content immediately (client-side navigation)
- Language preference persists across browser sessions
- First-time visitors see language matching their browser settings
</success_criteria>

<output>
After completion, create `.planning/phases/34-language-switcher-polish/34-02-SUMMARY.md`
</output>
