---
phase: 17-client-management
plan: 02
type: execute
---

<objective>
Create frontend client list and client detail pages for service providers.

Purpose: Replace the request-centric clients page with a proper client management view showing unique clients and their deal history.
Output: Updated /clients page with client cards, new /clients/[id] detail page.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
@~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

**Prior plan:**
@.planning/phases/17-client-management/17-01-SUMMARY.md

**Relevant source files:**
@src/app/(app)/clients/page.tsx
@src/app/(app)/deals/[id]/page.tsx
@src/components/dashboard/ProviderDashboard.tsx
@convex/clients.ts

**Established patterns:**
- Card-based list layouts (RequestCard in clients page, ActiveDealCard in dashboard)
- Avatar with initials fallback pattern
- Skeleton loaders matching card structure
- Stage badge color mapping (getStageBadgeClasses)
- formatDate and formatUSD utilities inline in pages

**Constraining decisions:**
- Phase 16: Stage badge colors: blue=broker_assigned, purple=mortgage, orange=legal, green=closing
- Phase 15: InvestorQuestionnaireCard pattern for showing questionnaire data to providers
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update clients page to show client list</name>
  <files>src/app/(app)/clients/page.tsx</files>
  <action>
Refactor the clients page to show unique clients instead of service requests:

1. Replace useQuery(api.serviceRequests.listForProvider) with useQuery(api.clients.getClients)
2. Create ClientCard component showing:
   - Avatar with name/initials
   - Client name and email
   - Stats row: X deals, Y active, $Z total value
   - Last activity date
   - "View Details" button linking to /clients/[id]
3. Update skeleton loader to match new card structure
4. Update empty state message: "No clients yet. When you accept client requests, they'll appear here."
5. Add search/filter input to filter clients by name (client-side filtering)
6. Keep the provider-only access check

Layout:
- Grid of cards (1 col mobile, 2 cols md, 3 cols lg)
- Each card similar to property card style but for clients

Remove the old RequestCard and request-specific logic - requests are now handled on the deals page.
  </action>
  <verify>npm run build passes, page renders without errors</verify>
  <done>Clients page shows unique clients with stats and links to detail pages</done>
</task>

<task type="auto">
  <name>Task 2: Create client detail page</name>
  <files>src/app/(app)/clients/[id]/page.tsx</files>
  <action>
Create new client detail page at src/app/(app)/clients/[id]/page.tsx:

1. Get clientId from params
2. Query getClientDetails with clientId
3. Header section:
   - Large avatar
   - Client name, email
   - Stats badges: X total deals, Y active, Z completed
   - "Start Chat" button (link to /chat?client=[id])
4. Two-column layout (lg:grid-cols-3):
   - Left column (2/3): Deal History
   - Right column (1/3): Client Profile (from questionnaire)

Deal History section:
- List of deal cards showing:
  - Property thumbnail, title, city, price
  - Stage badge with color
  - Date started
  - Other providers assigned (small avatars)
  - Click to go to /deals/[dealId]

Client Profile section (if questionnaire exists):
- Investment preferences from questionnaire
- Budget range
- Preferred locations
- Similar to InvestorQuestionnaireCard but standalone

Handle loading state with skeletons.
Handle not found (null result) with redirect or message.
  </action>
  <verify>npm run build passes, page renders without errors</verify>
  <done>Client detail page shows full profile and deal history</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Client management pages - client list and client detail</what-built>
  <how-to-verify>
    1. Run: npm run dev
    2. Log in as a service provider (broker, mortgage advisor, or lawyer)
    3. Navigate to /clients
    4. Verify: Client list shows unique clients with stats (deals, value, last activity)
    5. Click a client to go to /clients/[id]
    6. Verify: Detail page shows client info, deal history, and profile data
    7. Click a deal to verify navigation to /deals/[id] works
    8. Test on mobile: verify responsive layout
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` passes without errors
- [ ] Client list page shows unique clients
- [ ] Client detail page shows deal history
- [ ] Navigation between pages works correctly
- [ ] Responsive design works on mobile
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Human verification approved
- No TypeScript errors
- Phase 17 complete
</success_criteria>

<output>
After completion, create `.planning/phases/17-client-management/17-02-SUMMARY.md`
</output>
