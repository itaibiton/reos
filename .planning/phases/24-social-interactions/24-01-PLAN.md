---
phase: 24-social-interactions
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/feed/EngagementFooter.tsx
  - src/components/feed/DiscussionPostCard.tsx
  - src/components/feed/PropertyPostCard.tsx
  - src/components/feed/ServiceRequestPostCard.tsx
  - src/components/feed/index.ts
autonomous: true

must_haves:
  truths:
    - "User can like a post by clicking the heart icon"
    - "User can unlike a post by clicking again (toggle)"
    - "User can save a post by clicking the bookmark icon"
    - "User can unsave a post by clicking again (toggle)"
    - "Like/save state is visually distinct (filled vs outline)"
    - "Counts update immediately (optimistic UI)"
  artifacts:
    - path: "src/components/feed/EngagementFooter.tsx"
      provides: "Shared engagement footer with interactive buttons"
      exports: ["EngagementFooter"]
  key_links:
    - from: "EngagementFooter.tsx"
      to: "api.posts.likePost"
      via: "useMutation"
      pattern: "useMutation.*likePost"
    - from: "EngagementFooter.tsx"
      to: "api.posts.isLikedByUser"
      via: "useQuery"
      pattern: "useQuery.*isLikedByUser"
---

<objective>
Make the engagement footer interactive with like/save toggle buttons

Purpose: Enable users to like and save posts with visual feedback and optimistic updates
Output: EngagementFooter component with interactive like/save buttons, refactored post cards
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@convex/posts.ts (likePost, unlikePost, savePost, unsavePost, isLikedByUser, isSavedByUser)
@src/components/feed/DiscussionPostCard.tsx (current engagement footer pattern)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create EngagementFooter component with interactive like/save</name>
  <files>src/components/feed/EngagementFooter.tsx</files>
  <action>
Create a shared EngagementFooter component that:

1. Props: `postId: Id<"posts">`, `likeCount: number`, `commentCount: number`, `saveCount: number`

2. Use queries to get current user's like/save status:
   - `useQuery(api.posts.isLikedByUser, { postId })`
   - `useQuery(api.posts.isSavedByUser, { postId })`

3. Use mutations for toggle actions:
   - `useMutation(api.posts.likePost)` / `useMutation(api.posts.unlikePost)`
   - `useMutation(api.posts.savePost)` / `useMutation(api.posts.unsavePost)`

4. Implement optimistic UI:
   - Track local state for isLiked/isSaved
   - Update local count immediately on click
   - Sync with server state when query updates

5. Visual states:
   - Liked: FavouriteIcon with `fill="currentColor"` and `className="text-red-500"`
   - Not liked: FavouriteIcon outline (default)
   - Saved: BookmarkAdd01Icon with `fill="currentColor"` and `className="text-primary"`
   - Not saved: BookmarkAdd01Icon outline (default)

6. Button styling:
   - Use `button` elements with `className="flex items-center gap-1 hover:text-foreground transition-colors"`
   - Comment icon remains static (links to comments in Plan 02)

7. Layout: Same as current footer - `flex items-center gap-4 text-sm text-muted-foreground pt-3 border-t`

8. Handle loading states: Disable buttons while mutation is pending
  </action>
  <verify>Component renders with like/save buttons, clicking toggles visual state</verify>
  <done>EngagementFooter component created with interactive like/save toggle and optimistic updates</done>
</task>

<task type="auto">
  <name>Task 2: Refactor post cards to use EngagementFooter</name>
  <files>
    src/components/feed/DiscussionPostCard.tsx
    src/components/feed/PropertyPostCard.tsx
    src/components/feed/ServiceRequestPostCard.tsx
    src/components/feed/index.ts
  </files>
  <action>
1. In each post card component (DiscussionPostCard, PropertyPostCard, ServiceRequestPostCard):
   - Remove the inline engagement footer div
   - Import EngagementFooter from "./EngagementFooter"
   - Replace inline footer with:
     ```tsx
     <EngagementFooter
       postId={post._id}
       likeCount={post.likeCount}
       commentCount={post.commentCount}
       saveCount={post.saveCount}
     />
     ```

2. Update barrel export in index.ts:
   - Add `export { EngagementFooter } from "./EngagementFooter";`

3. Remove unused icon imports from each card (FavouriteIcon, Comment01Icon, BookmarkAdd01Icon) if they were only used in the footer
  </action>
  <verify>`npm run build` passes, feed page shows interactive buttons on all card types</verify>
  <done>All post cards use shared EngagementFooter, like/save buttons work on all post types</done>
</task>

</tasks>

<verification>
1. Navigate to /feed page
2. Click heart icon on a post - should fill red and increment count
3. Click again - should return to outline and decrement count
4. Click bookmark icon - should fill and increment count
5. Click again - should return to outline and decrement count
6. Refresh page - state should persist (server-synced)
7. Test on all three post types (property, service, discussion)
</verification>

<success_criteria>
- Like button toggles between outline (not liked) and filled red (liked)
- Save button toggles between outline (not saved) and filled (saved)
- Counts update immediately on click (optimistic)
- State persists after page refresh
- Works on all post card types
- Build passes with no TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/24-social-interactions/24-01-SUMMARY.md`
</output>
