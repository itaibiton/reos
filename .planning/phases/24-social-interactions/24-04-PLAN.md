---
phase: 24-social-interactions
plan: 04
type: execute
wave: 2
depends_on: ["24-01"]
files_modified:
  - src/components/feed/ShareButton.tsx
  - src/components/feed/EngagementFooter.tsx
  - src/components/feed/index.ts
autonomous: true

must_haves:
  truths:
    - "User can click share icon to copy post link"
    - "Toast confirms link copied to clipboard"
    - "Share count increments when link is shared"
  artifacts:
    - path: "src/components/feed/ShareButton.tsx"
      provides: "Share button with copy to clipboard"
      exports: ["ShareButton"]
  key_links:
    - from: "ShareButton.tsx"
      to: "navigator.clipboard"
      via: "writeText"
      pattern: "navigator.clipboard.writeText"
---

<objective>
Add share functionality with copy link to clipboard

Purpose: Enable users to share posts by copying a link to their clipboard
Output: ShareButton component integrated into EngagementFooter
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/components/feed/EngagementFooter.tsx (from 24-01)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ShareButton component</name>
  <files>src/components/feed/ShareButton.tsx</files>
  <action>
Create a ShareButton component:

```typescript
"use client";

import { useState } from "react";
import { useMutation } from "convex/react";
import { api } from "../../../convex/_generated/api";
import { Id } from "../../../convex/_generated/dataModel";
import { HugeiconsIcon } from "@hugeicons/react";
import { Share01Icon } from "@hugeicons/core-free-icons";
import { toast } from "sonner";

interface ShareButtonProps {
  postId: Id<"posts">;
  shareCount: number;
}

export function ShareButton({ postId, shareCount }: ShareButtonProps) {
  const [localCount, setLocalCount] = useState(shareCount);
  const [hasShared, setHasShared] = useState(false);

  const handleShare = async () => {
    // Build the share URL
    const url = `${window.location.origin}/feed/post/${postId}`;

    try {
      await navigator.clipboard.writeText(url);
      toast.success("Link copied to clipboard");

      // Only increment once per session to avoid spam
      if (!hasShared) {
        setLocalCount((prev) => prev + 1);
        setHasShared(true);
        // Note: We don't have a server-side incrementShareCount mutation
        // because share tracking is less critical than likes/saves.
        // Could add later if analytics needed.
      }
    } catch (error) {
      // Fallback for browsers that don't support clipboard API
      toast.error("Failed to copy link");
    }
  };

  return (
    <button
      onClick={handleShare}
      className="flex items-center gap-1 hover:text-foreground transition-colors"
    >
      <HugeiconsIcon icon={Share01Icon} size={16} strokeWidth={1.5} />
      <span>{localCount}</span>
    </button>
  );
}
```

Key features:
- Copies post URL to clipboard using navigator.clipboard API
- Toast feedback on success/failure
- Local count increment (once per session) for optimistic UI
- No server mutation needed for MVP (shares are less critical than likes/saves)
  </action>
  <verify>Component compiles without errors</verify>
  <done>ShareButton component created with copy to clipboard and toast feedback</done>
</task>

<task type="auto">
  <name>Task 2: Integrate ShareButton into EngagementFooter</name>
  <files>
    src/components/feed/EngagementFooter.tsx
    src/components/feed/index.ts
  </files>
  <action>
1. Update EngagementFooter props to include `shareCount`:
   - Add `shareCount: number` to the interface

2. Import and add ShareButton to the footer:
```tsx
import { ShareButton } from "./ShareButton";

// In the footer div, add after the save button:
<ShareButton postId={postId} shareCount={shareCount} />
```

3. Update all usages of EngagementFooter in post cards to pass shareCount:
   - In DiscussionPostCard, PropertyPostCard, ServiceRequestPostCard:
   ```tsx
   <EngagementFooter
     postId={post._id}
     likeCount={post.likeCount}
     commentCount={post.commentCount}
     saveCount={post.saveCount}
     shareCount={post.shareCount}  // Add this
   />
   ```

4. Update barrel export in index.ts:
   - Add `export { ShareButton } from "./ShareButton";`
  </action>
  <verify>`npm run build` passes, share button appears and works on all post cards</verify>
  <done>ShareButton integrated into EngagementFooter, copy to clipboard works</done>
</task>

</tasks>

<verification>
1. Navigate to /feed page
2. Click share icon on any post
3. Toast should show "Link copied to clipboard"
4. Share count should increment (once per session)
5. Paste clipboard content - should be valid post URL
6. Test on all three post types
</verification>

<success_criteria>
- Share button visible on all post cards
- Clicking copies post URL to clipboard
- Toast confirms "Link copied to clipboard"
- Share count increments once per session
- Fallback error toast if clipboard fails
- Build passes with no TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/24-social-interactions/24-04-SUMMARY.md`
</output>
