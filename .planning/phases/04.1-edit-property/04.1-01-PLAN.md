---
phase: 04.1-edit-property
plan: 01
type: execute
---

<objective>
Edit existing property listings with pre-populated form.

Purpose: Enable property owners to update listing details after creation.
Output: Edit page at /properties/[id]/edit with PropertyForm in edit mode.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior phase summary (property creation):
@.planning/phases/04-property-marketplace/04-01-SUMMARY.md

# Key source files:
@convex/properties.ts
@src/components/properties/PropertyForm.tsx
@src/app/(app)/properties/new/page.tsx

**Tech stack available:** Convex (update mutation exists), Shadcn form components
**Established patterns:**
- Two-column form layout (from profiles, property create)
- Page layout: `<div className="p-6">` with header section
- USD/ILS auto-conversion at fixed rate (3.7)
- Toast feedback on success/error
- Router.push for navigation after submit

**Constraining decisions:**
- Phase 4-01: PropertyForm created for creation only, needs edit mode
- Phase 4-01: `properties.update` mutation already exists and accepts partial updates
- Phase 4-01: Any authenticated user can update any property for MVP
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add edit mode to PropertyForm</name>
  <files>src/components/properties/PropertyForm.tsx</files>
  <action>
Modify PropertyForm to support both create and edit modes:

1. Add props interface:
   - `mode: "create" | "edit"` (default "create")
   - `propertyId?: Id<"properties">` (required when mode="edit")
   - `initialData?: PropertyData` (property values to pre-populate)

2. Import and use the update mutation alongside create:
   ```tsx
   const updateProperty = useMutation(api.properties.update);
   ```

3. Initialize all form fields from `initialData` when provided:
   - In useState calls, use `initialData?.field ?? ""` or appropriate default
   - For selects/radio groups, use `initialData?.propertyType ?? "residential"`

4. Modify handleSubmit to branch on mode:
   - If mode="create": use createProperty mutation (existing behavior)
   - If mode="edit": use updateProperty mutation with propertyId

5. Update button text dynamically:
   - Create mode: "Create Property" / "Creating Property..."
   - Edit mode: "Save Changes" / "Saving..."

6. Update success toast and redirect:
   - Edit mode: "Property updated successfully!"
   - Both modes redirect to /properties

Note: Keep the component backward-compatible - existing create usage should work unchanged.
  </action>
  <verify>TypeScript compiles with no errors: `npx tsc --noEmit`</verify>
  <done>PropertyForm accepts mode, propertyId, and initialData props. Edit mode uses update mutation. Create mode unchanged.</done>
</task>

<task type="auto">
  <name>Task 2: Create edit page at /properties/[id]/edit</name>
  <files>src/app/(app)/properties/[id]/edit/page.tsx</files>
  <action>
Create the edit page:

1. Use dynamic route segment `[id]` to get property ID from URL
2. Fetch property using `useQuery(api.properties.getById, { id })`
3. Handle loading state with Spinner component
4. Handle not found: if property is null after loading, show error message with link back to /properties
5. Pass property data to PropertyForm:
   ```tsx
   <PropertyForm
     mode="edit"
     propertyId={property._id}
     initialData={{
       title: property.title,
       description: property.description,
       // ... all fields
     }}
   />
   ```

Page structure (match existing patterns):
```tsx
<div className="p-6">
  <div className="mb-6">
    <h1 className="text-2xl font-bold">Edit Property</h1>
    <p className="text-muted-foreground">Update property listing details.</p>
  </div>
  <PropertyForm ... />
</div>
```

Import Id type from convex for proper typing of the route param.
  </action>
  <verify>Navigate to /properties/[valid-id]/edit in dev server - form loads with existing data</verify>
  <done>Edit page loads property data into form. Form submits with update mutation. Invalid ID shows error state.</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `npx tsc --noEmit` passes with no TypeScript errors
- [ ] Create property flow still works (regression check)
- [ ] Edit page loads existing property data correctly
- [ ] Editing a property updates it in the database
- [ ] Success toast shows on save
- [ ] Redirects to /properties after save
</verification>

<success_criteria>

- PropertyForm supports both create and edit modes
- Edit page at /properties/[id]/edit works end-to-end
- No regression in create property flow
- TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/04.1-edit-property/04.1-01-SUMMARY.md`
</output>
