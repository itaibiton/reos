---
phase: 11-questionnaire-content-1
plan: 01
type: execute
---

<objective>
Implement the first 5 questionnaire questions: citizenship, residency status, experience level, property ownership, and investment type.

Purpose: Replace placeholder steps with actual data-collecting questions that persist to Convex.
Output: Working questionnaire with 5 questions, user answers saved to investorQuestionnaires table.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-questionnaire-ui/10-01-SUMMARY.md

**Key files from Phase 10:**
@src/components/questionnaire/QuestionnaireWizard.tsx
@src/components/questionnaire/QuestionBubble.tsx
@src/components/questionnaire/AnswerArea.tsx
@src/app/(app)/onboarding/questionnaire/page.tsx
@convex/investorQuestionnaires.ts

**Established patterns:**
- Wizard uses 1-based step indexing (step 1 = first question)
- QuestionBubble for assistant-style question (left-aligned bubble)
- AnswerArea for user input controls (right-aligned bordered container)
- saveAnswers mutation accepts partial updates for each field
- RadioGroup/Checkbox patterns from placeholder WelcomeStep

**Schema fields (already defined in investorQuestionnaires):**
- citizenship: "israeli" | "non_israeli"
- residencyStatus: "resident" | "returning_resident" | "non_resident" | "unsure"
- experienceLevel: "none" | "some" | "experienced"
- ownsPropertyInIsrael: boolean
- investmentType: "residential" | "investment"
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create step components for all 5 questions</name>
  <files>
    src/components/questionnaire/steps/CitizenshipStep.tsx
    src/components/questionnaire/steps/ResidencyStep.tsx
    src/components/questionnaire/steps/ExperienceStep.tsx
    src/components/questionnaire/steps/OwnershipStep.tsx
    src/components/questionnaire/steps/InvestmentTypeStep.tsx
    src/components/questionnaire/steps/index.ts
  </files>
  <action>
Create 5 step components in a new `steps/` subdirectory, each following the QuestionBubble + AnswerArea pattern:

**CitizenshipStep.tsx:**
- Question: "Are you an Israeli citizen?"
- Description: Explain this affects tax implications and legal requirements
- Options: "Yes, I am an Israeli citizen" / "No, I am not an Israeli citizen"
- Props: `value: string | undefined`, `onChange: (value: string) => void`
- Use RadioGroup with styled radio items (border, padding, hover states)

**ResidencyStep.tsx:**
- Question: "What is your residency status in Israel?"
- Description: Determines applicable tax benefits and purchase process
- Options:
  - "Israeli resident" (I live in Israel full-time)
  - "Returning resident (Toshav Chozer)" (Planning to return/returned within 10 years)
  - "Non-resident" (I do not live in Israel)
  - "I'm not sure" (Need guidance on this)
- Props: `value: string | undefined`, `onChange: (value: string) => void`

**ExperienceStep.tsx:**
- Question: "How much experience do you have with Israeli real estate?"
- Description: Helps us tailor recommendations to your knowledge level
- Options:
  - "No experience" (This would be my first investment)
  - "Some experience" (I've researched or made 1-2 investments)
  - "Experienced investor" (I've made multiple investments)
- Props: `value: string | undefined`, `onChange: (value: string) => void`

**OwnershipStep.tsx:**
- Question: "Do you currently own property in Israel?"
- Description: Affects tax treatment on additional purchases
- Options: "Yes" / "No"
- Props: `value: boolean | undefined`, `onChange: (value: boolean) => void`
- Store as boolean (true/false) not string

**InvestmentTypeStep.tsx:**
- Question: "What type of investment are you looking for?"
- Description: Helps us understand your goals
- Options:
  - "Primary residence" (I plan to live in the property)
  - "Investment property" (Rental income or appreciation)
- Props: `value: string | undefined`, `onChange: (value: string) => void`

**index.ts:** Barrel export all step components.

All components:
- Use "use client" directive
- Import QuestionBubble, AnswerArea from parent directory
- Use consistent styling: rounded-lg border, p-3-4, hover:bg-muted/50, cursor-pointer
- Include helpful context in description about why we're asking
  </action>
  <verify>
TypeScript compiles: `npx tsc --noEmit`
All exports resolve: `grep -r "from.*steps" src/components/questionnaire/`
  </verify>
  <done>
5 step components created in steps/ directory with consistent patterns, barrel exported.
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire up questionnaire page with real steps and state management</name>
  <files>
    src/app/(app)/onboarding/questionnaire/page.tsx
    src/components/questionnaire/index.ts
  </files>
  <action>
Update the questionnaire page to replace placeholders with real steps:

**1. Add local state for each answer:**
```typescript
const [citizenship, setCitizenship] = useState<string | undefined>(questionnaire?.citizenship);
const [residencyStatus, setResidencyStatus] = useState<string | undefined>(questionnaire?.residencyStatus);
const [experienceLevel, setExperienceLevel] = useState<string | undefined>(questionnaire?.experienceLevel);
const [ownsPropertyInIsrael, setOwnsPropertyInIsrael] = useState<boolean | undefined>(questionnaire?.ownsPropertyInIsrael);
const [investmentType, setInvestmentType] = useState<string | undefined>(questionnaire?.investmentType);
```

**2. Initialize state from questionnaire data:**
Use useEffect to sync local state when questionnaire loads (for draft restoration):
```typescript
useEffect(() => {
  if (questionnaire) {
    setCitizenship(questionnaire.citizenship);
    setResidencyStatus(questionnaire.residencyStatus);
    // ... etc
  }
}, [questionnaire]);
```

**3. Create save handler that persists on each step change:**
```typescript
const saveProgress = async () => {
  await saveAnswers({
    citizenship,
    residencyStatus,
    experienceLevel,
    ownsPropertyInIsrael,
    investmentType,
  });
};
```

**4. Update handleStepChange to save before navigating:**
Call saveProgress() before updateStep() to persist current answers.

**5. Replace placeholder steps array with real steps:**
```typescript
const steps: WizardStep[] = useMemo(
  () => [
    {
      id: "citizenship",
      title: "Citizenship",
      component: <CitizenshipStep value={citizenship} onChange={setCitizenship} />,
    },
    {
      id: "residency",
      title: "Residency",
      component: <ResidencyStep value={residencyStatus} onChange={setResidencyStatus} />,
    },
    {
      id: "experience",
      title: "Experience",
      component: <ExperienceStep value={experienceLevel} onChange={setExperienceLevel} />,
    },
    {
      id: "ownership",
      title: "Ownership",
      component: <OwnershipStep value={ownsPropertyInIsrael} onChange={setOwnsPropertyInIsrael} />,
    },
    {
      id: "investment-type",
      title: "Investment Type",
      component: <InvestmentTypeStep value={investmentType} onChange={setInvestmentType} />,
    },
  ],
  [citizenship, residencyStatus, experienceLevel, ownsPropertyInIsrael, investmentType]
);
```

**6. Update barrel export:**
Add steps re-export to src/components/questionnaire/index.ts

**7. Remove placeholder components:**
Delete WelcomeStep and PlaceholderStep function definitions from page.
  </action>
  <verify>
Dev server runs without errors: `npm run dev` (check console)
Navigate to /onboarding/questionnaire and verify:
- 5 steps appear in progress indicator
- Each step shows question and answer options
- Answers persist when navigating back/forward
  </verify>
  <done>
Questionnaire shows 5 real questions with working state management and Convex persistence.
  </done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `npx tsc --noEmit` passes
- [ ] `npm run dev` starts without errors
- [ ] All 5 steps appear in wizard progress
- [ ] Each step shows correct question and options
- [ ] Selecting answer and continuing saves to Convex
- [ ] Refreshing page restores previous answers (draft persistence)
- [ ] Completing all steps and clicking Complete marks questionnaire done
</verification>

<success_criteria>

- 5 step components created with consistent QuestionBubble/AnswerArea pattern
- Questionnaire page wired with real steps replacing placeholders
- State management syncs local state â†” Convex
- Draft answers persist across page refreshes
- All TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/11-questionnaire-content-1/11-01-SUMMARY.md` following the summary template.

Include in summary:
- All step components created
- State management approach (local state + Convex sync)
- Any deviations from plan
</output>
